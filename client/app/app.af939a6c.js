"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function baseObjectService(a,b){return{createObject:function(b,c){return a({method:"POST",url:"/api/baseObject/"+b,data:c})},deleteObject:function(b,c){return a({method:"DELETE",url:"/api/baseObject/"+b+"/"+c})},editObject:function(b,c,d,e){for(var f=0;f<d[e].length;f++)d[e][f]=d[e][f]._id;return a({method:"PUT",url:"/api/baseObject/"+b+"/"+c,data:d})},updateObject:function(b,c,d){return a({method:"PUT",url:"/api/baseObject/"+b+"/"+c,data:d})},getAllObjects:function(c){return a({method:"GET",url:"/api/baseObject/"+c}).success(function(a){a&&"site"===c&&b.setAllSites(a)})},getObject:function(b,c){return a({method:"GET",url:"/api/baseObject/"+b+"/"+c})}}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}baseObjectService.$inject=["$http","SiteService"],angular.module("petalApp",["petalApp.auth","petalApp.admin","petalApp.constants","petalApp.factories","ngCookies","ngResource","btford.socket-io","ui.router","ui.bootstrap","angularMoment","validation.match","angular-loading-bar","LocalStorageModule","colorpicker.module","ngMaterial","monospaced.elastic","textAngular","angularSpectrumColorpicker","ui.bootstrap.dropdownToggle","ngFileUpload","ngclipboard","angular-sortable-view"]).config(["$urlRouterProvider","$locationProvider","cfpLoadingBarProvider","$mdDateLocaleProvider","$provide",function(a,b,c,d,e){a.otherwise("/"),b.html5Mode(!0),d.formatDate=function(a){return moment(a).format("MMMM DD")},e.decorator("taOptions",["taRegisterTool","$delegate",function(a,b){return a("backgroundColor",{display:"<div spectrum-colorpicker ng-model='color' on-change='!!color && action(color)' format='\"hex\"' options='options'></div>",action:function(a){var b=this;return this.$editor().wrapSelection?this.$editor().wrapSelection("backColor",a):void setTimeout(function(){b.action(a)},100)},options:{replacerClassName:"fa fa-paint-brush",showButtons:!1},color:"#fff"}),a("fontColor",{display:"<spectrum-colorpicker trigger-id='{{trigger}}' ng-model='color' on-change='!!color && action(color)' format='\"hex\"' options='options'></spectrum-colorpicker>",action:function(a){var b=this;return this.$editor().wrapSelection?this.$editor().wrapSelection("foreColor",a):void setTimeout(function(){b.action(a)},100)},options:{replacerClassName:"fa fa-font",showButtons:!1,showPalette:!0,showSelectionPalette:!0,localStorageKey:"spectrum.fontColor",palette:["#3C5B94","#7898B7","#60599C","#A09FC1"],showInitial:!0,showInput:!0,maxSelectionSize:20},color:"#000"}),a("fontName",{display:"<span class='bar-btn-dropdown dropdown'><button class='btn btn-blue dropdown-toggle' type='button' ng-disabled='showHtml()' style='padding-top: 4px'><i class='fa fa-font'></i><i class='fa fa-caret-down'></i></button><ul class='dropdown-menu'><li ng-repeat='o in options'><button class='btn btn-blue checked-dropdown' style='font-family: {{o.css}}; width: 100%' type='button' ng-click='action($event, o.css)'><i ng-if='o.active' class='fa fa-check'></i>{{o.name}}</button></li></ul></span>",action:function(a,b){return a.stopPropagation&&(a.stopPropagation(),$("body").trigger("click")),this.$editor().wrapSelection("fontName",b)},options:[{name:"Sans-Serif",css:"Arial, Helvetica, sans-serif"},{name:"Serif",css:"'times new roman', serif"},{name:"Wide",css:"'arial black', sans-serif"},{name:"Narrow",css:"'arial narrow', sans-serif"},{name:"Comic Sans MS",css:"'comic sans ms', sans-serif"},{name:"Courier New",css:"'courier new', monospace"},{name:"Garamond",css:"garamond, serif"},{name:"Georgia",css:"georgia, serif"},{name:"Tahoma",css:"tahoma, sans-serif"},{name:"Trebuchet MS",css:"'trebuchet ms', sans-serif"},{name:"Helvetica",css:"'Helvetica Neue', Helvetica, Arial, sans-serif"},{name:"Verdana",css:"verdana, sans-serif"},{name:"Proxima Nova",css:"proxima_nova_rgregular"}]}),a("fontSize",{display:"<span class='bar-btn-dropdown dropdown'><button class='btn btn-blue dropdown-toggle' type='button' ng-disabled='showHtml()' style='padding-top: 4px'><i class='fa fa-text-height'></i><i class='fa fa-caret-down'></i></button><ul class='dropdown-menu'><li ng-repeat='o in options'><button class='btn btn-blue checked-dropdown' style='font-size: {{o.css}}; width: 100%' type='button' ng-click='action($event, o.value)'><i ng-if='o.active' class='fa fa-check'></i> {{o.name}}</button></li></ul></span>",action:function(a,b){return a.stopPropagation&&(a.stopPropagation(),$("body").trigger("click")),this.$editor().wrapSelection("fontSize",parseInt(b))},options:[{name:"xx-small",css:"xx-small",value:1},{name:"x-small",css:"x-small",value:2},{name:"small",css:"small",value:3},{name:"medium",css:"medium",value:4},{name:"large",css:"large",value:5},{name:"x-large",css:"x-large",value:6},{name:"xx-large",css:"xx-large",value:7}]}),b.toolbar=[["h1","h2","h3","h4","h5","h6"],["p","bold","italics","underline"],["ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["indent","outdent","insertImage","insertLink","insertVideo"],[]],b.toolbar[5].push("fontColor","fontName","fontSize"),b}])}]).run(["$window","$anchorScroll","$rootScope","$timeout","TaskPriority","$state",function(a,b,c,d,e,f){var g=a.innerHeight,h=g/2;b.yOffset=h,c.$on("$stateChangeStart",function(){var a=(angular.element(document).find("body").eq(0),document.getElementById("todayMarker"));a&&a.parentNode.removeChild(a)}),e.initPriorities(),c.state=f,c.showCollapse=!1,c.$on("toggle-collapse",function(a,b){d(function(){c.showCollapse=b})})}]),angular.module("petalApp.auth",["petalApp.constants","petalApp.util","ngCookies","ui.router"]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]),angular.module("petalApp.admin",["petalApp.auth","ui.router"]),angular.module("petalApp.factories",["petalApp.constants","petalApp.util","ngCookies","ui.router"]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]),angular.module("petalApp.util",[]);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=function(){function a(b){_classCallCheck(this,a),this.users=b.query(),console.log("users: ",this.users)}return a.$inject=["User"],_createClass(a,[{key:"delete",value:function(a){a.$remove(),this.users.splice(this.users.indexOf(a),1)}}]),a}();angular.module("petalApp.admin").controller("AdminController",a)}(),angular.module("petalApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginController",controllerAs:"vm"}).state("logout",{url:"/logout?referrer",referrer:"main",template:"",controller:["$state","Auth",function(a,b){var c=a.params.referrer||a.current.referrer||"main";b.logout(),a.go(c)}]}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupController",controllerAs:"vm"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsController",controllerAs:"vm",authenticate:!0})}]).run(["$rootScope",function(a){a.$on("$stateChangeStart",function(a,b,c,d){"logout"===b.name&&d&&d.name&&!d.authenticate&&(b.referrer=d.name)})}]),angular.module("petalApp.admin").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminController",controllerAs:"admin",authenticate:"admin"})}]),function(a,b){a.module("petalApp.constants",[]).constant("appConfig",{userRoles:["guest","user","employee","admin","super-admin"],appVersion:"1.1.7"})}(angular),angular.module("petalApp").controller("DashboardCtrl",["$scope","DashboardService","$state","$timeout","$interval","preloader",function(a,b,c,d,e,f){function g(){for(var b=a.dashboardObj.rooms,c=new moment,d=0;d<b.length;d++){var e=moment(b[d].startDate),f=moment(b[d].endDate),g=moment(b[d].flippedDate),h=Math.ceil(moment.duration(f.diff(c)).asDays());a.dashboardObj.rooms[d].harvestDate=h,a.dashboardObj.rooms[d].currentDay=c.diff(e,"days"),a.dashboardObj.rooms[d].totalDays=moment.duration(f.diff(e)).asDays(),a.dashboardObj.rooms[d].dayProgress=(a.dashboardObj.rooms[d].totalDays-a.dashboardObj.rooms[d].currentDay)/a.dashboardObj.rooms[d].totalDays*a.dashboardObj.rooms[d].totalDays;var i,k;b[d].flippedDate?(i=Math.ceil(moment.duration(c.diff(g)).asWeeks()),k=moment.duration(c.diff(g)).asDays(),i<3?a.dashboardObj.rooms[d].phase="Early Flower":i<5?a.dashboardObj.rooms[d].phase="Full Bloom":i<8?a.dashboardObj.rooms[d].phase="Flowering":8==i?a.dashboardObj.rooms[d].phase="Ripening":a.dashboardObj.rooms[d].phase="Short Flush",a.dashboardObj.rooms[d].weekCycle="W"+i+"-F"):(i=Math.ceil(moment.duration(c.diff(e)).asWeeks()),k=moment.duration(c.diff(e)).asDays(),a.dashboardObj.rooms[d].phase="Vegetation",a.dashboardObj.rooms[d].weekCycle="W"+i+"-V"),a.dashboardObj.rooms[d].weekDay=j(k),h<=7?a.dashboardObj.rooms[d].harvestFlag="high":h<=15&&(a.dashboardObj.rooms[d].harvestFlag="medium")}}function h(){a.clock=Date.now(),i(),d(h,a.tickInterval)}function i(){for(var b=a.dashboardObj.rooms,c=new moment,d=c.hours(),e=c.minutes(),f=d+e/60,g=0;g<b.length;g++){var h=moment(b[g].lightsOn),i=moment(b[g].lightsOff),j=h.hours(),k=h.minutes(),l=j+k/60,m=i.hours(),n=i.minutes(),o=m+n/60;j<m?a.dashboardObj.rooms[g].areLightsOn=l<=f&&f<o:a.dashboardObj.rooms[g].areLightsOn=!(o<=f&&f<l);var p,q;p=a.dashboardObj.rooms[g].areLightsOn?o>f?o-f:24-f+o:l>f?l-f:24-f+l,q={hours:parseInt(p,10),min:parseInt(60*(p-parseInt(p,10)))},a.dashboardObj.rooms[g].countDown=q}}function j(a){return console.log("daysSinceChange: ",a),a%7>0?Math.ceil(a%7):7}a.dashboardObj=b.getDashboardObj(),a.dashboardObj||c.go("sites"),a.clock="loading clock...",a.tickInterval=6e4,console.log("dashBoard: ",a.dashboardObj),a.dashboardObj.rooms.sort(function(a,b){var c=a.name.replace("Tunnel ",""),d=b.name.replace("Tunnel ","");return c>d?1:c<d?-1:0}),h(),g(),a.selectedView="overview",d(h,a.tickInterval),a.getFlippedDate=function(a){return a.flippedDate?a.flippedDate:"Not Yet Flipped"},a.changeView=function(b){a.selectedView=b},a.backgrounds=["../../assets/images/weed-blue.78c47add.jpg","../../assets/images/test124.5e402caa.jpg","../../assets/images/test125.jpg","../../assets/images/weed-dark-green.c64a7c4e.jpg","../../assets/images/weed-green.569bbf91.jpg","../../assets/images/weed-pic.b751f4e8.jpg","../../assets/images/2f9fbf939447b6d15e4dd9c8cb082455_large.7ce7e61d.jpeg","../../assets/images/1600x900-5(1).62d28c4a.jpg","../../assets/images/3045240-poster-p-1-sell-weed-without-breaking-the-law.7d85be9b.jpg","../../assets/images/Beautiful-Marijuana-Plant-Picture.9232b02c.jpg","../../assets/images/big-bug-plant-5th-week-2.c6dcba2a.jpg","../../assets/images/budswallpaper020_1920x1080.2cd13209.jpg","../../assets/images/cannabis-1920x1080-wallpaper497002.1d951c4a.jpg","../../assets/images/Cannabis-plants-wallpaper-HD.67d0d479.jpg","../../assets/images/d59e90f2ea64ff5b29d4899fb07d930f_large.7253cf3e.jpeg","../../assets/images/flowers_marijuana_plants_2576x1932_wallpaper_Wallpaper_1680x1050_www.wallpaperswa.com.0ed6c07a.jpg","../../assets/images/Fotolia_33999859_Subscription_XL.6ac27f21.jpg","../../assets/images/hdjaamuinbqsnkllblto.26784f20.jpg","../../assets/images/hempwallpaper026_1920x1080.fe90db92.jpg","../../assets/images/hf-weed-desktop-wallpaper-cannabis-01d.46eccb3d.jpg","../../assets/images/hMwO9WT.1660f603.jpg","../../assets/images/marijuana-green-leaves-201089.6b0e91ed.jpg","../../assets/images/Marijuana-Plant-Wallpaper-Image.a71549d1.jpg","../../assets/images/pot-green.0064eb55.jpg","../../assets/images/pot-red.96ee3282.jpg","../../assets/images/sour-grape-haze.16b6dcbe.jpg","../../assets/images/tumblr_n4dy54YdRS1rentpao1_1280.2a8a850c.jpg","../../assets/images/tumblr_static_bdwwprnr160o8cgwsgw00sssg.e6af40b9.jpg","../../assets/images/uyusturucuyu-cebinde-unuttu-havaalaninda-hatirladi-287518.5435a6b3.jpg","../../assets/images/wallpaper-41067.ef976a02.jpg","../../assets/images/weed-buds.cad51fb0.jpg","../../assets/images/weed-pot.2cd13209.jpg","../../assets/images/weed-woods.2d9fb135.jpg","../../assets/images/weed-yellow.1370c0bf.jpg","../../assets/images/weedWall.0143efed.jpg","../../assets/images/weedWall2.eaf0a4bb.jpg","../../assets/images/WWHhnhM.ec89a963.jpg"],f.preloadImages(a.backgrounds).then(function(){console.log("preloaded!")})["catch"](function(a){console.log("pL err: ",a)})}]),angular.module("petalApp").config(["$stateProvider",function(a){a.state("dashboard",{url:"/dashboard",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl",authenticate:"user"})}]),angular.module("petalApp").controller("DownloadCtrl",["$scope","Auth","$rootScope","$location","$anchorScroll",function(a,b,c,d,e){function f(){if(a.currentUser=b.getCurrentUser(),a.loggingIn=b.loggingIn,a.currentUser&&a.currentUser.role||!a.loggingIn)a.loggingIn?(a.loggingIn=!1,a.loggedIn=!0,g()):a.currentUser=null;else var d=c.$on("logged-in",function(b,c){a.currentUser=c,a.loggedIn=!0,a.loggingIn=!1,d(),g()})}function g(){var b=navigator.userAgent,c="unknown",d=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"ios",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var e in d){var f=d[e];if(f.r.test(b)){c=f.s;break}}/Windows/.test(c)&&(c="Windows"),"android"!==c&&"ios"!==c&&(c="unknown"),a.tsDevice=c,a.deviceType=c,"unknown"===c&&(a.tsDevice="android")}a.loggedIn=!1,a.showLogin=!1,a.errors={},a.submitted=!1,a.deviceType=null,a.user={},f(),a.login=function(c){a.submitted=!0,c.$valid&&b.login({firstName:a.user.firstName,password:a.user.password}).then(function(b){a.currentUser=b,a.loggedIn=!0,a.loggingIn=!1,a.errors={},g()})["catch"](function(b){console.log("login",b),a.errors.other=b.message})},a.scrollTo=function(a){d.hash(a),e()},a.ts=function(b){a.tsDevice=b}}]),angular.module("petalApp").config(["$stateProvider",function(a){a.state("download",{url:"/download",templateUrl:"app/download/download.html",controller:"DownloadCtrl"})}]);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=function(){function a(b,c,d,e,f,g,h){_classCallCheck(this,a),this.$http=b,this.socket=d,this.awesomeThings=[],this.Auth=e,this.localStorage=f,this.location=g,this.$state=h,c.$on("$destroy",function(){d.unsyncUpdates("thing")})}return a.$inject=["$http","$scope","socket","Auth","localStorageService","$location","$state"],_createClass(a,[{key:"$onInit",value:function(){var a=this;this.$http.get("/api/things").then(function(b){a.awesomeThings=b.data,a.socket.syncUpdates("thing",a.awesomeThings)})}},{key:"addThing",value:function(){this.newThing&&(this.$http.post("/api/things",{name:this.newThing}),this.newThing="")}},{key:"deleteThing",value:function(a){this.$http["delete"]("/api/things/"+a._id)}},{key:"goTo",value:function(a){this.$state.go(a)}}]),a}();angular.module("petalApp").component("main",{templateUrl:"app/main/main.html",controller:a,controllerAs:"mainCtrl"})}(),angular.module("petalApp").config(["$stateProvider",function(a){a.state("main",{url:"/",template:"<main></main>"})}]),angular.module("petalApp").controller("MemoDocController",["$scope","TimelineUtils","TimelineTaskService","Util","$timeout","$state","Modal","$rootScope","$stateParams","TaskPriority","SiteService","BaseObjectService","MemoService","Auth",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){a.selectedMemo.memoColor=b.memoColor}function p(){a.selectedMemo.memoColor=null,a.selectedMemo.childIndex=null,a.selectedMemo.isChildMemo=!1,a.selectedMemo.parentMemo=null}function q(){for(var b=0;b<a.selectedMemo.childMemos.length;b++)a.selectedMemo.childMemos[b].childIndex=b+1;m.updateChildMemoIndex(a.selectedMemo.childMemos)}function r(b){a.savingEdits=!0,a.showSaved=null;var c=_.cloneDeep(b);a.newMemo?s(c):(console.log("update",_.cloneDeep(c)),m.updateMemo(c._id,c).then(function(b){a.showSaved="Update successful.",a.enabledFields=null,a.selectedMemo=b.data,x(),a.editedFieldsCount=0,e(function(){a.editedFields=null,e(function(){a.showSaved=null},2500)},1500)})["catch"](function(b){console.error("err: ",b),a.saveEditsError="Error saving these changes."})["finally"](function(){a.savingEdits=!1}))}function s(b){a.savingEdits=!0,a.showSaved=null,console.log("task to save: ",b),m.createMemo(b).then(function(b){a.showSaved="Created memo.",a.enabledFields=null,a.editedFieldsCount=0,a.selectedMemo=b.data,e(function(){a.editedFields=null,e(function(){a.showSaved=null},2500),x()},1500),f.go("memo.doc",{memoId:a.selectedMemo._id},{notify:!1,reload:!1,location:"replace"})})["catch"](function(b){console.error("err: ",b),a.saveEditsError="Error saving these changes."})["finally"](function(){a.savingEdits=!1,a.newMemo=!1})}function t(){var c=b.taskPriorities,d=[];_.map(c,function(a){var b=[];b.push(a.color);var c=j.getSubColors(a["class"]);_.map(c,function(a){b.push(a.color)}),d.push(b)}),d&&d.length>0&&(a.colorItems=d),console.log("color",a.colorItems)}function u(){function c(){n.hasRole("admin",function(a){return console.log("has role!",a),a?d():f.go("login")})}function d(){i.memoId?m.getEditMemo(i.memoId).then(function(b){a.selectedMemo=b,console.log("load",_.cloneDeep(b)),x()})["catch"](function(a){console.log("err: ",a)}):v()}a.memoCopy={},a.dimOut=!1,a.memoPriorities=b.taskPriorities,a.memoTypes=m.memoTypes,a.savingEdits=!1,a.saveEditsError=null,a.errorField=null,a.showSaved=null,a.selectedMemo={},a.editedFieldsCount=0,a.enabledFields=null,a.editedFields=null,t(),n.loggingIn?(y=h.$on("logged-in",function(){y(),c()}),z=h.$on("logged-out",function(){_.isFunction(y)&&y(),z(),f.go("login")})):c()}function v(){a.enabledFields={},a.saveEditsError=null,a.enabledFields.title=!0,a.enabledFields.priority=!0,a.enabledFields.memoType=!0,a.enabledFields.timeEstimate=!0,a.enabledFields.notes=!1,a.editedFields=null,a.subPriorities=j.getSubColors("normal"),a.newMemo=!0,w()}function w(){a.selectedMemo.leftBarColor||(console.log("no left bar"),a.selectedMemo.leftBarColor={type:"pre-defined",customColor:null,selectedColor:"#4CAF50"}),a.selectedMemo.rightBarColor||(console.log("no right bar"),a.selectedMemo.rightBarColor={}),a.selectedMemo.titleTextColor||(console.log("no text color"),a.selectedMemo.titleTextColor={type:"custom",customColor:"#555555",selectedColor:"#555555"}),a.selectedMemo.memoBarColor||(console.log("no bar color"),a.selectedMemo.memoBarColor={type:"custom",customColor:"#ffffff",selectedColor:"#ffffff"})}function x(){if(t(),w(),a.editedFieldsCount=0,a.editedFields=null,a.newMemo=!1,a.parentMemo=null,a.editedChildMemos=!1,a.selectedMemo.memoTypeFormatted||(a.selectedMemo.memoTypeFormatted=m.formatMemoType(a.selectedMemo.memoType)),a.memoCopy=_.cloneDeep(a.selectedMemo),"child-memo"===a.selectedMemo.memoType&&a.selectedMemo.parentMemo){var b=a.selectedMemo.parentMemo;b._id?(a.selectedMemo.parentMemo=b._id,a.parentMemoInfo=_.cloneDeep(b)):m.getMemoById(b).then(function(b){var c=b.data;a.selectedMemo.parentMemo=c._id,a.parentMemoInfo=_.cloneDeep(c)})["catch"](function(a){console.log("err: ",a)})}a.selectedMemo.childMemos&&a.selectedMemo.childMemos.length&&a.selectedMemo.childMemos.sort(function(a,b){return a.childIndex-b.childIndex}),a.subPriorities=j.getSubColors(a.selectedMemo.priority)}var y,z;a.goBack=function(b){a.dimOut=!0,C(),a.checkNotesChanged(),e(function(){b||a.revertMemo(),e(function(){f.go("memo")},300)},150)},a.editorStyle={width:"256px"};var A={small:"256px",medium:"311px",large:"350px"};a.selectedSize="small",a.changeEditorSize=function(b){a.editorStyle.width=A[b],a.selectedSize=b},a.enableField=function(b){a.enabledFields||(a.enabledFields={}),"priority"===b?a.editedFields&&!a.editedFields.priority?a.enabledFields[b]=!a.enabledFields.priority:a.enabledFields[b]=!a.enabledFields.priority:a.enabledFields[b]=!0},a.editField=function(b,c){a.editedFields||(a.editedFields={}),b===a.errorField&&(a.errorField=null,a.saveEditsError=null),a.editedFields[b]||(a.editedFields[b]=!0,a.editedFieldsCount++),"memoType"===b&&(a.selectedMemo.memoTypeFormatted=m.formatMemoType(a.selectedMemo.memoType),a.errorField=null,a.saveEditsError=null,a.selectedMemo.isChildMemo&&"child-memo"!==a.selectedMemo.memoType&&p()),"childMemos"===b&&q(),"custom-color"===c&&(a.selectedMemo[b].type="custom",a.selectedMemo[b].customColor||(a.selectedMemo[b].customColor="#1B5E20"),a.selectedMemo[b].selectedColor=a.selectedMemo[b].customColor)};var B;a.saveOldNotes=function(){B=_.clone(a.selectedMemo.notes)},a.checkNotesChanged=function(){B!=a.selectedMemo.notes&&(a.editField("notes"),B=_.clone(a.selectedMemo.notes))},a.addImage=function(){g.show.taskImage(function(b){a.selectedMemo.images||(a.selectedMemo.images=[]);var c=a.selectedMemo.images.indexOf(b);c<0&&(a.selectedMemo.images.push(b),a.editField("images"))})()},a.selectParent=function(){a.hideTaskView=!0,h.$emit("select-parent-memo")};var C=h.$on("selected-parent-memo",function(b,c){if(c&&c._id!==a.selectedMemo._id){var d=c;a.selectedMemo.isChildMemo=!0,a.selectedMemo.parentMemo=d._id,a.parentMemoInfo=d,d.childMemos&&d.childMemos.length?a.selectedMemo.childIndex=d.childMemos.length+1:a.selectedMemo.childIndex=1,o(d),a.editField("parentMemo")}a.hideTaskView=!1});a.removeParentMemo=function(){g.confirm["delete"](function(){a.editField("parentMemo"),a.selectedMemo.parentMemo=null,a.parentMemoInfo=null,p()})("this memo's parent memo.")},a.deleteChildMemo=function(b){g.confirm["delete"](function(){m.deleteMemo(b._id).then(function(c){var d=_.findIndex(a.selectedMemo.childMemos,function(a){return a._id===b._id});d&&(a.selectedMemo.childMemos.splice(d,1),a.editField("childMemos")),q()})})("the child memo: "+b.title)},a.removeImage=function(b){g.confirm["delete"](function(){var c=a.selectedMemo.images.indexOf(b);c>-1&&a.selectedMemo.images.splice(c,1)})("this image")},a.copiedText=function(b,c){a.copied=c,e(function(){a.copied=""},2e3)},a.changePriority=function(b){a.enabledFields&&a.enabledFields.priority&&b.label!==a.selectedMemo.priority&&(a.editField("priority"),a.selectedMemo.priority=b["class"],a.subPriorities=j.getSubColors(b["class"]),a.enabledFields.subPriority=!0,a.selectedMemo.subPriority||(a.selectedMemo.subPriority=a.subPriorities[4]))},a.selectSubPriority=function(b){a.editedFields||(a.editedFields={}),a.enabledFields?a.enabledFields.subPriority=!a.enabledFields.subPriority:(a.enabledFields={},a.enabledFields.subPriority=!0),a.editedFields.subPriority=!0,a.selectedMemo.subPriority=b},a.revertMemo=function(){a.editedFields&&(a.selectedMemo=_.cloneDeep(a.memoCopy),e(function(){a.editedFields=null,a.enabledFields=null,a.editedFieldsCount=0,_.isEmpty(a.selectedMemo)?v():x()},100))},a.deleteMemo=function(){var b="Memo: "+a.selectedMemo.title;g.confirm["delete"](function(){var b=_.cloneDeep(a.selectedMemo);m.deleteMemo(a.selectedMemo._id).then(function(c){a.goBack(!0),h.$emit("deleted-task",b._id),e(function(){a.selectedMemo=null},500)})["catch"](function(a){console.log("err: ",a)})})(b)},a.saveMemo=function(){if(console.log("selected",a.selectedMemo),a.editedFields&&!a.savingEdits){var b=m.checkMemoFields(a.selectedMemo);b.field?(a.savingEdits=!1,a.saveEditsError=b.message,a.errorField=b.field):r(a.selectedMemo)}},u(),a.isSelectedColorType=function(b,c){return!!a.selectedMemo[b]&&a.selectedMemo[b].type===c},a.changeColorType=function(b,c){var d=!1;a.editField(b),a.selectedMemo[b]&&(a.selectedMemo[b].type===c?(a.selectedMemo[b]={type:null,customColor:null,selectedColor:null},d=!0):e(function(){a.selectedMemo[b].type=c}),"custom"===c?d||(a.selectedMemo[b].customColor||(a.selectedMemo[b].customColor="#1B5E20"),a.selectedMemo[b].selectedColor=a.selectedMemo[b].customColor):"rightBarColor"!==b||"pre-defined"!==c||d||(a.selectedMemo[b].selectedColor="#03A9F4"))},a.isColorSelected=function(b,c){return!!a.selectedMemo[b]&&("pre-defined"===a.selectedMemo[b].type&&a.selectedMemo[b].selectedColor===c)},a.selectColor=function(b,c){a.selectedMemo[b]&&(a.selectedMemo[b].type="pre-defined",a.selectedMemo[b].selectedColor=c,a.editField(b))}}]),angular.module("petalApp").config(["$stateProvider",function(a){a.state("memo",{url:"/memo",templateUrl:"app/memo/memo.main.html",controller:"MemoMainController",authenticate:"user"}),a.state("memo.doc",{url:"/memo/doc/:memoId",templateUrl:"app/memo/memo.doc.html",controller:"MemoDocController"})}]),angular.module("petalApp").controller("MemoMainController",["$scope","$state","MemoService","$rootScope","Auth","Modal","$timeout","socket",function(a,b,c,d,e,f,g,h){function i(){if(a.currentUser=e.getCurrentUser(),!a.currentUser||!a.currentUser.role)var b=d.$on("logged-in",function(c,d){a.currentUser=d,b()})}function j(b){_.map(b,function(a){var b=a._id.toString().substring(0,8);return a.createdDate=new Date(1e3*parseInt(b,16)),a.childMemos&&a.childMemos.length&&(a.childrenHeight=72*a.childMemos.length+72+"px",a.childMemos.sort(function(a,b){return a.childIndex-b.childIndex}),_.map(a.childMemos,function(a){var b=a._id.toString().substring(0,8);return a.createdDate=new Date(1e3*parseInt(b,16)),a})),a}),a.allMemos=k(b),l(a.allMemos)}function k(a){return _.sortBy(a,"parentIndex")}function l(a){v?(h.unsyncUpdates("memo"),h.syncUpdates("memo",a,m)):(h.syncUpdates("memo",a,m),v=!0)}function m(a,b){console.log("event",a),console.log("item",b),"deleted"===a?t(b):"updated"===a?n(b):"add"===a&&o(b)}function n(b){var c=_.find(a.allMemos,function(a){return a._id===b._id});c&&(b.childMemos&&b.childMemos.length&&(b.childrenHeight=72*b.childMemos.length+72+"px",b.childMemos.sort(function(a,b){return a.childIndex-b.childIndex})),_.merge(c,b),c.flashUpdate=!0,g(function(){delete c.flashUpdate},2400),p(c))}function o(b){if(b.isChildMemo){var c=b.parentMemo,d=_.find(a.allMemos,function(a){return a._id===c});if(d){var e=_.findIndex(d.childMemos,function(a){return a._id===b._id});e>-1?(_.merge(d.childMemos[e],b),d.childMemos[e].flashUpdate=!0,g(function(){delete d.childMemos[e].flashUpdate},2400)):(b.flashUpdate=!0,d.childMemos.push(b),d.childrenHeight=72*d.childMemos.length+72+"px",d.childMemos.sort(function(a,b){return a.childIndex-b.childIndex}),g(function(){delete b.flashUpdate},2400))}}else{var f=_.findIndex(a.allMemos,function(a){return a._id===b._id});f>-1?(b.flashUpdate=!0,_.merge(a.allMemos[f],b),g(function(){delete a.allMemos[f].flashUpdate},2400)):(b.flashUpdate=!0,a.allMemos.push(b),g(function(){delete b.flashUpdate},2400))}p(b)}function p(b){var c=q(b.parentMemo),d=q(b.previousParentMemo);b.parentMemo?(console.log("change parent"),d!==c&&d&&r(b,d),s(b,c)):b.previousParentMemo&&(console.log("change parent"),d!==c&&r(b,d));var e=_.findIndex(a.allMemos,{_id:b._id});e>-1&&b.isChildMemo&&(console.log("remove from normal list"),a.allMemos.splice(e,1)),_.map(a.allMemos,function(a){if(a._id!==c){var d=_.findIndex(a.childMemos,{_id:b._id});d>-1&&r(b,a._id)}return a})}function q(a){return a&&a._id?a._id:a}function r(b,c){var d=_.findIndex(a.allMemos,{_id:c});if(d>-1){var e=_.findIndex(a.allMemos[d].childMemos,{_id:b._id});e>-1&&a.allMemos[d].childMemos.splice(e,1),a.allMemos[d].childrenHeight=72*a.allMemos[d].childMemos.length+72+"px",a.allMemos[d].childMemos.sort(function(a,b){return a.childIndex-b.childIndex})}}function s(b,c){var d=_.findIndex(a.allMemos,{_id:c});if(d>-1){var e=_.findIndex(a.allMemos[d].childMemos,{_id:b._id});e===-1&&a.allMemos[d].childMemos.push(b),a.allMemos[d].childrenHeight=72*a.allMemos[d].childMemos.length+72+"px",a.allMemos[d].childMemos.sort(function(a,b){return a.childIndex-b.childIndex})}}function t(b){if(b.isChildMemo){var c=_.find(a.allMemos,function(a){return a._id===b.parentMemo});if(c){var d=_.findIndex(c.childMemos,function(a){return a._id===b._id});d>-1&&(c.childMemos.splice(d,1),c.childMemos.length>0?c.childrenHeight=72*c.childMemos.length+72+"px":c.childrenHeight="55px")}}else{var e=_.findIndex(a.allMemos,function(a){return a._id===b._id});e>-1&&a.allMemos.splice(e,1)}}a.selectedMemo=null;var u,v=!1;a.sortDisabled=!0,c.getAllMemos().then(function(a){a.data&&j(a.data)})["catch"](function(a){console.log("err",a)}),a.selectMemo=function(b){a.showSelectPrompt&&!b.isChildMemo?a.selectedParentMemo===b?a.selectedParentMemo=null:a.selectedParentMemo=b:a.selectedMemo===b?a.selectedMemo=null:a.selectedMemo=b},a.toggleChildren=function(a){a.showChildren=!a.showChildren},a.updateParentSorts=function(){for(var b=0;b<a.allMemos.length;b++)a.allMemos[b].parentIndex=b+1;c.updateParentMemoIndex(a.allMemos)},a.disableSort=function(){return a.sortDisabled},a.toggleSort=function(){a.showSelectPrompt?a.sortDisabled=!0:a.sortDisabled=!a.sortDisabled},a.editMemo=function(){a.sortDisabled=!0,u=_.cloneDeep(a.selectedMemo),c.setEditMemo(u),b.go("memo.doc",{memoId:u._id})},a.deleteMemo=function(){var b="Memo: "+a.selectedMemo.title;f.confirm["delete"](function(){var b=_.cloneDeep(a.selectedMemo),d="parent-memo"===b.memoType;c.deleteMemo(a.selectedMemo._id,d).then(function(c){a.selectedMemo=null,g(function(){t(b)})})["catch"](function(a){console.log("err: ",a)})})(b)},d.$on("select-parent-memo",function(){a.selectedMemo=null,a.showSelectPrompt=!0,a.selectedParentMemo=null,a.sortDisabled=!0}),a.confirmSelect=function(){d.$emit("selected-parent-memo",a.selectedParentMemo),a.showSelectPrompt=!1,a.selectedParentMemo=null},a.cancelSelect=function(){d.$emit("selected-parent-memo",null),a.showSelectPrompt=!1,a.selectedParentMemo=null},a.addMemo=function(){a.sortDisabled=!0,b.go("memo.doc")},a.currentUser||i()}]),angular.module("petalApp").service("MemoService",["$http","$q",function(a,b){function c(a){var b={field:null,message:""};return a.priority||(a.priority="normal"),a.subPriority||(a.subPriority={color:"#4CAF50",sortLevel:14}),a.title&&a.title.length?a.memoType?"child-memo"!==a.memoType||a.parentMemo?b:{field:"parentMemo",message:"Please select a parent memo."}:(b.field="memoType",b.message="Please select the type of memo.",b):(b.field="title",b.message="Please include a memo name.",b)}function d(a){if(a){var b=a.split("-");return b[0]+" "+b[1]}return a}var e=null,f=[{value:void 0,name:"--Please select--"},{value:"parent-memo",name:"Parent Memo"},{value:"child-memo",name:"Child Memo"}],g=function(){return a({method:"GET",url:"/api/memos/"})},h=function(b){return a({method:"POST",url:"/api/memos/",data:b})},i=function(b,c){return a({method:"PUT",url:"/api/memos/"+b,data:c})},j=function(b){return a({method:"GET",url:"/api/memos/"+b})},k=function(b,c){return a({method:"DELETE",url:"/api/memos/"+b})},l=function(a){e=a},m=function(a){var c=b.defer();return e&&e._id===a?c.resolve(e):j(a).then(function(a){e=a.data,c.resolve(e)})["catch"](function(a){e=null,
c.reject(a)}),c.promise},n=function(b){var c=_.map(b,function(a){return _.pick(a,"_id","childIndex")});_.forEach(c,function(b){a({method:"PUT",url:"/api/memos/"+b._id,data:b})}),console.log("childRen: ",c)},o=function(b){var c=_.map(b,function(a){return _.pick(a,"_id","parentIndex")});_.forEach(c,function(b){a({method:"PUT",url:"/api/memos/"+b._id,data:b})}),console.log("parents: ",c)};return{getAllMemos:g,createMemo:h,updateMemo:i,getMemoById:j,deleteMemo:k,setEditMemo:l,getEditMemo:m,checkMemoFields:c,formatMemoType:d,updateChildMemoIndex:n,updateParentMemoIndex:o,memoTypes:f}}]),angular.module("petalApp").service("TaskPriority",function(){var a={critical:["b71c1c","c62828","d32f2f","e53935","f44336","ef5350","e57373","ef9a9a","ffcdd2"],important:["E65100","EF6C00","F57C00","FB8C00","FF9800","FFA726","FFB74D","FFCC80","FFE0B2"],normal:["1B5E20","2E7D32","388E3C","43A047","4CAF50","66BB6A","81C784","A5D6A7","C8E6C9"],nice:["01579B","0277BD","0288D1","039BE5","03A9F4","29B6F6","4FC3F7","81D4FA","B3E5FC"]},b={critical:36,important:27,normal:18,nice:9},c={};return this.initPriorities=function(){c=_.mapValues(a,function(a,c){var d=b[c];return _.map(a,function(a,b){return{color:"#"+a,sortLevel:d-b}})})},this.getPriorityObj=function(){return c},this.getSubColors=function(a){return c[a]},this.getDefaultSubPriority=function(a){var b=c[a];return b?b.length>5?b[4]:b.length?b[0]:{color:"#4CAF50",sortLevel:14}:{color:"#4CAF50",sortLevel:14}},this.correctSub=function(c){var d=a[c.priority];if(d){var e=c.subPriority.color.slice(1);return d.indexOf(e)>-1||{color:"#"+d[4],sortLevel:b[c.priority]-4}}return!0},this}),angular.module("petalApp").service("TimelineTaskService",["$http","$q","$rootScope",function(a,b,c){var d=null,e=function(b){return a({method:"POST",url:"/api/timelineTasks/buildRoomTasks",data:b})},f=function(b,c,d){var e={room:b,fromDate:c,inPeriod:d};return a({method:"POST",url:"/api/timelineTasks/buildCycleTasks",data:e})},g=function(b){return a({method:"POST",url:"/api/timelineTasks/generateTasksFromTimeline",data:b})},h=function(b){return a({method:"POST",url:"/api/timelineTasks/checkTLDates",data:b})},i=function(c){var d=_.cloneDeep(c),e=b.defer();return d.weekFlag&&(d.occurrenceObj.occurrenceDay.value=7*d.occurrenceObj.occurrenceDay.value+1,delete d.weekFlag),console.log("masterTask",d),a({method:"POST",url:"/api/masterTimeline/",data:d}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a.message)}),e.promise},j=function(b){return a({method:"PUT",url:"/api/masterTimeline/"+b._id,data:b})},k=function(b){return a({method:"GET",url:"/api/timelineTasks/"+b})},l=function(){return a({method:"GET",url:"/api/masterTimeline/"})},m=function(b,c){var d=_.cloneDeep(c);return d.site&&d.site._id&&(d.site=d.site._id),delete d.roomDetails,delete d.masterTask,c.occurrenceDate&&c.occurrenceDate._d?d.occurrenceDate=new Date(c.occurrenceDate._d):c.occurrenceDate&&(d.occurrenceDate=new Date(c.occurrenceDate)),a({method:"PUT",url:"/api/timelineTasks/"+b,data:d})},n=function(b){return a({method:"POST",url:"api/timelineTasks/restoreTask/"+b})},o=function(b,d,e){return a({method:"DELETE",url:"api/timelineTasks/"+b}).success(function(){"masterTimeline"!=e&&c.$emit("remove-task",{taskId:b,roomId:d})})},p=function(b){return a({method:"POST",url:"/api/timelineTasks/",data:b})},q=function(b){return a({method:"POST",url:"/api/timelineTasks/timelineQuery",data:b})},r=function(b){return a({method:"POST",url:"/api/timelineTasks/reoccurringTest",data:b})},s=function(b){return a({method:"POST",url:"/api/timelineTasks/newReoccurringTask",data:b})},t=function(b){return a({method:"POST",url:"/api/timelineTasks/bulkUpdate",data:b})},u=function(b){return a({method:"POST",url:"/api/timelineTasks/bulkDelete",data:b})},v=function(a){d=a},w=function(a){var c=b.defer();return d&&d._id===a?c.resolve(d):k(a).then(function(a){d=a.data,c.resolve(d)})["catch"](function(a){d=null,c.reject(a)}),c.promise},x=function(b){var c=_.map(b,function(a){return _.pick(a,"_id","childIndex")});_.forEach(c,function(b){a({method:"PUT",url:"/api/timelineTasks/"+b._id,data:b})}),console.log("childRen: ",c)},y=function(b){return a({method:"POST",url:"/api/timelineTasks/timelines/newTimeline",data:b})},z=function(b){return a({method:"DELETE",url:"/api/timelineTasks/timelines/"+b})},A=function(b){return a({method:"POST",url:"/api/timelineTasks/timelines/updateTimeline/"+b._id,data:b})},B=function(b,c){return a({method:"POST",url:"/api/timelineTasks/timelines/copyToTimelines",data:{copyToIds:b,taskToCopy:c}})},C=function(){return a({method:"GET",url:"/api/timelineTasks/timelines/getAllTimelines"})},D=function(b,c){return a({method:"POST",url:"/api/timelineTasks/timelines/copyMasterTL",data:{copyToTL:c,inPeriod:b}})};return{buildTimelineTasks:e,buildCycleTasks:f,generateTasksFromTimeline:g,createTask:p,updateTask:m,deleteTask:o,restoreTask:n,saveNewMasterTask:i,getAllMasterTasks:l,timelineTaskQuery:q,updateMasterTask:j,setEditTask:v,getEditTask:w,newReoccurringTask:s,bulkTaskUpdate:t,checkTLDates:h,bulkTaskDelete:u,reoccurringTest:r,updateChildTaskIndex:x,newTimeline:y,updateTimeline:A,deleteTimeline:z,getAllTimelines:C,copyToTimelines:B,copyMasterTL:D}}]),angular.module("petalApp").service("TimelineUtils",["$q","Util",function(a,b){function c(a,b,c,f,g){var i,j,k,l=a.occurrenceObj,m=a.occurrenceInfo,n=!1,o={taskWeek:null,taskDay:null,inPeriod:null},p=!1;if("veg"===l.type)k=b,p=f;else if("flower"===l.type)k=c,p=g;else if("na"===l.type){if(console.log("na occurrence",l),n=!0,m)return{taskDay:m.selectedTime.day,taskWeek:m.selectedTime.week,inPeriod:null}}else if("finalize"===l.type&&(n=!0,m))return{taskDay:m.selectedTime.day,taskWeek:m.selectedTime.week,inPeriod:"finalize"};if(i="percent"!=l.occurrenceDay.type||p||n?l.occurrenceDay.value:h(l.occurrenceDay.value,l.type,k),"veg"===l.type)j=d(i),o.taskDay=j.day,o.taskWeek=j.week,o.inPeriod="veg";else if("flower"===l.type)j=d(i),o.inPeriod="flower",o.taskDay=j.day,o.taskWeek=j.week;else if("event"===l.type){var q=e(l,b,c);o.timeline=q.timeline,o.day=q.dayAndWeek.day,o.week=q.dayAndWeek.week}return o}function d(a){var b={day:null,week:null};return a>7?(b.week=Math.ceil(a/7),b.day=Math.round(a%7),b.day||(b.day=7)):b={day:a,week:1},b}function e(a,b,c){var e,g,h;g="percent"==a.occurrenceDay.type?f(a.occurrenceDay.value,b+c):a.occurrenceDay.value;var i=a.relationshipType,j=a.event;return"before"==i&&"start-of-room"==j?(e="pre-start",h=d(g)):"after"==i&&"end-of-room"==j?(e="room-finished",h=d(g)):"after"==i&&"start-of-room"==j?g<=b?(e="room-start",h=d(g)):g<=b+c?(e="room-flipped",h=d(g-b)):(e="room-finished",h=d(g-(b+c))):"before"==i&&"lights-flipped-to-flower"==j?b-g>=0?(e="room-start",h=d(b-g)):(e="pre-start",h=d(g-b)):"after"==i&&"lights-flipped-to-flower"==j?g<=c?(e="room-flipped",h=d(g)):(e="room-finished",h=d(g-c)):"before"==i&&"end-of-room"==j&&(c-g>=0?(e="room-flipped",h=d(c-g)):c+b-g>=0?(e="room-start",h=d(g-c)):(e="pre-start",h=d(g-(c+b)))),{timeline:e,dayAndWeek:h}}function f(a,b,c){}function g(a,c,e,f){var g,h,j,k=moment(c),l=(moment(a),{});console.log("find task info",arguments),j=a._isAMomentObject||a._d?moment(b.standardizeDate(a._d)):moment(b.standardizeDate(a));var m=Math.round(j.diff(k,"days",!0)),n=i(_.clone(c),_.clone(e),_.clone(f));return g=e?moment(e):moment(k).add(3,"weeks"),g?(moment(a).isSameOrAfter(g,"day")?(l.inPeriod="flower",m=j.diff(g,"days")):l.inPeriod="veg",m+=1,h=d(m),l.taskWeek=h.week,l.taskDay=h.day,l):(m>n.vegLength?(l.inPeriod="flower",m=Math.round(j.diff((k.add(n.vegLength,"days"),!0)))):l.inPeriod="veg",m+=1,h=d(m),l.taskWeek=h.week,l.taskDay=h.day,console.log("return: ",l),l)}function h(a,b,c){var d=y[b].periodLength,e=a/d;return Math.ceil(e*c)}function i(a,b,c){var d,e;return b?(d=moment(b).diff(moment(a),"days"),e=moment(c).diff(moment(b),"days")):(d=21,e=56),{vegLength:d,flowerLength:e}}function j(a,b,c){var d,e=a.taskWeek-1,f=7*e+(a.taskDay-1);return d="flower"!=a.inPeriod||c?"flower"==a.inPeriod&&c?moment(c):moment(b):moment(b).add(3,"weeks"),a.occurrenceDate=d.add(f,"days"),a}function k(b){var c=a.defer(),d=b.filter(function(a){return a.timelines.length>0}),e=[];return d.map(function(a){a.timelines.map(function(b){b.timelineTasks.map(function(b){b.tunnel=a.name,b.siteShortName=a.siteShortName,b.roomDetails=a,b.tunnelShortName=a.tunnelShortName,e.push(b)})})}),c.resolve(e),c.promise}function l(a){return a.map(function(a){if(a.site&&a.name){var b=a.site.name.replace("Operation ","");b<10&&(b="0"+b);var c=a.room.name.replace("Tunnel ","");c<10&&(c="0"+c),a.tunnel=a.room.name,a.siteShortName="CL"+b,a.roomDetails=a.room,a.tunnelShortName="T"+c}else a.tunnel=null,a.siteShortName=null,a.roomDetails=null,a.tunnelShortName=null;return a})}function m(a){console.log("task: ",a);var b=a.occurrenceObj,c=[];"veg"!==b.type&&"flower"!==b.type||(c=n(b.type));var e;e="na"===b.type||"finalize"===b.type?{week:a.occurrenceInfo.selectedTime.week,day:a.occurrenceInfo.selectedTime.day}:d(b.occurrenceDay.value);for(var f={week:e.week,day:e.day},g=[],h=1;h<8;h++)g.push({value:h,name:h});return{stageWeeks:c,selectedTime:f,stageDays:g}}function n(a){if(a){for(var b=[],c=z[a].weeks,d=1;d<=c;d++)b.push({value:d,name:d});return b}return null}function o(a,b){return a.getUTCFullYear()==b.getFullYear()&&a.getUTCMonth()==b.getUTCMonth()&&a.getUTCDate()==b.getUTCDate()}function p(a){var b={field:null,message:""};return"x-check"!==a.taskType&&"daily-check"!==a.taskType&&"child-task"!==a.taskType?(a.title&&a.title.length?a.occurrenceObj.type?a.occurrenceInfo.selectedTime.week?a.occurrenceInfo.selectedTime.day?a.taskType||(b.field="taskType",b.message="Please select the type of task."):(b.field="occurrenceObjDay",b.message="Please select a day."):(b.field="occurrenceObjWeek",b.message="Please select a week."):(b.field="occurrenceObjType",b.message="Please select a period."):(b.field="title",b.message="Please include a title."),"tunnel-timeline"!==a.taskType||a._id||a.taskTLTemplate||(b.field="taskTLTemplate",b.message="Please select a Timeline Template."),b):"child-task"===a.taskType?(a.title&&a.title.length?a.parentTask||(b.field="parentTask",b.message="Please select a parent task."):(b.field="title",b.message="Please include a title."),b):(a.title&&a.title.length?a.taskType||(b.field="taskType",b.message="Please select the type of task."):(b.field="title",b.message="Please include a title."),b)}function q(a){var b={field:null,message:""};return a.priority||(a.priority="normal"),a.subPriority||(a.subPriority={color:"#4CAF50",sortLevel:14}),a.title&&a.title.length?a.taskType?"daily-check"===a.taskType||"x-check"===a.taskType||"child-task"===a.taskType||a.occurrenceDate?"x-check"!==a.taskType||a.taskRepeatCustom||a.taskRepeatPreset||a.taskRepeatDays?"admin-assigned"===a.taskType||"child-task"===a.taskType||a.site?"child-task"!==a.taskType||a.parentTask?b:{field:"parentTask",message:"Please select a parent task."}:b={field:"site",message:"Please specify where this task goes."}:b={field:"taskRepeat",message:"Please specify when the task repeats."}:(b.field="occurrenceDate",b.message="Please specify a date.",b):(b.field="taskType",b.message="Please select the type of task.",b):(b.field="title",b.message="Please include a title.",b)}function r(a){if(a.priority||(a.priority="normal"),a.subPriority||(a.subPriority={color:"#4CAF50",sortLevel:14}),"x-check"!==a.taskType&&"daily-check"!==a.taskType&&"child-task"!==a.taskType){var b=a.occurrenceObj;return a.priority||(a.priority="normal"),b&&b.type?("veg"!==b.type&&"flower"!==b.type||(delete a.occurrenceObj.relationshipType,delete a.occurrenceObj.relatedTo,delete a.occurrenceObj.event,delete a.occurrenceDate,delete a.weekFlag,delete a.taskDay,delete a.taskWeek),a.occurrenceInfo.selectedTime&&a.occurrenceInfo.selectedTime.week&&a.occurrenceInfo.selectedTime.day?(a.occurrenceObj.occurrenceDay||(a.occurrenceObj.occurrenceDay={type:"percent"}),a.occurrenceObj.occurrenceDay.value=K(a.occurrenceInfo.selectedTime.day,a.occurrenceInfo.selectedTime.week),a):a.occurrenceInfo.selectedTime&&a.occurrenceInfo.selectedTime.week?{buildError:!0,field:"occurrenceObjDay",message:"Please specify a day."}:{buildError:!0,field:"occurrenceObjWeek",message:"Please specify a week."}):{buildError:!0,field:"occurrenceObjType",message:"Please specify when the task occurs."}}if(delete a.occurrenceObj,"x-check"===a.taskType){if(!a.taskRepeatCustom&&!a.taskRepeatPreset&&!a.taskRepeatDays)return{buildError:!0,field:"taskRepeat",message:"Please specify when the task repeats."}}else if("child-task"===a.taskType&&!a.parentTask)return{buildError:!0,field:"parentTask",message:"Please select a parent task."};return a}function s(a,b){var c=_.cloneDeep(a);if(c.site&&c.site._id&&(c.site=a.site._id),c.room&&c.room._id&&(c.room=a.room._id),a.priority||(c.priority="normal"),b&&a.room){var d=g(c.occurrenceDate,a.room.startDate,a.room.flippedDate,a.room.endDate);_.extend(c,d)}else a.room||(c.inPeriod=null,c.taskWeek=null,c.taskDay=null);return c}function t(a){if(a){var b=a.split("-");return b[0]+" "+b[1]}return a}function u(a){return C[a]}function v(a){var b="";if("daily-check"==a.taskType)b="Daily";else if("x-check"==a.taskType){if(a.taskRepeatCustom)b="Every "+a.taskRepeatCustom+" days";else if(a.taskRepeatPreset&&a.taskRepeatPreset.length)b=a.taskRepeatPreset;else if(a.taskRepeatDays)for(var c=0;c<a.taskRepeatDays.length;c++)b+=M[a.taskRepeatDays[c]]}else b="Custom";return b}function w(a,b){if(!b.timeEstimate)return null;var c,d="room",e=1;if(b.timeEstimate.per)if(c=b.timeEstimate.per,d=B[c],"room"==d)!a&&b.site&&b.site.rooms&&(e=b.site.rooms.length);else if("operation"!=d){if(!a||!a[d])return null;e=a[d]}if(!b.timeEstimate.amount)return null;var f=b.timeEstimate.amount*e;return x(f,b.timeEstimate.unit)}function x(a,b){var c={min:0,hr:0};return"hour"==b&&(a=60*a),60==a?c.hr=1:a<60?c.min=a:(c.hr=Math.ceil(a/60),c.min=a%60),c}var y={veg:{periodLength:21,percent:21/77},flower:{periodLength:56,percent:56/77}},z={flower:{weeks:8},veg:{weeks:3}},A=[{label:"Mission Critical",color:"#EB1C24","class":"critical"},{label:"Important",color:"#F6931E","class":"important"},{label:"Generally Expected",color:"#38B349","class":"normal"},{label:"Nice to have",color:"#00ADEF","class":"nice"}],B={plant:"amountOfPlants",light:"amountOfLights",reservoir:"amountOfReservoirs",table:"amountOfTables",room:"room",operation:"operation",undefined:"room"},C={"tunnel-timeline":"#006737","daily-check":"#FF8B00","x-check":"#724628","admin-assigned":"#231F20","child-task":"",undefined:"#F1F3F2"},D=[{value:void 0,name:"--Please select--"},{value:"light",name:"Light"},{value:"reservoir",name:"Reservoir"},{value:"plant",name:"Plant"},{value:"room",name:"Room"},{value:"table",name:"Table"}],E=[{value:void 0,name:"--Please select--"},{value:"na",name:"NA"},{value:"finalize",name:"Finalize"},{value:"veg",name:"Veg"},{value:"flower",name:"Flower"}],F=[{value:void 0,name:"--Please select--"},{value:"daily-check",name:"Daily Checks"},{value:"tunnel-timeline",name:"Tunnel Timeline"},{value:"x-check",name:"X Checks"},{value:"admin-assigned",name:"Admin Assigned"},{value:"child-task",name:"Child Task"}],G=[{value:void 0,name:"--Please select--"},{value:"master",name:"Master Template"},{value:"location",name:"Specific Location"}],H=[{value:void 0,name:"--Please select--"},{value:"operation",name:"Operation"},{value:"room",name:"Per Tunnel"}],I=[{value:void 0,name:"--Please select--"},{value:"weekly",name:"Weekly"},{value:"weekdays",name:"Every Weekday (Mon to Fri)"},{value:"weekends",name:"Sat & Sun"}],J=function(a,b,c,d,e){b||(b=e*y[a].percent);var f,g,h=d-1,i=7*h+c,j=i/y[a].periodLength,k=Math.round(j*b);return k>7?(f=Math.ceil(k/7),g=k%7,0==g&&(g=7)):(f=1,g=Math.ceil(k),g||(g=1)),{periodWeek:f,periodDay:g,cycleDay:k}},K=function(a,b){var c=b-1;return 7*c+a},L=function(a,b,d){var e=!b||b==y.veg.periodLength,f=!d||d==y.flower.periodLength;b||(b=y.veg.periodLength),d||(d=y.flower.periodLength);for(var g={"pre-start":{weeks:{},title:"Pre-Start Tasks",subtitle:"Before the room starts.",index:0},"room-start":{weeks:{},title:"Start of Room",subtitle:"Start of Veg Phase",index:1},"room-flipped":{weeks:{},title:"Room flipped to flower",subtitle:"Start of Flower Phase",index:2},"room-finished":{weeks:{},title:"End of Room",subtitle:"End of room.",index:3}},h=0;h<a.length;h++){var i=c(a[h],b,d,e,f);g[i.timeline].weeks[i.week]||(g[i.timeline].weeks[i.week]={tasks:[]}),g[i.timeline].weeks[i.week].tasks.push(i)}return g},M={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thr",5:"Fri",6:"Sat"};return{findTaskOccurrence:J,buildTimeline:L,calculateDayFromPeriodWeek:K,calculateLengths:i,findTaskDate:j,getTasksFromRooms:k,findDayAndWeek:d,placeTask:c,formatRoomTasks:l,sameDay:o,initMasterTaskEdit:m,buildStageWeeks:n,checkMasterFields:p,checkTaskFields:q,buildMasterTask:r,buildTask:s,formatTaskType:t,formatTaskColor:u,findTaskTime:w,formatTaskRepeatString:v,taskPriorities:A,timeEstimatePerOpts:D,occurrenceObjTypeOpts:E,taskTypes:F,taskSaveLocations:G,taskRepeatOpts:I,masterCheckLocations:H}}]),angular.module("petalApp").service("BaseObjectService",baseObjectService),angular.module("petalApp").service("DashboardService",function(){var a;return{setDashboardObj:function(b){a=b},getDashboardObj:function(){return a}}}),angular.module("petalApp").service("MediaService",["$http","$q","Util","Upload",function(a,b,c,d){var e=function(){var a=new Date,b=a.getUTCDate();return c.makeId()+"/"+b+"/"+c.makeId()},f=function(b){var c={bucket:"claritymedia",fileName:b.name,fileType:b.type};return a({method:"POST",url:"https://the-dealer.herokuapp.com/api/aws/sign_aws",data:c})},g=function(a,b){return d.upload({url:"https://claritymedia.s3-us-west-2.amazonaws.com/",method:"POST",data:{key:b.name,AWSAccessKeyId:a.accessKey,acl:"public-read",policy:a.policy,signature:a.signature,"Content-Type":""!=b.type?b.type:"application/octet-stream",file:b}})},h=function(b){return a({method:"POST",url:"/api/media/",data:b})},i=function(){return a({method:"GET",url:"/api/media/"})},j=function(b){return a({method:"PUT",url:"/api/media/"+b._id,data:b})},k=function(b){return a({method:"DELETE",url:"/api/media/"+b._id})};return{renameImageFile:e,getAWSCreds:f,uploadImage:g,newImageUpload:h,allMedia:i,updateMedia:j,deleteMedia:k}}]),angular.module("petalApp").factory("preloader",["$q","$rootScope",function(a,b){function c(b){this.imageLocations=b,this.imageCount=this.imageLocations.length,console.log("count: ",this.imageCount),this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=a.defer(),this.promise=this.deferred.promise}return c.preloadImages=function(a){var b=new c(a);return b.load()},c.prototype={constructor:c,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;for(var a=0;a<this.imageCount;a++)this.loadImageLocation(this.imageLocations[a]);return this.promise},handleImageError:function(a){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(a))},handleImageLoad:function(a){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:a}),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)))},loadImageLocation:function(a){var c=this,d=$(new Image).on("load",function(a){b.$apply(function(){c.handleImageLoad(a.target.src),c=d=a=null})}).on("error",function(a){b.$apply(function(){c.handleImageError(a.target.src),c=d=a=null})}).prop("src",a)}},c}]),angular.module("petalApp").service("SiteService",["$rootScope",function(a){function b(a){return a.map(function(a){if(a.displayName)a.siteShortName=a.displayName;else{var b=a.name.replace("Operation ","");b<10&&(b="0"+b),a.siteShortName="CL"+b}}),a}var c=void 0,d=void 0,e=[];return{setSiteObj:function(a){c=a},getSiteObj:function(){return c},setAllSites:function(c){d=b(c),c.forEach(function(a){e=_.concat(e,a.rooms)}),a.$emit("set-sites",d)},getAllSites:function(){return d},getSiteShortName:function(a){if(a&&a.displayName)return a.displayName;if(a&&a.name){var b=a.name.replace("Operation ","");return b<10&&(b="0"+b),"CL"+b}if(a&&!a.name){var c=_.find(d,["_id",a]);return c?c.displayName?c.displayName:c.siteShortName:"NA"}return"NA"},getTunnelShortName:function(a){if(a&&a.name){var b=a.name.replace("Tunnel ","");return b<10&&(b="0"+b),"T"+b}if(a&&!a.name){var c=_.find(e,["_id",a]);return c?c.tunnelShortName:"NA"}return"NA"},getSiteData:function(a){return _.find(d,function(b){return b._id===a})},getTunnelData:function(a,b){b&&b._id&&(b=b._id),a&&a._id&&(a=a._id);var c=_.find(d,function(b){return b._id===a});if(c&&c.rooms)return _.find(c.rooms,function(a){return a._id===b})}}}]),angular.module("petalApp").service("TLQueryService",function(){return this.buildQuery=function(a){var b={$and:[{$or:[{room:{$in:a.roomIds}},{site:{$in:a.siteIds}}]},{taskType:{$in:a.taskTypes}},{$or:[{checkTemplateObj:{$exists:a.checkTemplateObj}},{checkTemplateObj:{$eq:a.checkTemplateObj}}]},{isMaster:a.isMaster},{TLFromDate:a.TLFromDate},{TLToDate:a.TLToDate}]};return a.hideRooms&&a.hideRooms.length&&b.$and.push({room:{$nin:a.hideRooms}}),a.isMaster?b={$and:[{taskType:{$in:a.taskTypes}},{isMaster:a.isMaster},{taskTLTemplate:a.taskTLTemplate}]}:a.checkTemplateObj&&(b={$and:[{$or:[{room:{$in:a.roomIds}},{site:{$in:a.siteIds}}]},{taskType:{$in:a.taskTypes}},{$and:[{checkTemplateObj:{$exists:a.checkTemplateObj}},{checkTemplateObj:{$eq:a.checkTemplateObj}}]},{isMaster:!1}]},a.hideRooms&&a.hideRooms.length&&b.$and.push({room:{$nin:a.hideRooms}})),a.recentlyDeleted?b.recentlyDeleted=!0:delete b.recentlyDeleted,b},this}),angular.module("petalApp").controller("EditSiteController",["$scope","$state","SiteService","$timeout","Util","BaseObjectService","Modal","DashboardService","TimelineTaskService",function(a,b,c,d,e,f,g,h,i){function j(){_.map(a.site.rooms,function(b){return b.siteShortName=p,b.siteMainColor=a.site.mainColor,b.siteSubColor=a.site.subColor,b.tunnelShortName=c.getTunnelShortName(b),b})}function k(){if(a.siteColorRGB)for(var b=a.siteColorRGB.r,c=a.siteColorRGB.g,d=a.siteColorRGB.b,f=a.site.rooms.length,g=0;g<f;g++){var h=.1+.1*g;h||(h=.1);var i={r:Math.floor(b+(255-b)*h),g:Math.floor(c+(255-c)*h),b:Math.floor(d+(255-d)*h)};a.site.rooms[g].mainColor=e.rgbToHex(i.r,i.g,i.b)}return"red"}function l(){for(var b=0;b<a.site.rooms.length;b++){var c=a.site.rooms[b];a.site.rooms[b].savedDetails={lightsOn:_.clone(c.lightsOn),lightsOff:_.clone(c.lightsOff),name:_.clone(c.name),amountOfPlants:_.clone(c.amountOfPlants),amountOfLights:_.clone(c.amountOfLights),amountOfReservoirs:_.clone(c.amountOfReservoirs),amountOfTables:_.clone(c.amountOfTables),amountOfMachines:_.clone(c.amountOfMachines),roomType:_.clone(c.roomType),startDate:_.clone(c.startDate),flippedDate:_.clone(c.flippedDate),endDate:_.clone(c.endDate),taskGenerationEvents:_.clone(c.taskGenerationEvents)},a.site.rooms[b].changedDetails={}}}function m(b,c){for(var d=_.cloneDeep(a.site),e=[],g=_.cloneDeep(a.site.rooms),h=0;h<d.rooms.length;h++)e.push(d.rooms[h]._id);d.rooms=e,delete d.__v,f.updateObject("site",a.site._id,d).then(function(b){b.data&&b.data.length&&(b.data.rooms=g,a.site=b.data,a.site.rooms.sort(function(a,b){var c=a.name.replace("Tunnel ",""),d=b.name.replace("Tunnel ","");return c>d?1:c<d?-1:0}))})["catch"](function(a){console.log("err: ",a)})["finally"](function(){delete b.saving})}function n(){f.updateObject("site",a.site._id,a.site).then(function(b){a.site=b.data,console.log("res: ",b.data)})["catch"](function(a){console.log("err: ",a)})}function o(b,c){return console.log("updated",b),a.site.rooms[c].savedDetails={lightsOn:_.clone(b.lightsOn),lightsOff:_.clone(b.lightsOff),name:_.clone(b.name),amountOfPlants:_.clone(b.amountOfPlants),amountOfLights:_.clone(b.amountOfLights),amountOfReservoirs:_.clone(b.amountOfReservoirs),amountOfTables:_.clone(b.amountOfTables),amountOfMachines:_.clone(b.amountOfMachines),roomType:_.clone(b.roomType),startDate:_.clone(b.startDate),flippedDate:_.clone(b.flippedDate),endDate:_.clone(b.endDate),taskGenerationEvents:_.clone(b.taskGenerationEvents)},_.merge(a.site.rooms[c],b),a.site.rooms[c].editedLights=!1,a.site.rooms[c].changedLightsOn=!1,a.site.rooms[c].changedLightsOff=!1,a.site.rooms[c].changedStart=!1,a.site.rooms[c].changedFlipped=!1,a.site.rooms[c].changedEnd=!1,a.site.rooms[c].saveDatesError=null,a.site.rooms[c].saveError=null,a.site.rooms[c].saving=!1,a.site.rooms[c].savingDates=!1,a.site.rooms[c].changedDetails={},a.site.rooms[c].savingDetails=!1,a.site.rooms[c].edited=!1,console.log("site: ",a.site.rooms),a.site.rooms[c]}a.site=c.getSiteObj(),console.log("site",a.site),a.siteColorRGB=e.hextToRgb(a.site.mainColor),a.site.rooms.sort(function(a,b){var c=a.name.replace("Tunnel ",""),d=b.name.replace("Tunnel ","");return c>d?1:c<d?-1:0}),k(),a.changeTab=function(b){a.selectedTab=b},a.selectedTab="app environment",a.siteRoomsCount=a.site.rooms.length;a.site.name;a.getRoomsCount=function(b){return new Array(a.site.rooms.length)},a.tabs=["app environment","room details","room lights","room dates"],a.siteColors={main:_.clone(a.site.mainColor),sub:_.clone(a.site.subColor)};var p,q=_.clone(a.site.isNonGrow);if(!a.site.displayName&&a.site){var r=a.site.name.replace("Operation ","");r<10&&(r="0"+r),a.site.displayName="CL"+r,p="CL"+r}p=_.clone(a.site.displayName),j(),a.site.savingColors=!1,l(),a.changeColor=function(b){console.log("color",a.site.mainColor),"main"==b?(a.site.changeMainColor=!0,a.siteColorRGB=e.hextToRgb(a.site.mainColor),k()):a.site.changeSubColor=!0},a.changeDetails=function(b){"displayName"===b?a.changedDisplayName=!0:"isNonGrow"===b&&(a.changedNonGrow=!0),a.changedDetails=!0,a.savingDetails=!1},a.revertColors=function(){a.site.changeMainColor=!1,a.site.changeSubColor=!1,a.site.mainColor=a.siteColors.main,a.site.subColor=a.siteColors.sub,k()},a.saveColors=function(){a.saveColorsError=null,a.site.savingColors=!0,f.updateObject("site",a.site._id,a.site).then(function(b){a.site.mainColor=b.data.mainColor,a.site.subColor=b.data.subColor,a.site.changeMainColor=!1,a.site.changeSubColor=!1,a.siteColors={main:_.clone(a.site.mainColor),sub:_.clone(a.site.subColor)}})["catch"](function(b){a.saveColorsError="Error saving colors!"})["finally"](function(){a.site.savingColors=!1})},a.saveDetails=function(){console.log("change site",a.site),a.savingDetails=!0,a.saveDetailsError=null,f.updateObject("site",a.site._id,a.site).then(function(b){a.changedDetails=!1,a.site.displayName=b.data.displayName,a.site.isNonGrow=b.data.isNonGrow,p=_.clone(a.site.displayName),q=_.clone(a.site.isNonGrow)})["catch"](function(b){a.saveDetailsError="Error saving details."})["finally"](function(){a.savingDetails=!1})},a.revertDetails=function(){a.site.displayName=_.clone(p),a.site.isNonGrow=_.clone(q),a.changedDisplayName=!1,a.changedNonGrow=!1,a.changedDetails=!1,a.saveDetailsError=null},a.goToDashboard=function(){h.setDashboardObj(a.site),b.go("dashboard")},a.changeRoomDetails=function(a,b){a.edited=!0,console.log("room: ",a),a.changedDetails||(a.changedDetails={}),a.changedDetails[b]=!0},a.saveRoomDetails=function(a,b){a.savingDetails=!0,a.saveDetailsError=null,console.log("room",a),console.log("index",b),a.saving=!0,a.newRoom?a.name?(a.saveError=null,f.createObject("room",a).then(function(c){delete a.newRoom;var d=o(c.data,b);m(d,b)})["catch"](function(a){console.log("err: ",a)})):(a.saveError="Please include a name.",a.savingDetails=!1):f.updateObject("room",a._id,a).then(function(c){a.edited=!1,o(c.data,b)})["catch"](function(b){a.saveDetailsError="Error updating room."})["finally"](function(){delete a.savingDetails})};var s={startDate:"Start Date",endDate:"End Date",flippedDate:"Flipped Date"},t={startDate:"lastGeneratedStartTasks",endDate:"lastGeneratedEndTasks",flippedDate:"lastGeneratedFlippedTasks"};a.generateTasks=function(b,c){var f={fromDateType:c,fromDateTypeString:s[c],room:b,fromDate:null,lastGeneratedTasksDate:b[t[c]]},h=b[c];if(!h){var i=c+"Error";return void d(function(){b[i]=!0})}f.fromDate=e.standardizeDate(h);var j="generating"+c;b[j]||(b[j]=!0,b.siteId=a.site._id,g.taskGenerationModal(f),d(function(){delete b[j]},1500))},a.revertRoomDetails=function(a){_.merge(a,a.savedDetails),a.edited=!1,a.changedDetails={}},a.changeLights=function(a,b){a.editedLights=!0,"on"==b?a.changedLightsOn=!0:a.changedLightsOff=!0},a.revertRoomLights=function(a){a.editedLights=!1,a.lightsOn=_.clone(a.savedDetails.lightsOn),a.lightsOff=_.clone(a.savedDetails.lightsOff),a.changedLightsOn=!1,a.changedLightsOff=!1},a.saveRoom=function(b,c){b.saving=!0,b.newRoom?b.name?(b.saveError=null,f.createObject("room",b).then(function(a){delete b.newRoom,m(a.data,c)})["catch"](function(a){console.log("err: ",a)})):(b.saveError="Please include a name.",a.site.rooms[c].saving=!1):(console.log("room: ",c),f.updateObject("room",b._id,b).then(function(a){console.log("res: ",a.data),o(a.data,c)})["catch"](function(a){console.log("err: ",a),b.saveError="Error updating room."})["finally"](function(){delete b.saving}))},a.deleteRoom=function(b,c){g.confirm["delete"](function(){a.site.rooms[c].removed=!0,d(function(){a.site.rooms.splice(c,1),n(b)},1800)})('Room: "'+b.name+'"')},a.newRoom=function(){console.log("new room!"),a.site.rooms||(a.site.rooms=[]),a.site.rooms.unshift({edited:!0,newRoom:!0,name:"Tunnel "+(a.site.rooms.length+1)})},a.calOpts={showWeeks:!1},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],a.format=a.formats[0],a.dateOptions={dateDisabled:!1,formatYear:"yy",maxDate:new Date(2019,5,22),minDate:new Date(2016,4,20),startingDay:1},a.today=function(a,b){console.log("room: ",a),console.log("type: ",b)},a.clear=function(a,b){console.log("clear: ",a),console.log("type: ",b),a[b]="test"},a.changeDate=function(a,b){d(function(){a[b]||(a[b]=""),"flippedDate"===b?(a.changedFlipped=!0,a.flippedTaskError=!1,a.flippedDateError=!1):"endDate"===b?(a.changedEnd=!0,a.saveDatesError=!1,a.endDateError=!1):(a.changedStart=!0,a.vegTaskError=!1,a.startDateError=!1)})},a.populateDate=function(a,b){"endDate"===b?(a.changedEnd=!0,a.saveDatesError=!1,a.endDateError=null,a.flippedDate?a.endDate=moment(a.flippedDate).add(8,"weeks").toDate():a.endDate=moment(a.startDate).add(12,"weeks").toDate()):"flippedDate"===b&&(a.changedFlipped=!0,a.saveDatesError=!1,a.flippedDateError=null,a.startDate&&(a.flippedDate=moment(a.startDate).add(3,"weeks").toDate()))},a.populateEndDate=function(a){},a.saveDates=function(a){a.savingDates=!0,a.saveDatesError=null,f.updateObject("room",a._id,a).then(function(b){a.savedDetails.startDate=_.clone(a.startDate),a.savedDetails.flippedDate=_.clone(a.flippedDate),a.savedDetails.endDate=_.clone(a.endDate),a.changedStart=!1,a.changedFlipped=!1,a.changedEnd=!1})["catch"](function(b){console.log("err: ",b),a.saveDatesError="Error saving dates."})["finally"](function(){a.savingDates=!1})},a.revertDates=function(a){a.savedDetails.flippedDate?a.flippedDate=new Date(a.savedDetails.flippedDate):a.flippedDate=null,a.savedDetails.startDate?a.startDate=new Date(a.savedDetails.startDate):a.startDate=null,a.savedDetails.endDate?a.endDate=new Date(a.savedDetails.endDate):a.endDate=null,d(function(){a.changedStart=!1,a.changedFlipped=!1,a.changedEnd=!1,a.startDateError=null,a.endDateError=null,a.flippedDateError=null})},a.openStartPickers=[],a.openStart=function(b,c){b.preventDefault(),b.stopPropagation(),a.openStartPickers[c]===!0?a.openStartPickers.length=0:(a.openStartPickers.length=0,a.openStartPickers[c]=!0)},a.openEndPickers=[],a.openEnd=function(b,c){b.preventDefault(),b.stopPropagation(),a.openEndPickers[c]===!0?a.openEndPickers.length=0:(a.openEndPickers.length=0,a.openEndPickers[c]=!0)},a.openFlippedPickers=[],a.openFlipped=function(b,c){b.preventDefault(),
b.stopPropagation(),a.openFlippedPickers[c]===!0?a.openFlippedPickers.length=0:(a.openFlippedPickers.length=0,a.openFlippedPickers[c]=!0)},a.altInputFormats=["M!/d!/yyyy"],a.formatDates=function(){for(var b=0;b<a.site.rooms.length;b++)a.site.rooms[b].flippedDate?a.site.rooms[b].flippedDate=new Date(a.site.rooms[b].flippedDate):a.site.rooms[b].flippedDate=null,a.site.rooms[b].startDate?a.site.rooms[b].startDate=new Date(a.site.rooms[b].startDate):a.site.rooms[b].startDate=null,a.site.rooms[b].endDate?a.site.rooms[b].endDate=new Date(a.site.rooms[b].endDate):a.site.rooms[b].endDate=null}}]),angular.module("petalApp").controller("SiteController",["$scope","SiteFactory","$state","localStorageService","$timeout","BaseObjectService","SiteService","DashboardService",function(a,b,c,d,e,f,g,h){f.getAllObjects("site").then(function(b){a.sites=b.data})["catch"](function(a){console.log("err: ",a)}),a.showBaseObj=!1,a.createSite=function(){a.savedBaseObj=void 0,a.selectedAction="create",a.modelType="site",a.childSaveCallback=function(b){console.log("new obj: ",b),a.sites||(a.sites=[]),a.sites.push(b),a.showBaseObj=!1},a.showBaseObj=!0},a.closeView=function(){a.showBaseObj=!1},a.baseSaveCallback=function(a){console.log("room!",a)},a.editSite=function(a){g.setSiteObj(a),c.go("editSite")},a.deleteSite=function(b){console.log("site: ",b),Modal.confirm["delete"](function(){f.deleteObject(b.__t.toLowerCase(),b._id).then(function(c){console.log("deleted response : ",c);for(var d=0;d<a.sites.length;d++)if(a.sites[d]._id==b._id){a.sites.splice(d,1);break}})})("the site: "+b.name)},a.viewDashboard=function(a){console.log("view: ",a),h.setDashboardObj(a),c.go("dashboard")}}]),angular.module("petalApp").config(["$stateProvider",function(a){a.state("sites",{url:"/sites",templateUrl:"app/site/site.html",controller:"SiteController",controllerAs:"siteCtrl",authenticate:"user"}).state("editSite",{url:"/editSite/:siteId",templateUrl:"app/site/edit-site.html",controller:"EditSiteController",authenticate:"admin"})}]),angular.module("petalApp").controller("TimelineController",["$scope","timelineFactory","SiteService","Modal","BaseObjectService","TimelineUtils","TimelineTaskService","Util","$rootScope","$state","TaskPriority","$anchorScroll","$location","$document","$timeout","$window","Auth","socket",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a){a.isMaster&&"daily-check"!==a.taskType&&"x-check"!==a.taskType&&"child-task"!==a.taskType&&(a.occurrenceInfo=f.initMasterTaskEdit(a))}function t(b){a.allTasks.map(function(a){a._id==b._id&&o(function(){console.log("updated:",_.cloneDeep(b)),console.log("task: ",_.cloneDeep(a));var d=_.cloneDeep(b),e=_.cloneDeep(a.occurrenceDate);if(a.flashUpdate=!0,_.merge(a,b),d.site||(a.site=void 0),d.room||(a.room=void 0),b.occurrenceDate?(console.log("updated occurence",_.cloneDeep(b.occurrenceDate)),a.occurrenceDate=moment(h.standardizeDate(new Date(b.occurrenceDate)))):b.isMaster?console.log("is master!"):e&&(e._isAMomentObject?a.occurrenceDate=moment(h.standardizeDate(new Date(e._d))):a.occurrenceDate=moment(h.standardizeDate(e))),a.childTasks&&(v(a.childTasks,a),a.childTaskHeight=72*a.childTasks.length+72+"px",a.childTasks.sort(function(a,b){return a.childIndex-b.childIndex})),console.log("finalized",_.cloneDeep(a)),a.isMaster){if(!a.timeEstimate||!a.timeEstimate.amount)return null;a.taskTime={value:a.timeEstimate.amount+a.timeEstimate.unit.charAt(0),unit:a.timeEstimate.per.substring(0,3)+"."}}else a.taskTime=f.findTaskTime(a.room,a);a.site&&!a.isMaster?(a.site._id||(a.site=c.getSiteData(a.site),console.log("task.site",a.site)),a.siteShortName=c.getSiteShortName(a.site)):a.site||a.isMaster||(a.siteShortName="NA"),a.room&&!a.isMaster?(a.room._id||(a.room=c.getTunnelData(a.site._id,a.room),console.log("task.room",a.room)),a.tunnelShortName=c.getTunnelShortName(a.room)):a.room||a.isMaster||(a.tunnelShortName="NA"),a.taskTypeFormatted=f.formatTaskType(a.taskType),a.taskColor=f.formatTaskColor(a.taskType),o(function(){delete a.flashUpdate},1600)})})}function u(b){for(var c,d=a.timelineTaskArr,e=0;e<d.length;e++){for(var f=d[e].tasks,g=0;g<f.length;g++)f[g]._id==b._id&&(!function(a,b){o(function(){b.splice(a,1)},500)}(g,f),1==f.length&&(c=!0));if(c){a.removeTLTask=d[e],function(b){o(function(){d.splice(b,1),a.removeTLTask=null},600)}(e);break}}}function v(a,b){a.map(function(a){if(a.taskTypeFormatted=f.formatTaskType(a.taskType),b){var d=f.formatTaskColor(b.taskType);a.taskColor=h.getSubColor(h.hextToRgb(d))}else a.taskColor=f.formatTaskColor(a.taskType);a.subPriority||(a.subPriority=k.getDefaultSubPriority(a.priority)),a.isMaster||a.checkTemplateObj?a.isMaster?("x-check"!==a.taskType&&"daily-check"!==a.taskType||(a.taskRepeatString=f.formatTaskRepeatString(a)),a.timeEstimate&&a.timeEstimate.amount&&(a.taskTIme={value:a.timeEstimate.amount+a.timeEstimate.unit.charAt(0)})):a.checkTemplateObj&&(a.taskTime=f.findTaskTime(a.room,a),a.siteShortName=c.getSiteShortName(a.site),a.tunnelShortName=c.getTunnelShortName(a.room),a.occurrenceDate=h.standardizeDate(new Date),a.taskRepeatString=f.formatTaskRepeatString(a)):(a.site&&!a.site._id&&(a.site=c.getSiteData(a.site)),a.room&&!a.room._id&&(a.room=c.getTunnelData(a.site._id,a.room)),a.taskTime=f.findTaskTime(a.room,a),a.siteShortName=c.getSiteShortName(a.site),a.tunnelShortName=c.getTunnelShortName(a.room),a.occurrenceDate=h.standardizeDate(a.occurrenceDate)),a.childTasks&&(v(a.childTasks,a),a.childTaskHeight=72*a.childTasks.length+72+"px",a.childTasks.sort(function(a,b){return a.childIndex-b.childIndex}))}),b||w(a)}function w(){for(var b={},c=0;c<a.allTasks.length;c++){a.allTasks[c].occurrenceDate=moment(h.standardizeDate(new Date(a.allTasks[c].occurrenceDate)));var d=a.allTasks[c].occurrenceDate;b[d]||(b[d]={tasks:[]}),b[d].tasks.push(a.allTasks[c])}x(b)}function x(a){K=[];for(var b in a)if(a.hasOwnProperty(b)){a[b].tasks=_.orderBy(a[b].tasks,"subPriority.sortLevel","desc");var c={date:moment(new Date(b)),tasks:a[b].tasks};K.push(c)}K.sort(function(a,b){var c=new Date(a.date),d=new Date(b.date);return c-d}),y(K)}function y(b){a.todayNotFound=!1;for(var c=!1,d=0;d<b.length;d++){var e=new Date(b[d].date);if(e==a.todaysDate){b[d].isToday=!0,J=d,c=!0;break}if(b[d-1]){var f=new Date(b[d-1].date);if(f<a.todaysDate&&e>=a.todaysDate){b[d].isToday=!0,c=!0,J=d;break}}}c||G||(a.todayNotFound=!0),o(function(){a.timelineTaskArr=b,o(function(){a.scrollToToday()},1e3)}),console.log("timeline: ",a.timelineTaskArr)}function z(){var a=(angular.element(document).find("body").eq(0),document.getElementById("todayMarker"));a&&a.parentNode.removeChild(a)}function A(){if(a.currentUser=q.getCurrentUser(),!a.currentUser||!a.currentUser.role)var b=i.$on("logged-in",function(c,d){a.currentUser=d,b()})}function B(b){var c=moment(new Date),d=moment(c).add(3,"weeks");a.masterTaskFormatted=b.map(function(a){var b;return"daily-check"!==a.taskType&&"x-check"!==a.taskType?(b=f.placeTask(a,21,56,!0,!0),b=f.findTaskDate(b,c,d)):(b=a,b.occurrenceDate=c),b.tunnelShortName="Master",b.siteShortName="Master",b.isMaster=!0,b.taskTypeFormatted=f.formatTaskType(a.taskType),b.taskColor=f.formatTaskColor(a.taskType),b=_.extend(a,b)}),a.initTimeline(f.formatRoomTasks(a.masterTaskFormatted))}function C(a){H?(r.unsyncUpdates("timelineTask"),r.syncUpdates("timelineTask",a,D)):(r.syncUpdates("timelineTask",a,D),H=!0)}function D(a,b){"deleted"==a?u(b):"updated"==a&&t(b)}function E(){console.log("resize"),p.innerWidth>=368&&!a.showSideNav&&(a.showSideNav=!0,a.$digest())}function F(){angular.element(p).off("resize",E)}a.todaysDate=h.standardizeDate(new Date),a.internalControl=a.control||{},a.showLine=!1,a.showSideInfo=!1,a.showSideNav=!0,a.showBatchPrompt=!1,a.taskPriorities=f.taskPriorities,a.timeEstimatePerOpts=f.timeEstimatePerOpts,a.occurrenceObjTypeOpts=f.occurrenceObjTypeOpts,a.taskTypes=f.taskTypes,a.taskSaveLocations=f.taskSaveLocations,a.savingEdits=!1,a.saveEditsError=null,a.errorField=null,a.showSaved=null,a.newTask=null;var G=!1,H=!1;if(a.changedToggled=!1,a.allSites=c.getAllSites(),!a.allSites)var I=i.$on("set-sites",function(b,c){a.allSites=c,I()});a.timeEstimateUnitOpts=[{value:void 0,name:"--Please select--"},{value:"hour",name:"Hour"},{value:"minute",name:"Minute"}],a.stageWeeks=[];a.currentUser||A(),a.initTimeline=function(b){a.toggledTask=null,a.toggledTaskCopy=null,a.editedFieldsCount=0,a.taskToRemove=null,a.removeTLTask=null,a.allTasks=b,a.changedToggled=!1,C(a.allTasks),v(a.allTasks),z()},a.getDaysFrom=function(b){return f.sameDay(a.todaysDate,b._i)?"Today":a.todaysDate>=b._i?"Past Due":"Upcoming"},a.updateTaskView=function(b){b.isMaster?(a.timelineTaskArr=[],G=!0,B(b.tasks)):(G&&(G=!1,a.timelineTaskArr=[]),console.log("response: ",b.tasks),a.initTimeline(b.tasks))},a.addTask=function(){console.log("add task!"),a.toggledTask={}},a.toggleTask=function(b){console.log("task: ",b),console.log("toggledTask: ",a.toggledTask),"select-parent"!==a.showBatchPrompt&&(b?(a.newTask=!1,a.enabledFields=null,a.editedFields=null,a.editedFieldsCount=0,a.toggledTask==b?(a.toggledTask=null,a.changedToggled=!1,a.toggledTaskCopy=null):(a.toggledTask&&a.toggledTask._id!=b._id?(a.changedToggled=!1,o(function(){a.changedToggled=!0,a.toggledTask=_.cloneDeep(b),a.toggledTaskCopy=_.cloneDeep(b)})):(a.toggledTask=_.cloneDeep(b),a.toggledTaskCopy=_.cloneDeep(b)),a.savingEdits=!1,a.errorField=null,a.showSaved=null)):(a.toggledTask=null,a.changedToggled=!1))},a.toggleChildTasks=function(a){a.showChildTasks=!a.showChildTasks},a.editTask=function(a){var b=_.cloneDeep(a);g.setEditTask(b),j.go("timeline.task",{timelineTaskId:a._id})},a.changePriority=function(b){a.enabledFields&&a.enabledFields.priority&&b.label!=a.toggledTask.priority&&(a.editField("priority"),a.toggledTask.priority=b["class"])},a.completeTask=function(a){if(!a.isMaster&&!a.checkTemplateObj){a.completed=!a.completed;var b=_.pick(a,["completed","completedDate"]);b.completedDate=h.standardizeDate(new Date),console.log("taskToSave: ",b),g.updateTask(a._id,b)}},a.revertEdits=function(b){a.toggledTask&&(b?a.toggledTask=b:a.toggledTask=_.cloneDeep(a.toggledTaskCopy),console.log("updatedTask",b),a.editedFields=null,a.enabledFields=null,a.editedFieldsCount=0,s(a.toggledTask))},a.getEditedCount=function(){var b=0;for(var c in a.editedFields)a.editedFields.hasOwnProperty(c)&&b++;return console.log("editCount: ",b),b},a.deleteTask=function(b){var c;c=b.isMaster?"Task: "+b.title+" from the master timeline":b.checkTemplateObj?"The reoccurring task: "+b.title+" for "+b.siteShortName+"-"+b.tunnelShortName:b.tunnelShortName&&"NA"!=b.tunnelShortName?"Task: "+b.title+" for "+b.siteShortName+"-"+b.tunnelShortName:"Task: "+b.title+" for "+b.siteShortName,d.confirm["delete"](function(){var c,d;c=b.isMaster?"masterTimeline":"timelineTask",b.room&&!b.isMaster&&(d=b.room._id),g.deleteTask(b._id,d,c).then(function(c){a.toggledTask=null,o(function(){a.taskToRemove=b},800)})["catch"](function(a){console.log("err: ",a)})})(c)};var J,K=[];a.scrollToToday=function(){J?(m.hash("todaysDate"),l()):a.todayNotFound&&(m.hash("endOfList"),l())},a.getTodayLabel=function(b){return h.sameDay(b.date._i,a.todaysDate)?"Today":b.date.from(a.todaysDate)},a.showToggleMenu=!1,a.rooms=[],a.timelineViewControl={},a.showError=!1,a.tlErrorMessage="",a.selectedTasks=[],a.selectedTimelineView="site",a.allMasterTasks=[],a.selectedRoom=function(b){return a.rooms.indexOf(b)>-1},a.errorCount=0,a.showTimeline=function(){"master"==a.selectedTimelineView?(a.errorCount=0,a.showToggleMenu=!1,a.tlErrorMessage="",a.showError=!1,a.initTimeline(a.masterTaskFormatted)):a.rooms.length?(a.errorCount=0,a.showToggleMenu=!1,a.tlErrorMessage="",a.showError=!1,a.shownTimeline=!0,getTasks()):(a.errorCount++,a.tlErrorMessage="Please select a room.",a.showError=!0),body.classList.toggle("no-scroll",a.showToggleMenu)},a.tlAddTask=function(){function b(b){d.taskModal.create(function(a){console.log("selectedOpt: ",a)})(b,a.sites)}var c=[{title:"Master Task",value:"master"},{title:"Room Specific",value:"room"}];d.confirm.select(function(a){b(a)})("Type of task",c)},a.buildNewTL=function(){a.showToggleMenu=!1,d.buildTimeline(a.sites)};var L=i.$on("remove-task",function(b,c){for(var d=c.taskId,e=c.roomId,f=!1,g=0;g<a.rooms.length;g++){if(a.rooms[g]._id==e){for(var h=a.rooms[g].timelines,i=0;i<h.length;i++){for(var j=h[i].timelineTasks,k=0;k<j.length;k++){if(j[k]._id==d){h[i].timelineTasks.splice(k,1),f=!0;break}if(f)break}if(f)break}if(f)break}if(f)break}}),M=i.$on("toggle-collapse",function(b,c){a.showSideNav=c}),N=i.$on("deleted-task",function(){a.toggledTask=null});i.$on("select-parent-task",function(){a.toggledTask=null,a.showBatchTitle="Parent Task",a.showBatchPrompt="select-parent",a.selectParentError="Select a task",a.selectParentMessage=null,a.selectedParentTask=null}),i.$on("batch-mode",function(b,c){console.log("batch-mode: ",c),c?(a.batchTitle=c.batchModeTitle,a.batchInfo=c.batchInfo,a.showBatchPrompt=c.batchMode,a.batchItems=[]):(a.batchTitle=null,a.batchInfo=null,a.showBatchPrompt=null,a.batchItems=[])});a.selectedForBatch=function(b){return a.batchItems.indexOf(b._id)>-1},a.batchItem=function(b){if("select-parent"===a.showBatchPrompt&&b)b.isChildTask?(a.selectParentError=!0,a.selectedParentTask=null,a.selectParentMessage="Parent cannot be a child task."):a.selectedParentTask===b?(a.selectedParentTask=null,a.selectParentError=!1,a.selectParentMessage=""):(a.selectParentError=!1,a.selectParentMessage="Task : "+b.title,a.selectedParentTask=b);else{var c=a.batchItems.indexOf(b._id);c>-1?a.batchItems.splice(c,1):"complete"!=a.showBatchPrompt?a.batchItems.push(b._id):b.isMaster||b.checkTemplateObj||a.batchItems.push(b._id)}},a.confirmBatch=function(){function b(a,b){o(function(){g.updateTask(a._id,a)},200*b)}function c(a,b){o(function(){g.restoreTask(a._id,a)},200*b)}function d(a,b){o(function(){g.deleteTask(a)},100*b)}if("select-parent"===a.showBatchPrompt)if(a.selectedParentTask){i.$emit("cancel-batch");var e=_.cloneDeep(a.selectedParentTask);i.$emit("selected-parent-task",e),a.selectParentError=!1,a.showBatchPrompt=null}else a.selectParentError=!0,a.selectParentMessage="Please select a task.";else{var f=0;"delete"===a.showBatchPrompt?(a.batchItems.map(function(a){d(a,f),f++}),a.batchItems=[]):"complete"===a.showBatchPrompt?(a.batchItems.map(function(a){var c={completed:!0,completedDate:new Date,_id:a};b(c,f),f++}),a.batchItems=[]):"restore"===a.showBatchPrompt&&a.batchItems.map(function(a){var b={restored:!0,_id:a};c(b,f),f++})}},a.cancelBatch=function(){i.$emit("cancel-batch"),"select-parent"===a.showBatchPrompt&&(i.$emit("selected-parent-task",null),a.selectParentError="Select a task"),a.showBatchPrompt=null,a.batchItems=[]},angular.element(p).on("resize",E),a.$on("$destroy",function(){M(),console.log("destroy!"),L(),N(),F()})}]),angular.module("petalApp").config(["$stateProvider",function(a){a.state("timeline",{url:"/timeline",templateUrl:"app/timeline/timeline.html",controller:"TimelineController",authenticate:"user"}),a.state("timeline.task",{url:"/timeline/task/:timelineTaskId",templateUrl:"app/timeline/timeline.task.html",controller:"TimelineTaskController"})}]),angular.module("petalApp").controller("TimelineTaskController",["$scope","TimelineUtils","TimelineTaskService","Util","$timeout","$state","Modal","$rootScope","$stateParams","TaskPriority","SiteService","BaseObjectService","Auth",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){a.selectedTask.forCycleStarting=b.forCycleStarting,a.selectedTask.inPeriod=b.inPeriod,a.selectedTask.isMaster=b.isMaster,b.isMaster||(a.selectedTask.room=b.room,a.selectedTask.site=b.site,b.occurrenceDate._isAMomentObject?a.selectedTask.occurrenceDate=b.occurrenceDate._d:a.selectedTask.occurrenceDate=b.occurrenceDate),a.selectedTask.taskColor=b.taskColor,a.selectedTask.taskDay=b.taskDay,a.selectedTask.taskWeek=b.taskWeek,a.selectedTask.tunnel=b.tunnel}function o(){a.selectedTask.forCycleStarting=null,a.selectedTask.inPeriod=null,a.selectedTask.isMaster=null,a.selectedTask.taskColor=null,a.selectedTask.taskDay=null,a.selectedTask.taskWeek=null,a.selectedTask.tunnel=null,a.selectedTask.childIndex=null,a.selectedTask.isChildTask=!1,a.selectedTask.occurrenceDate=null,a.selectedTask.site=null,a.selectedTask.room=null,a.selectedTask.parentTask=null}function p(){for(var b=0;b<a.selectedTask.childTasks.length;b++)a.selectedTask.childTasks[b].childIndex=b+1;c.updateChildTaskIndex(a.selectedTask.childTasks)}function q(){var c;if(c=b.buildMasterTask(a.selectedTask),c.buildError)a.saveEditsError=c.message,a.errorField=c.field;else{var d=b.checkMasterFields(c);d.field?(a.saveEditsError=d.message,a.errorField=d.field):(a.errorField=null,console.log("builtTask: ",c),"x-check"===c.taskType||"daily-check"===c.taskType?(c.occurrenceObj={},c.checkTemplateObj=!0):delete c.checkTemplateObj,console.log("built task",c),r(c))}}function r(b){a.savingEdits=!0,a.showSaved=null;var d=_.cloneDeep(b);console.log("taskToSave: ",d),a.newTask?"daily-check"===d.taskType||"x-check"===d.taskType?(d.checkTemplateObj=!0,d.isMaster?t(d):s(d)):t(d):c.updateTask(d._id,d).then(function(b){a.showSaved="Update successful.",a.enabledFields=null,a.selectedTask=b.data,console.log("res: ",b),x(),a.editedFieldsCount=0,e(function(){a.editedFields=null,e(function(){a.showSaved=null},2500)},1500)})["catch"](function(b){console.error("err: ",b),a.saveEditsError="Error saving these changes."})["finally"](function(){a.savingEdits=!1})}function s(b){a.savingEdits=!0,a.showSaved=null,console.log("task: ",b),c.newReoccurringTask(b).then(function(b){console.log("response",b),a.selectedTask=b.data,a.showSaved="Saved successfully.",e(function(){a.showSaved=null},2e3),x()})["catch"](function(a){console.log("errL ",a)})["finally"](function(){a.savingEdits=!1})}function t(b){a.savingEdits=!0,a.showSaved=null,console.log("task to save: ",b),b.occurrenceDate&&b.occurrenceDate._d&&(console.log("moment",b.occurrenceDate._d),b.occurrenceDate=d.standardizeDate(b.occurrenceDate._d)),console.log("tasktoSave",b),c.createTask(b).then(function(b){a.showSaved="Created task.",a.enabledFields=null,a.editedFieldsCount=0,console.log("res",b),a.selectedTask=b.data,e(function(){a.editedFields=null,e(function(){a.showSaved=null},2500),x()},1500),f.go("timeline.task",{timelineTaskId:a.selectedTask._id},{notify:!1,reload:!1,location:"replace"})})["catch"](function(b){console.error("err: ",b),a.saveEditsError="Error saving these changes."})["finally"](function(){a.savingEdits=!1,a.newTask=!1})}function u(){function d(){m.hasRole("admin",function(a){return console.log("has role!",a),a?g():f.go("login")})}function e(){c.getAllTimelines().then(function(b){console.log("timeline res",b),a.allTLTemplates=b.data})["catch"](function(a){console.log("tl err",a)})}function g(){e(),i.timelineTaskId?c.getEditTask(i.timelineTaskId).then(function(b){a.selectedTask=b,x()})["catch"](function(a){console.log("err: ",a)}):w()}a.taskCopy={},a.dimOut=!1,a.taskPriorities=b.taskPriorities,a.timeEstimatePerOpts=b.timeEstimatePerOpts,a.occurrenceObjTypeOpts=b.occurrenceObjTypeOpts,a.taskTypes=b.taskTypes,a.taskSaveLocations=b.taskSaveLocations,a.taskRepeatOpts=b.taskRepeatOpts,a.masterCheckLocations=b.masterCheckLocations,a.savingEdits=!1,a.saveEditsError=null,a.errorField=null,a.showSaved=null,a.selectedTask={},a.editedFieldsCount=0,a.enabledFields=null,a.editedFields=null,a.copyToTemplates=[],a.timeEstimateUnitOpts=[{value:void 0,name:"--Please select--"},{value:"minute",name:"Minute"},{value:"hour",name:"Hour"}],a.stageWeeks=[];a.loadingView=!0,m.loggingIn?(z=h.$on("logged-in",function(){z(),d()}),A=h.$on("logged-out",function(){_.isFunction(z)&&z(),A(),f.go("login")})):d()}function v(){for(var b=0;b<7;b++){var c={label:E[b],value:b};a.days.push(c)}}function w(){a.enabledFields={},a.saveEditsError=null,a.enabledFields.title=!0,a.enabledFields.priority=!0,a.enabledFields.occurrenceObj=!0,a.enabledFields.taskType=!0,a.enabledFields.timeEstimate=!0,a.enabledFields.notes=!1,a.enabledFields.taskLocation=!0,a.editedFields=null,a.selectedTask.taskRepeatDays=[],a.subPriorities=j.getSubColors("normal"),a.newTask=!0}function x(){if(a.editedFieldsCount=0,a.editedFields=null,a.newTask=!1,a.parentTask=null,a.editedChildTasks=!1,a.copyToTemplates=[],a.selectedTask.isMaster){if("daily-check"!==a.selectedTask.taskType&&"x-check"!==a.selectedTask.taskType&&"child-task"!==a.selectedTask.taskType&&(a.selectedTask.occurrenceInfo=b.initMasterTaskEdit(a.selectedTask),console.log("occurrence info",a.selectedTask)),"tunnel-timeline"===a.selectedTask.taskType?(a.showTemplateSelect=!0,a.showTemplateCopy=!0,a.selectedTask.taskTLTemplate):(a.showTemplateSelect=!1,a.showTemplateCopy=!1),a.selectedTask.occurrenceObj&&"daily-check"!==a.selectedTask.taskType&&"x-check"!==a.selectedTasks.taskType){var e=moment(new Date),f=moment().add(3,"weeks"),g=b.placeTask(a.selectedTask,21,56,!0,!0);g=b.findTaskDate(g,e,f),_.extend(a.selectedTask,g)}}else{if(a.showTemplateSelect=!1,a.showTemplateCopy=!1,"tunnel-timeline"===a.selectedTask.taskType){a.selectedTask.occurrenceObj={type:a.selectedTask.inPeriod},a.selectedTask.occurrenceInfo&&a.selectedTask.occurrenceInfo.selectedTime||(a.selectedTask.occurrenceInfo={selectedTime:{},stageDays:[]}),a.selectedTask.occurrenceInfo.stageDays=[];for(var h=1;h<8;h++)a.selectedTask.occurrenceInfo.stageDays.push({value:h,name:h});a.selectedTask.occurrenceInfo.selectedTime={day:Number(a.selectedTask.taskDay),week:Number(a.selectedTask.taskWeek)}}console.log("tk",a.selectedTask),a.selectedTask.taskTypeFormatted||(a.selectedTask.taskTypeFormatted=b.formatTaskType(a.selectedTask.taskType)),a.selectedTask.occurrenceDate&&!a.selectedTask.occurrenceDate._isAMomentObject&&(a.selectedTask.occurrenceDate=moment(d.standardizeDate(a.selectedTask.occurrenceDate)));var i=void 0,m=void 0;if(console.log("selected",_.cloneDeep(a.selectedTask)),a.selectedTask.site)if(a.selectedTask.site._id)i=a.selectedTask.site._id,a.selectedTask.siteShortName=k.getSiteShortName(a.selectedTask.site);else{i=a.selectedTask.site;var n=k.getSiteData(i);n&&n._id?(a.selectedTask.site=n,a.selectedTask.siteShortName=k.getSiteShortName(a.selectedTask.site)):l.getObject("site",i).then(function(b){a.selectedTask.site=b.data,a.selectedTask.siteShortName=k.getSiteShortName(a.selectedTask.site)})}if(a.selectedTask.room)if(a.selectedTask.room._id)a.selectedTask.tunnelShortName=k.getTunnelShortName(a.selectedTask.room);else{m=a.selectedTask.room;var o=k.getTunnelData(i,m);o&&o._id?(a.selectedTask.room=o,a.selectedTask.tunnelShortName=k.getTunnelShortName(a.selectedTask.room)):l.getObject("room",m).then(function(b){a.selectedTask.room=b.data,a.selectedTask.tunnelShortName=k.getTunnelShortName(a.selectedTask.room)})}a.selectedTask.taskRepeatDays||(a.selectedTask.taskRepeatDays=[]),a.selectedTask.timeEstimate&&!a.selectedTask.taskTime&&(a.selectedTask.taskTime=b.findTaskTime(a.selectedTask.room,a.selectedTask),console.log("time: ",a.selectedTask.taskTime)),a.selectedTask.checkTemplateObj&&(delete a.selectedTask.occurrenceDate,a.taskTypes=_.filter(a.taskTypes,function(a){return"tunnel-timeline"!=a.value&&"admin-assigned"!=a.value})),a.selectedTask.site&&a.selectedTask.site.rooms&&y(a.selectedTask.site)}if(a.taskCopy=_.cloneDeep(a.selectedTask),console.log("copy",a.taskCopy),"child-task"===a.selectedTask.taskType&&a.selectedTask.parentTask){var p=a.selectedTask.parentTask;p._id?(a.selectedTask.parentTask=p._id,a.parentTaskInfo=_.cloneDeep(p)):c.getEditTask(p).then(function(b){console.log("parent: ",b),a.selectedTask.parentTask=b._id,a.parentTaskInfo=_.cloneDeep(b)})["catch"](function(a){console.log("err: ",a)})}a.selectedTask.childTasks&&a.selectedTask.childTasks.length&&a.selectedTask.childTasks.sort(function(a,b){return a.childIndex-b.childIndex}),a.subPriorities=j.getSubColors(a.selectedTask.priority)}function y(b){b.rooms.sort(function(a,b){var c=a.name.replace("Tunnel ",""),d=b.name.replace("Tunnel ","");return c>d?1:c<d?-1:0});for(var c=0;c<b.rooms.length;c++){var d=b.rooms[c].name.replace("Tunnel ","");d<10&&(d="0"+d),b.rooms[c].tunnelShortName="T"+d,b.rooms[c].site=b._id}a.siteRooms=b.rooms,console.log("rooms: ",a.siteRooms)}var z,A;console.log("hereee"),a.goBack=function(){a.dimOut=!0,D(),a.checkNotesChanged(),e(function(){a.revertTask(),e(function(){a.revertEdits(a.selectedTask),f.go("timeline")},300)},150)},a.editorStyle={width:"256px"};var B={small:"256px",medium:"311px",large:"350px"};a.selectedSize="small",a.changeEditorSize=function(b){a.editorStyle.width=B[b],a.selectedSize=b},a.enableField=function(b){a.enabledFields||(a.enabledFields={}),"priority"==b?a.editedFields&&!a.editedFields.priority?(console.log("here: ",a.enabledFields.priority),a.enabledFields[b]=!a.enabledFields.priority):(console.log("no edits: ",a.enabledFields.priority),a.enabledFields[b]=!a.enabledFields.priority):a.enabledFields[b]=!0},a.editField=function(c){if(a.editedFields||(a.editedFields={}),c===a.errorField&&(a.errorField=null,a.saveEditsError=null),"taskRepeat-custom"!==c&&"taskRepeat-preset"!==c||"taskRepeat"!==a.errorField||(a.errorField=null,a.saveEditsError=null),a.editedFields[c]||(a.editedFields[c]=!0,a.editedFieldsCount++),"occurrenceObjType"===c){if(!a.selectedTask.occurrenceInfo||!a.selectedTask.occurrenceInfo.stageDays){a.selectedTask.occurrenceInfo={stageDays:[]};for(var d=1;d<8;d++)a.selectedTask.occurrenceInfo.stageDays.push({value:d,name:d})}a.selectedTask.inPeriod=a.selectedTask.occurrenceObj.type,console.log("occurrence period: ",a.selectedTask)}"occurrenceObjDay"!==c&&"occurrenceObjWeek"!==c&&"occurrenceObjType"!==c||(a.editedFields.occurrenceObj=!0),"taskRepeat-preset"===c?(a.selectedTask.taskRepeatCustom=null,a.selectedTask.taskRepeatDays=[],a.editedFields["taskRepeat-custom"]=!1,a.editedFields["taskRepeat-days"]=!1):"taskRepeat-custom"===c?(a.selectedTask.taskRepeatPreset=null,a.editedFields["taskRepeat-preset"]=!1,a.editedFields["taskRepeat-days"]=!1,a.selectedTask.taskRepeatDays=[]):"taskRepeat-days"===c&&(a.selectedTask.taskRepeatCustom=null,a.editedFields["taskRepeat-custom"]=!1,a.selectedTask.taskRepeatPreset=null,a.editedFields["taskRepeat-preset"]=!1),"taskType"===c&&(a.selectedTask.taskTypeFormatted=b.formatTaskType(a.selectedTask.taskType),console.log("selected: ",a.selectedTask),"x-check"===a.selectedTask.taskType?a.enabledFields.taskRepeat=!0:"child-task"===a.selectedTask.taskType?console.log("is child"):(a.selectedTask.taskRepeatCustom=null,a.editedFields["taskRepeat-custom"]=!1,a.selectedTask.taskRepeatPreset=null,a.editedFields["taskRepeat-preset"]=!1),a.errorField=null,a.saveEditsError=null,a.selectedTask.isChildTask&&"child-task"!==a.selectedTask.taskType&&o()),"taskType"===c&&a.newTask&&("x-check"===a.selectedTask.taskType||"daily-check"===a.selectedTask.taskType?(a.selectedTask.checkTemplateObj=!0,delete a.selectedTask.occurrenceDate,a.editedFields.occurrenceDate=!1):delete a.selectedTask.checkTemplateObj,"tunnel-timeline"!==a.selectedTask.taskType&&(a.selectedTask.taskLocation="location"),delete a.selectedTask.taskTLTemplate,a.showTemplateSelect=!1),"taskLocation"===c&&("location"===a.selectedTask.taskLocation?(a.enabledFields.site=!0,delete a.selectedTask.isMaster,a.showTemplateSelect=!1,delete a.selectedTask.taskTLTemplate):(delete a.selectedTask.site,delete a.selectedTask.room,a.selectedTask.isMaster=!0,a.enabledFields.site=!1,a.enabledFields.room=!1,a.editedFields.site=!1,a.editedFields.room=!1,delete a.selectedTask.occurrenceDate,delete a.selectedTask.checkTemplateObj,a.editedFields.occurrenceDate=!1,a.showTemplateSelect=!0)),"site"===c&&(a.selectedTask.site?(a.enabledFields.room=!0,console.log("here",a.selectedTask),a.removeRoom(),y(a.selectedTask.site)):a.selectedTask.room?a.removeRoom():a.siteRooms=[]),"occurrenceDate"===c&&(a.editedFields.occurrenceDate=!0),"childTasks"===c&&p()};var C;a.saveOldNotes=function(){C=_.clone(a.selectedTask.notes)},a.checkNotesChanged=function(){C!=a.selectedTask.notes&&(a.editField("notes"),C=_.clone(a.selectedTask.notes))},a.addImage=function(){g.show.taskImage(function(b){a.selectedTask.images||(a.selectedTask.images=[]);var c=a.selectedTask.images.indexOf(b);c<0&&(a.selectedTask.images.push(b),a.editField("images"))})()},a.selectParent=function(){a.hideTaskView=!0,h.$emit("select-parent-task")};var D=h.$on("selected-parent-task",function(b,c){if(console.log("data",c),c){var d=c;a.selectedTask.isChildTask=!0,a.selectedTask.parentTask=d._id,a.parentTaskInfo=d,d.childTasks&&d.childTasks.length?a.selectedTask.childIndex=d.childTasks.length+1:a.selectedTask.childIndex=1,n(d),a.editField("parentTask")}a.hideTaskView=!1});a.removeParentTask=function(){g.confirm["delete"](function(){a.editField("parentTask"),a.selectedTask.parentTask=null,a.parentTaskInfo=null,o()})("this task's parent task.")},a.deleteChildTask=function(b){g.confirm["delete"](function(){c.deleteTask(b._id,"","TimelineTask").then(function(c){var d=_.findIndex(a.selectedTask.childTasks,b);a.selectedTask.childTasks.splice(d,1),a.editField("childTasks"),p()})})("the child task: "+b.title)},a.removeImage=function(b){g.confirm["delete"](function(){var c=a.selectedTask.images.indexOf(b);c>-1&&a.selectedTask.images.splice(c,1)})("this image")},a.copiedText=function(b,c){console.log("image",c),a.copied=c,e(function(){a.copied=""},2e3)},a.removeRoom=function(){console.log("remove room!"),a.selectedTask.room=null,a.editField("room")},a.removeSite=function(){console.log("remove site!"),a.selectedTask.site=null,delete a.selectedTask.siteShortName,a.editField("site")},a.changePriority=function(b){a.enabledFields&&a.enabledFields.priority&&b.label!==a.selectedTask.priority&&(a.editField("priority"),a.selectedTask.priority=b["class"],a.subPriorities=j.getSubColors(b["class"]),a.enabledFields.subPriority=!0,a.selectedTask.subPriority||(a.selectedTask.subPriority=a.subPriorities[4]))},a.disableOccurrenceDate=function(){return!(!a.selectedTask.isMaster&&"child-task"!==a.selectedTask.taskType)||!("daily-check"!==a.selectedTask.taskType&&"x-check"!==a.selectedTask.taskType||!a.selectedTask.checkTemplateObj)},a.selectTemplate=function(b){a.selectedTask.taskTLTemplate===b._id?a.selectedTask.taskTLTemplate=null:a.selectedTask.taskTLTemplate=b._id,a.editField("taskTLTemplate")},a.isSelectedTemplate=function(b){return a.selectedTask.taskTLTemplate===b._id},a.isToggledTemplate=function(b){return _.indexOf(a.copyToTemplates,b._id)>-1},a.toggleTemplate=function(b){if(console.log("pull",b),!a.selectedTask.taskTLTemplate||a.selectedTask.taskTLTemplate!==b._id){var c=_.indexOf(a.copyToTemplates,b._id);console.log("idx",c),c>-1?a.copyToTemplates.splice(c,1):a.copyToTemplates.push(b._id)}},a.copyTemplate=function(){console.log("selected",a.selectedTask),console.log("copy",a.copyToTemplates),c.copyToTimelines(a.copyToTemplates,a.selectedTask).then(function(b){console.log("res",b),a.copyToTemplates=[]})["catch"](function(a){console.log("copy err",a)})},a.selectSubPriority=function(b){a.editedFields||(a.editedFields={}),a.enabledFields?a.enabledFields.subPriority=!a.enabledFields.subPriority:(a.enabledFields={},a.enabledFields.subPriority=!0),a.editedFields.subPriority=!0,a.selectedTask.subPriority=b},a.revertTask=function(){a.editedFields&&(a.selectedTask=_.cloneDeep(a.taskCopy),e(function(){a.editedFields=null,a.enabledFields=null,a.editedFieldsCount=0,_.isEmpty(a.selectedTask)?w():x()},100))},a.deleteTask=function(){var b;b=a.selectedTask.isMaster?"Task: "+a.selectedTask.title+" from the master timeline":a.selectedTask.checkTemplateObj?"The reoccurring task: "+a.selectedTask.title+" for "+a.selectedTask.siteShortName+"-"+a.selectedTask.tunnelShortName:a.selectedTask.tunnelShortName&&"NA"!=a.selectedTask.tunnelShortName?"Task: "+a.selectedTask.title+" for "+a.selectedTask.siteShortName+"-"+a.selectedTask.tunnelShortName:"Task: "+a.selectedTask.title+" for "+a.selectedTask.siteShortName,g.confirm["delete"](function(){var b,d;a.selectedTask.isMaster&&(b="masterTimeline");var f=a.selectedTask._id;c.deleteTask(a.selectedTask._id,d,b).then(function(b){
a.goBack(),h.$emit("deleted-task",f),e(function(){a.selectedTask=null},500)})["catch"](function(a){console.log("err: ",a)})})(b)},a.saveTask=function(){if(console.log("selected: ",a.selectedTask),a.editedFields&&!a.savingEdits){var c=null;if(a.selectedTask.isMaster)q();else{var d=b.checkTaskFields(a.selectedTask);if(d.field)a.savingEdits=!1,a.saveEditsError=d.message,a.errorField=d.field;else{var e="child-task"!==a.selectedTask.taskType&&(a.editedFields.occurrenceDate||a.editedFields.room);console.log("get new date",e),c=b.buildTask(a.selectedTask,e),console.log("build Task: ",c),r(c)}}}},u(),a.days=[];var E={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thr",5:"Fri",6:"Sat"};a.toggleDay=function(b){a.selectedTask.taskRepeatDays||(a.selectedTask.taskRepeatDays=[]);var c=a.selectedTask.taskRepeatDays.indexOf(b.value);c<0?a.selectedTask.taskRepeatDays.push(b.value):a.selectedTask.taskRepeatDays.splice(c,1),a.editField("taskRepeat-days")},a.isRepeat=function(b){return a.selectedTask.taskRepeatDays.indexOf(b.value)>-1},v()}]),angular.module("petalApp").controller("WhiteboardController",["$scope","BaseObjectService","Modal","$rootScope","$timeout",function(a,b,c,d,e){console.log("white board!"),a.whiteboardObj={};var f=void 0;a.editField=function(b){a.editedFields||(a.editedFields={}),a.editedFields[b]||(a.editedFields[b]=!0,a.editedFieldsCount++)},a.editedFieldsCount=0,b.getAllObjects("whiteboard").then(function(b){console.log("res",b),b.data.length&&(a.whiteboardObj=b.data[0],f=_.clone(a.whiteboardObj))})["catch"](function(a){console.log("err: ",a)});var g;a.saveOldText=function(){g=_.clone(a.whiteboardObj.text)},a.checkTextChanged=function(){g!=a.whiteboardObj.text&&(a.editField("text"),g=_.clone(a.whiteboardObj.text))},a.addImage=function(){c.show.taskImage(function(b){a.whiteboardObj.images||(a.whiteboardObj.images=[]);var c=a.whiteboardObj.images.indexOf(b);c<0&&(a.whiteboardObj.images.push(b),a.editField("images"))})()},a.removeImage=function(b){c.confirm["delete"](function(){var c=a.whiteboardObj.images.indexOf(b);c>-1&&a.whiteboardObj.images.splice(c,1),a.editField("images")})("this image")},a.copiedText=function(b,c){a.copied=c,e(function(){a.copied=""},2e3)},a.revertEdits=function(){a.editedFields&&(a.whiteboardObj=_.cloneDeep(f),e(function(){a.editedFields=null,a.editedFieldsCount=0,_.isEmpty(a.whiteboardObj)&&(a.whiteboardObj={})},100))},a.saveWhiteboardObj=function(){function c(){a.showSaved="Saved successfully.",f=_.clone(a.whiteboardObj),e(function(){a.editedFields=null,a.editedFieldsCount=0,e(function(){a.showSaved=null},2500)},1500)}a.editedFieldsCount>0&&(a.savingEdits=!0,a.showSaved=null,a.whiteboardObj._id?b.updateObject("whiteboard",a.whiteboardObj._id,a.whiteboardObj).then(function(b){console.log("res",b),a.whiteboardObj=b.data,c()})["catch"](function(b){console.log("err: ",b),a.saveEditsError="Error saving these changes."})["finally"](function(){a.savingEdits=!1}):b.createObject("whiteboard",a.whiteboardObj).then(function(b){console.log("res",b),a.whiteboardObj=b.data,c()})["catch"](function(b){console.log("err: ",b),a.saveEditsError="Error saving these changes."})["finally"](function(){a.savingEdits=!1}))}}]),angular.module("petalApp").config(["$stateProvider",function(a){a.state("whiteboard",{url:"/whiteboard",templateUrl:"app/whiteboard/whiteboard.html",controller:"WhiteboardController",authenticate:"admin"})}]),angular.module("petalApp").controller("RoomTimelineBuilderCtrl",["$scope","TimelineTaskService","$timeout","Util",function(a,b,c,d){function e(b){a.selectedOpts.room=b._id,a.tlDateError=null,a.selectedRoom=b,a.selectedOpts.step++,a.startDateWarning=null,a.endDateWarning=null,a.flippedDateWarning=null,b.startDate?(a.roomStartDate=d.standardizeDate(new Date(b.startDate)),a.watchStart=!1):(a.startDateWarning="This room does not have a start date, which is required to build a timeline. Please set one now.",a.watchStart=!0),b.flippedDate?a.roomFlippedDate=d.standardizeDate(new Date(b.flippedDate)):a.flippedDateWarning="This room does not have a flipped date, so any tasks which need to occur after a room is flipped will be saved to the room's TBD task object. You can view these under the room's detail page.",b.endDate?a.roomEndDate=d.standardizeDate(new Date(b.endDate)):a.endDateWarning="This room does not have an end date, so any tasks which need to occur after a room is finished will be saved to the room's TBD task object. You can view these under the room's detail page."}function f(d){a.loading||(a.loading=!0,a.savedTL=null,a.tlDateError=null,b.buildTimelineTasks(d).then(function(b){console.log("res: ",b),a.savedTL={header:"Saved!",taskCount:"Created "+b.data.newTasks.length+" tasks.",tbdTasks:null,reoccurringTasks:null},b.data.TBDTaskCount>0&&(a.savedTL.tbdTasks=b.data.TBDTaskCount+" tasks were saved to the room's TBD task object."),b.data.reoccurringTaskCount>0&&(a.savedTL.reoccurringTasks=b.data.reoccurringTaskCount+" reoccurring tasks were created."),a.tlDateError=null,c(function(){a.selectedOpts={site:null,room:null,baseTimeline:null,tlName:"",confirmedDates:!1,tlDates:{},step:1}},8e3)})["catch"](function(b){b.data.errorMessage?a.errorMessage=b.data.errorMessage:a.errorMessage="Error building this timeline. Please close and try again :("})["finally"](function(){a.loading=!1}))}function g(b){return console.log("fields: ",b),b.site?b.room?b.baseTimeline?b.tlDates.startDate?!b.tlDates.flippedDate&&a.flippedDate?(a.flashStep=4,"Please select a flipped date."):b.tlDates.endDate?(a.flashStep=null,null):(a.flashStep=4,"Please select an end date."):(a.flashStep=4,"Please select a start date."):(a.flashStep=3,"Please select a base timeline."):(a.flashStep=2,"Please select a room."):(a.flashStep=1,"Please select an operation.")}a.baseTimelines=["Master"],a.selectedStep="1",a.loading=!1,a.errorMessage=!1,a.flashStep=null,a.tlDateError=null,a.selectedSite=null,a.selectedRoom=null,a.selectedOpts={site:null,room:null,step:1,baseTimeline:null,tlName:"",confirmedDates:!1,tlDates:{}},a.selectOption=function(b,c){"room"==b?e(c):"site"==b?(a.selectedSite=c,a.selectedOpts.site=c._id,a.selectedOpts.step++):(a.selectedOpts[b]=c,"step"!=b&&a.selectedOpts.step++),a.savedTL=null,a.tlDateError=null},a.changeStart=function(){a.watchStart&&(a.flippedDateWarning="This room does not have a flipped date, so any tasks which need to occur after a room is flipped will be saved to the room's TBD task object. You can view these under the room's detail page.",a.endDateWarning="This room does not have an end date, so any tasks which need to occur after a room is finished will be saved to the room's TBD task object. You can view these under the room's detail page.")},a.changeDate=function(b){a.tlDateError=null,a.savedTL=null,a[b]?"roomStartDate"==b?(a.startDateWarning=null,a.roomStartDate=d.standardizeDate(new Date(a.roomStartDate))):"roomFlippedDate"==b?(a.flippedDateWarning=null,a.roomFlippedDate=d.standardizeDate(new Date(a.roomFlippedDate))):"roomEndDate"==b&&(a.roomEndDate=d.standardizeDate(new Date(a.roomEndDate)),a.endDateWarning=null):"roomStartDate"==b?a.startDateWarning="This room does not have a start date, which is required to build a timeline. Please set one now.":"roomFlippedDate"==b?a.flippedDateWarning="This room does not have a flipped date, so any tasks which need to occur after a room is flipped will be saved to the room's TBD task object. You can view these under the room's detail page.":"roomEndDate"==b&&(a.endDateWarning="This room does not have an end date, so any tasks which need to occur after a room is finished will be saved to the room's TBD task object. You can view these under the room's detail page.")},a.ignoreError=function(){f(a.selectedOpts)},a.saveTimeline=function(){if(a.selectedOpts.tlDates={startDate:a.roomStartDate,flippedDate:a.roomFlippedDate,endDate:a.roomEndDate},a.errorMessage=g(a.selectedOpts),a.errorMessage)a.loading=!1,c(function(){a.flashStep=null},1650);else{var d={room:a.selectedOpts.room,startDate:a.selectedOpts.tlDates.startDate};b.checkTLDates(d).then(function(){console.log("save"),f(a.selectedOpts)})["catch"](function(b){a.tlDateError="Looks like you may have already generated "+b.data+" tasks using this room and dates. Proceed anyway?"})["finally"](function(){a.loading=!1})}},a.datePickers=[!1,!1,!1],a.selectDate=function(b,c){console.log("index: ",c),a.datePickers[c]===!0?a.datePickers.length=0:a.datePickers[c]=!0},a.altInputFormats=["M!/d!/yyyy"],a.calOpts={showWeeks:!1},a.dateFormat="EEEE, MMMM d",a.dateOptions={dateDisabled:!1,formatYear:"yy",maxDate:new Date(2019,8,22),minDate:new Date(2016,4,20),startingDay:1}}]),!function(a,b){function c(a){if(!("clientX"in a||"clientY"in a)){var b=a.touches||a.originalEvent.touches;b&&b.length&&(a.clientX=b[0].clientX,a.clientY=b[0].clientY),a.preventDefault()}}function d(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}function e(a,b){var c=d(a);c.length>0?c.after(b):a.parent().prepend(b)}function f(a,c){if(a instanceof b.element&&(a=a[0]),null!==i)return a[i](c)}var g=b.module("angular-sortable-view",[]);g.directive("svRoot",[function(){function a(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}function b(a){return i[a]}function c(a){delete i[a]}function d(a){return[{x:a.left,y:a.top},{x:a.left+a.width,y:a.top},{x:a.left,y:a.top+a.height},{x:a.left+a.width,y:a.top+a.height},{x:a.left+a.width/2,y:a.top+a.height/2}]}function g(a,b){return a.x>=b[0].x&&a.x<=b[1].x&&a.y>=b[0].y&&a.y<=b[2].y?0:Math.min.apply(Math,b.map(function(b){return(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)}))}var h,i=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(j,k,l,m){var n=l(k.svRoot)(j)||j.$id;i[n]||(i[n]=[]);var o,p,q,r,s,t,u=!1,v=m(k.svOnSort);k.svOnStart=k.$$element[0].attributes["sv-on-start"],k.svOnStart=k.svOnStart&&k.svOnStart.value,k.svOnStop=k.$$element[0].attributes["sv-on-stop"],k.svOnStop=k.svOnStop&&k.svOnStop.value;var w=m(k.svOnStart),x=m(k.svOnStop);if(this.sortingInProgress=function(){return h},k.svGrid){if(null===(u="true"===k.svGrid||"false"!==k.svGrid&&null))throw"Invalid value of sv-grid attribute"}else j.$watchCollection(function(){return b(n)},function(a){u=!1;var b=a.filter(function(a){return!a.container}).map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(u=!0)})})});this.$moveUpdate=function(c,i,k,l,m,v,x){var y=k[0].getBoundingClientRect();"element"===c.tolerance&&(i={x:~~(y.left+y.width/2),y:~~(y.top+y.height/2)}),h=!0,o=[],p||(m?(p=m.clone(),p.removeClass("ng-hide")):(p=l.clone(),p.addClass("sv-visibility-hidden"),p.addClass("sv-placeholder"),p.css({height:y.height+"px",width:y.width+"px"})),l.after(p),v.copyMode||l.addClass("ng-hide"),s=l,q=c,r=k,w(j,{$helper:{element:r},$part:v.model(v.scope),$index:x,$item:v.model(v.scope)[x]}),j.$root&&j.$root.$$phase||j.$apply()),r[0].reposition({x:i.x+document.body.scrollLeft-i.offset.x*y.width,y:i.y+document.body.scrollTop-i.offset.y*y.height}),b(n).forEach(function(b,e){if(null==c.containment||f(b.element,c.containment)||f(b.element,c.containment+" *")){var h=b.element[0].getBoundingClientRect(),j=d(h),k={x:~~(h.left+h.width/2),y:~~(h.top+h.height/2)},l={x:~~(h.left+h.width/2),y:~~h.top},m={x:~~h.left,y:~~(h.top+h.height/2)};if(!b.container&&(b.element[0].scrollHeight||b.element[0].scrollWidth)){var n=b.getPart();o.push({element:b.element,q:g(i,j),view:n,targetIndex:b.getIndex(),after:a(k,i,"isGrid"in n?n.isGrid:u)})}if(b.container&&!b.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")){var p=k;"vertical"===b.centerVariant?p=m:"horizontal"===b.centerVariant&&(p=l),o.push({element:b.element,q:(p.x-i.x)*(p.x-i.x)+(p.y-i.y)*(p.y-i.y),view:b.getPart(),targetIndex:0,container:!0})}}});var z=p[0].getBoundingClientRect();o.push({q:g(i,d(z)),element:p,placeholder:!0}),o.sort(function(a,b){return a.q-b.q}),o.forEach(function(a,b){0!==b||a.placeholder||a.container?0===b&&a.container?(t=a,a.element.append(p)):a.element.removeClass("sv-candidate"):(t=a,a.element.addClass("sv-candidate"),a.after?a.element.after(p):e(a.element,p))})},this.$drop=function(a,b,c){function d(){if(h=!1,p.remove(),r.remove(),s.removeClass("ng-hide"),o=void 0,p=void 0,c=void 0,r=void 0,s=void 0,x(j,{$part:a.model(a.scope),$index:b,$item:a.model(a.scope)[b]}),t){t.element.removeClass("sv-candidate");var d=a.model(a.scope).splice(b,1),e=t.targetIndex;t.view===a&&t.targetIndex>b&&e--,t.after&&e++,t.view.model(t.view.scope).splice(e,0,d[0]),t.view===a&&b===e||v(j,{$partTo:t.view.model(t.view.scope),$partFrom:a.model(a.scope),$item:d[0],$indexTo:e,$indexFrom:b})}t=void 0,j.$root&&j.$root.$$phase||j.$apply()}if(p)if(!c.revert||t&&t.view&&t.view.noRevert)d();else{var e=p[0].getBoundingClientRect(),f=r[0].getBoundingClientRect(),g=Math.sqrt(Math.pow(f.top-e.top,2)+Math.pow(f.left-e.left,2)),i=+c.revert*g/200;i=Math.min(i,+c.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){void 0!==r[0].style[a+"transition"]&&(r[0].style[a+"transition"]="all "+i+"ms ease")}),setTimeout(d,i),r.css({top:e.top+document.body.scrollTop+"px",left:e.left+document.body.scrollLeft+"px"})}},this.addToSortableElements=function(a){b(n).push(a)},this.removeFromSortableElements=function(a){var d=b(n),e=d.indexOf(a);e>-1&&(d.splice(e,1),0===d.length&&c(n))}}]}}]),g.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){a.$ctrl=this,this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)}}],scope:!0,link:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,copyMode:"true"===d.svCopy,noRevert:"true"===d.svNoRevert,scope:b},"isGrid"in d&&(b.part.isGrid="true"===d.isGrid),b.$sortableRoot=e;var g={element:c,getPart:b.$ctrl.getPart,container:!0,centerVariant:d.svCenter||"both"};e.addToSortableElements(g),b.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]),g.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(d,e,f,g){function h(h){function i(a){c(a),n||(e.parent().prepend(r),n=!0),g[1].$moveUpdate(p,{x:a.clientX,y:a.clientY,offset:u},r,e,m,g[0].getPart(),d.$index)}if(c(h),!g[1].sortingInProgress()&&(0==h.button||"mousedown"!==h.type)){var k=h.target.attributes["sv-handle-disabled"];if(!k||"true"!==k.value){n=!1;var p=a(f.svElement)(d);if(p=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},p),p.containment)var q=j.call(e,p.containment)[0].getBoundingClientRect();var r,s=e,t=e[0].getBoundingClientRect();l||(l=g[0].helper),m||(m=g[0].placeholder),l?(r=l.clone(),r.removeClass("ng-hide"),r.css({left:t.left+document.body.scrollLeft+"px",top:t.top+document.body.scrollTop+"px"}),s.addClass("sv-visibility-hidden")):(r=s.clone(),r.addClass("sv-helper").css({left:t.left+document.body.scrollLeft+"px",top:t.top+document.body.scrollTop+"px",width:t.width+"px"})),r[0].reposition=function(a){var b=a.x,c=a.y,d=r[0].getBoundingClientRect(),e=document.body;q&&(c<q.top+e.scrollTop&&(c=q.top+e.scrollTop),c+d.height>q.top+e.scrollTop+q.height&&(c=q.top+e.scrollTop+q.height-d.height),b<q.left+e.scrollLeft&&(b=q.left+e.scrollLeft),b+d.width>q.left+e.scrollLeft+q.width&&(b=q.left+e.scrollLeft+q.width-d.width)),this.style.left=b-e.scrollLeft+"px",this.style.top=c-e.scrollTop+"px"};var u={x:(h.clientX-t.left)/t.width,y:(h.clientY-t.top)/t.height};o.addClass("sv-sorting-in-progress"),o.on("mousemove touchmove",i).on("mouseup touchend touchcancel",function v(a){o.off("mousemove touchmove",i),o.off("mouseup touchend touchcancel",v),o.removeClass("sv-sorting-in-progress"),n&&g[0].$drop(d.$index,p),e.removeClass("sv-visibility-hidden")})}}}var i={element:e,getPart:g[0].getPart,getIndex:function(){return d.$index}};g[1].addToSortableElements(i),d.$on("$destroy",function(){g[1].removeFromSortableElements(i)});var k=e;k.on("mousedown touchstart",h),d.$watch("$ctrl.handle",function(a){a&&(k.off("mousedown touchstart",h),k=a,k.on("mousedown touchstart",h))});var l;d.$watch("$ctrl.helper",function(a){a&&(l=a)});var m;d.$watch("$ctrl.placeholder",function(a){a&&(m=a)});var n,o=(b.element(document.body),b.element(document.documentElement))}}}]),g.directive("svHandle",function(){return{require:"?^svElement",link:function(a,b,c,d){d&&(d.handle=b.add(d.handle))}}}),g.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-helper").addClass("ng-hide"),d[1]?d[1].helper=b:d[0]&&(d[0].helper=b)}}}),g.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-placeholder").addClass("ng-hide"),d[1]?d[1].placeholder=b:d[0]&&(d[0].placeholder=b)}}}),b.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var h=document.documentElement,i=h.matches?"matches":h.matchesSelector?"matchesSelector":h.webkitMatches?"webkitMatches":h.webkitMatchesSelector?"webkitMatchesSelector":h.msMatches?"msMatches":h.msMatchesSelector?"msMatchesSelector":h.mozMatches?"mozMatches":h.mozMatchesSelector?"mozMatchesSelector":null;if(null==i)throw"This browser doesn't support the HTMLElement.matches method";var j=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&!c[i](a);)c=c.parentNode;return c[i](a)?b.element(c):b.element()};"function"!=typeof b.element.prototype.add&&(b.element.prototype.add=function(a){var c,d=b.element();for(a=b.element(a),c=0;c<this.length;c++)d.push(this[c]);for(c=0;c<a.length;c++)d.push(a[c]);return d})}(window,angular);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),LoginController=function(){function a(b,c,d){var e=this;_classCallCheck(this,a),this.user={},this.errors={},this.submitted=!1,this.Auth=b,this.$state=c,this.loggedInUser=null,d.$on("logged-in",function(a,b){b.role&&(e.loggedInUser=b)})}return a.$inject=["Auth","$state","$rootScope"],_createClass(a,[{key:"login",value:function(a){var b=this;this.submitted=!0,a.$valid&&this.Auth.login({firstName:this.user.firstName,password:this.user.password}).then(function(){b.$state.go("main")})["catch"](function(a){b.errors.other=a.message})}},{key:"goHome",value:function(){this.$state.go("main")}}]),a}();angular.module("petalApp").controller("LoginController",LoginController),function(){function a(a,b,c,d,e,f,g,h,i,j,k){var l=f.safeCb,m={},n=e.userRoles||[],o={loggingIn:!1,login:function(a,e){var f=this,j=a.firstName,k=a.password;return this.loggingIn=!0,b.post("/auth/local",{firstName:j,password:k}).then(function(a){c.put("token",a.data.token);var b={firstName:j,password:k};return h.set("petal-loginCreds",JSON.stringify(b)),m=g.get(),m.$promise}).then(function(a){return l(e)(null,a),i.$emit("logged-in",a),f.loggingIn=!1,a})["catch"](function(a){return o.logout(),l(e)(a.data),i.$emit("logged-out"),f.loggingIn=!1,d.reject(a.data)})},logout:function(){c.remove("token"),m={},h.set("loginCreds",{}),i.$emit("logged-out"),this.loggingIn=!1},createUser:function(a,b){return g.save(a,function(d){return c.put("token",d.token),m=g.get(),l(b)(null,a)},function(a){return o.logout(),l(b)(a)}).$promise},changePassword:function(a,b,c){return g.changePassword({id:m._id},{oldPassword:a,newPassword:b},function(){return l(c)(null)},function(a){return l(c)(a)}).$promise},getCurrentUser:function(a){if(0===arguments.length)return m;var b=m.hasOwnProperty("$promise")?m.$promise:m;return d.when(b).then(function(b){return l(a)(b),b},function(){return l(a)({}),{}})},isLoggedIn:function(a){return 0===arguments.length?m.hasOwnProperty("role"):o.getCurrentUser(null).then(function(b){var c=b.hasOwnProperty("role");return l(a)(c),c})},hasRole:function p(a,b){var p=function(a,b){return n.indexOf(a)>=n.indexOf(b)};return arguments.length<2?p(m.role,a):o.getCurrentUser(null).then(function(c){var d=!!c.hasOwnProperty("role")&&p(c.role,a);return l(b)(d),d})},isAdmin:function(){return o.hasRole.apply(o,[].concat.apply(["admin"],arguments))},getToken:function(){return c.get("token")},restrictState:function(){o.getCurrentUser(null).then(function(a){return console.log("user",a),a.hasOwnProperty("role")?(console.log("logged in!"),d.when()):(k(function(){j.go("login")}),d.reject())})["catch"](function(a){return k(function(){j.go("login")}),d.reject()})}};return o}a.$inject=["$location","$http","$cookies","$q","appConfig","Util","User","localStorageService","$rootScope","$state","$timeout"],angular.module("petalApp.auth").factory("Auth",a)}(),function(){function a(a,b,c,d,e,f){var g;return{request:function(a){return a.headers=a.headers||{},c.get("token")&&e.isSameOrigin(a.url)&&(a.headers.Authorization="Bearer "+c.get("token")),a.headers.AppVersion=f.appVersion,a.headers.requestTime=new Date,a},responseError:function(a){return 401===a.status&&("download"!==(g||(g=d.get("$state"))).current.name&&(g||(g=d.get("$state"))).go("login"),c.remove("token")),b.reject(a)}}}a.$inject=["$rootScope","$q","$cookies","$injector","Util","appConfig"],angular.module("petalApp.auth").factory("authInterceptor",a)}(),function(){angular.module("petalApp.auth").run(["$rootScope","$state","Auth","localStorageService","$location",function(a,b,c,d,e){var f=void 0,g=d.get("petal-loginCreds");g&&(f=JSON.parse(g)),f&&"/logout"!==e.path()&&c.login(f,function(a){}),a.$on("$stateChangeStart",function(a,d){d.authenticate&&("string"==typeof d.authenticate?c.hasRole(d.authenticate,_.noop).then(function(d){if(!d)return a.preventDefault(),c.isLoggedIn(_.noop).then(function(a){b.go(a?"main":"login")})}):c.isLoggedIn(_.noop).then(function(c){c||(a.preventDefault(),b.go("login"))}))})}])}(),function(){function a(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}a.$inject=["$resource"],angular.module("petalApp.auth").factory("User",a)}(),angular.module("petalApp").directive("baseObjAccordion",function(){return{templateUrl:"components/baseObjAccordion/baseObjAccordion.html",restrict:"E",scope:{accordionObj:"=",deleteObject:"=",editObject:"=",viewDashboard:"="},link:function(a,b,c){var d={site:"room",room:"task",task:"task"};a.childType=d[a.accordionObj.__t.toLowerCase()],a.childTypePlural=a.childType+"s"}}}),angular.module("petalApp").controller("BaseObjCtrl",["$scope","BaseObjectService","Modal",function(a,b,c){console.log("scope! : ",a.baseObj),a.showBaseObj=!1;var d={site:"room",room:"task",task:"task"};!function(){a.childType=d[a.modelType.toLowerCase()],a.childTypePlural=a.childType+"s",a.savedBaseObj?a.baseObj=a.savedBaseObj:a.baseObj={}}(),a.createNew=function(){a.selectedAction="create",a.savedBaseObj=void 0,a.childSaveCallback=function(b){a.baseObj[a.childTypePlural]||(a.baseObj[a.childTypePlural]=[]),a.baseObj[a.childTypePlural].push(b),a.showBaseObj=!1},a.showBaseObj=!0},a.closeBaseView=function(){a.showBaseObj=!1},a.saveObject=function(){function c(b){a.baseObj=b.data,a.saveCallback&&a.saveCallback(b.data)}function d(a){console.log("errOr: ",a)}if(console.log("base: ",a.baseObj),a.baseObj._id){for(var e=[],f=0;f<a.baseObj[a.childTypePlural].length;f++)e.push(a.baseObj[a.childTypePlural][f]);b.editObject(a.modelType,a.baseObj._id,a.baseObj,a.childTypePlural).then(function(b){console.log("response: ",b),a.baseObj=b.data,a.baseObj[a.childTypePlural]=e,console.log("baseobj after edit: ",a.baseObj),a.saveCallback&&a.saveCallback(a.baseObj)})["catch"](d)}else b.createObject(a.modelType,a.baseObj).then(c)["catch"](d)},a.editObject=function(b){console.log("baseObj 2 edit: ",b),a.selectedAction="edit",a.savedBaseObj=b,a.childSaveCallback=function(b){a.baseObj[a.childTypePlural]||(a.baseObj[a.childTypePlural]=[]);for(var c=a.baseObj[a.childTypePlural],d=0;d<c.length;d++)if(c[d]._id==b._id){c[d]=b;break}a.showBaseObj=!1},a.showBaseObj=!0},a.deleteObject=function(d){c.confirm["delete"](function(){console.log("delete: ",d),b.deleteObject(a.childType,d._id).then(function(b){for(var c=a.baseObj[a.childTypePlural],e=0;e<c.length;e++)if(c[e]._id==d._id){a.baseObj[a.childTypePlural].splice(e,1);break}})})("the "+d.__t+" "+d.name)},a.baseObj.startDate||(a.baseObj.startDate=new Date),a.baseObj.endDate||(a.baseObj.endDate=new Date),a.calOpts={showWeeks:!1},a.changedTime=function(){console.log("baseObj: ",a.baseObj)},a.viewDashboard=function(a){console.log("site: ",a)}}]),angular.module("petalApp").directive("baseObject",function(){return{templateUrl:"components/baseObject/baseObject.html",restrict:"E",scope:{modelType:"@",selectedAction:"@",closeView:"=",savedBaseObj:"=",saveCallback:"="},controller:"BaseObjCtrl",link:function(a,b,c){}}}),angular.module("petalApp").filter("digitFilter",function(){return function(a){return a<10&&(a="0"+a),a}}),angular.module("petalApp").directive("toggleArrow",function(){return{templateUrl:"components/directives/toggleArrow/toggleArrow.html",restrict:"EA",scope:{toggle:"="}}});var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SettingsController=function(){function a(b){_classCallCheck(this,a),this.Auth=b}return a.$inject=["Auth"],_createClass(a,[{key:"changePassword",value:function(a){var b=this;this.submitted=!0,a.$valid&&this.Auth.changePassword(this.user.oldPassword,this.user.newPassword).then(function(){b.message="Password successfully changed."})["catch"](function(){a.password.$setValidity("mongoose",!1),b.errors.other="Incorrect password",b.message=""})}}]),a}();angular.module("petalApp").controller("SettingsController",SettingsController),function(){function a(a){return a("/api/site/:id/:controller",{id:"@_id"},{})}a.$inject=["$resource"],angular.module("petalApp.factories").factory("SiteFactory",a)}(),angular.module("petalApp").factory("timelineFactory",function(){var a={};return a.toggledRooms=[],a.toggleRoom=function(b){a.toggledRooms.push(b)},a.get=function(b){return a[b]},a.set=function(b,c){a[b]=c},a.watch=function(b,c,d){return b.$watch(function(){return a.get(c)},function(a,e){a!==e&&(b[c]=a,angular.isFunction(d)&&d(a,e))})},a}),angular.module("petalApp").directive("ngFooter",function(){return{templateUrl:"components/footer/footer.html",restrict:"E",link:function(a,b){b.addClass("footer")}}}),angular.module("petalApp").controller("MasterTaskModalCtrl",["$uibModalInstance","$scope","TimelineUtils","TimelineTaskService","$timeout","Modal",function(a,b,c,d,e,f){function g(a){a.relationshipType&&a.type&&b.occurrenceUnit&&b.occurrenceUnit.length&&!(!a.occurrenceDay.value<0)&&a.occurrenceDay.type&&a.event?(console.log("here!"),i(a),b.disablePreview=!1):(b.eventPreviewStandard="",b.eventPreviewShort="",b.eventPreviewLong="",b.disablePreview=!0)}function h(){b.selectedTime.week&&b.selectedTime.day&&b.modalTask.occurrenceObj.occurrenceDay.type?(b.buildPeriodPreview(),b.disablePreview=!1):(b.periodPreview=!1,b.disablePreview=!0)}function i(a){var c;1==a.occurrenceDay.value?b.occurrenceUnit:b.occurrenceUnit+"s";c="lights-flipped-to-flower"!=a.event?"the-"+a.event:"lights-flip-to-flower",c=c.replace(/-/g," "),b.eventPreviewStandard=j(b.occurrenceUnit,a.occurrenceDay.value,77)+" "+a.relationshipType+" "+c+" in a standard 77 day cycle.","day"==a.occurrenceDay.type?(b.eventPreviewLong=j(b.occurrenceUnit,a.occurrenceDay.value,77)+a.relationshipType+" "+c+" in a 84 day cycle.",b.eventPreviewShort=j(b.occurrenceUnit,a.occurrenceDay.value,77)+a.relationshipType+" "+c+" in a 63 day cycle."):(console.log("occurenceObj: ",a),b.eventPreviewLong=j(b.occurrenceUnit,a.occurrenceDay.value,84)+a.relationshipType+" "+c+" in a 84 day cycle.",b.eventPreviewShort=j(b.occurrenceUnit,a.occurrenceDay.value,63)+a.relationshipType+" "+c+" in a 63 day cycle.")}function j(a,b,c){"week"==a&&(b=7*b);var d=b/77,e=Math.round((d*c).toFixed(2));e||(e=1);var f="";return f=1==e?e+" day ":e+" days "}function k(){b.modalTask&&b.modalTask.occurrenceObj&&("veg"==b.modalTask.occurrenceObj.type||"flower"==b.modalTask.occurrenceObj.type?(delete b.modalTask.occurrenceObj.relationshipType,delete b.modalTask.occurrenceObj.relatedTo,delete b.modalTask.occurrenceObj.event,delete b.modalTask.weekFlag,b.selectedTime.day&&b.selectedTime.week&&(b.modalTask.occurrenceObj.occurrenceDay.value=c.calculateDayFromPeriodWeek(b.selectedTime.day,b.selectedTime.week))):"event"==b.modalTask.occurrenceObj.type&&("week"==b.occurrenceUnit?b.modalTask.weekFlag=!0:b.modalTask.weekFlag=!1))}b.occurrenceUnit=b.modalTask.occurrenceUnit||"",b.stageWeeks=[],b.timeEstimateOpts=[{value:"light",name:"Light"},{value:"reservoir",name:"Reservoir"},{value:"plant",name:"Plant"},{value:"room",name:"Room"},{value:"table",name:"Table"}];var l={flower:{weeks:8},veg:{weeks:3}};b.updateTask=!1,b.selectedTime={week:null,day:null},b.getWeeks=function(){return"veg"==b.modalTask.stage?new Array(3):new Array(8)},b.setTime=function(a,c){b.modalTask.weekDay=c,b.modalTask.week=a},b.isActiveDay=function(a,c){return b.modalTask.weekDay==c&&b.modalTask.week==a},b.save=function(){k(),b.showError=!1,b.loading=!0,e(function(){b.modalTask.title?b.modalTask.occurrenceObj.type&&b.modalTask.occurrenceObj.occurrenceDay.value&&b.modalTask.occurrenceObj.occurrenceDay.type?(b.showError=!1,b.loading=!0,b.updateTask?d.updateMasterTask(b.modalTask).then(function(c){console.log("res: ",c),a.close(b.modalTask)})["catch"](function(a){b.errorMessage=a,b.showError=!0})["finally"](function(){b.loading=!1}):d.saveNewMasterTask(b.modalTask).then(function(b){a.close(b)})["catch"](function(a){b.errorMessage=a,b.showError=!0})["finally"](function(){b.loading=!1})):(b.loading=!1,b.errorMessage="Please indicate when this task occurs.",b.showError=!0):(b.loading=!1,b.errorMessage="Please include a title.",b.showError=!0)},500)},b.cancel=function(){a.dismiss()},b.setOccurrenceTime=function(a){b.modalTask.occurrenceTime=a},b.vegTasks=[],b.flowerTasks=[],b.disablePreview=!0,b.$watch("modalTask.occurrenceObj",function(a,c){c!==a&&("event"==a.type&&g(a),"veg"!=a.type&&"flower"!=a.type||h(a)),b.showError=!1},!0),b.$watch("selectedTime",function(a,b){b!=a&&h()},!0),b.$watch("modalTask",function(){b.showError=!1},!0),b.buildPeriodPreview=function(){if("day"==b.modalTask.occurrenceObj.occurrenceDay.type)b.periodPreviewStandard="in W"+b.selectedTime.week+"-"+b.modalTask.occurrenceObj.type+" (d-"+b.selectedTime.day+") in a standard 77 day cycle.",b.periodPreviewShort="in W"+b.selectedTime.week+"-"+b.modalTask.occurrenceObj.type+" (d-"+b.selectedTime.day+") in a 63 day cycle.",b.periodPreviewLong="in W"+b.selectedTime.week+"-"+b.modalTask.occurrenceObj.type+" (d-"+b.selectedTime.day+") in a 84 day cycle.";else{b.periodPreviewStandard="in W"+b.selectedTime.week+"-"+b.modalTask.occurrenceObj.type+" (d-"+b.selectedTime.day+") in a standard 77 day cycle.";var a=c.findTaskOccurrence(b.modalTask.occurrenceObj.type,null,b.selectedTime.day,b.selectedTime.week,63),d=c.findTaskOccurrence(b.modalTask.occurrenceObj.type,null,b.selectedTime.day,b.selectedTime.week,84);b.periodPreviewShort="in W"+a.periodWeek+"-"+b.modalTask.occurrenceObj.type+" (d-"+a.periodDay+") in a 63 day cycle.",
b.periodPreviewLong="in W"+d.periodWeek+"-"+b.modalTask.occurrenceObj.type+" (d-"+d.periodDay+") in a 84 day cycle.";c.findTaskOccurrence(b.modalTask.occurrenceObj.type,null,b.selectedTime.day,b.selectedTime.week,77)}},b.calculateOccurrenceInCustomCycle=function(){var a=c.findTaskOccurrence(b.modalTask.occurrenceObj.type,null,b.selectedTime.day,b.selectedTime.week,b.customCycleLength);b.periodPreviewCustom="in W"+a.periodWeek+"-"+b.modalTask.occurrenceObj.type+" (d-"+a.periodDay+") in a "+b.customCycleLength+" day cycle."},b.calculateCustom=function(a){var c;1==a.occurrenceDay.value?b.occurrenceUnit:b.occurrenceUnit+"s";c="lights-flipped-to-flower"!=a.event?"the-"+a.event:"lights-flip-to-flower",c=c.replace(/-/g," "),"day"==a.occurrenceDay.type?b.eventPreviewCustom=j(b.occurrenceUnit,a.occurrenceDay.value,77)+a.relationshipType+" "+c+" in a "+b.customCycleLength+"  day cycle.":b.eventPreviewCustom=j(b.occurrenceUnit,a.occurrenceDay.value,b.customCycleLength)+a.relationshipType+" "+c+" in a "+b.customCycleLength+"  day cycle."},b.buildStageWeeks=function(a){var c=l[a].weeks;b.selectedTime={week:null,day:null},b.stageWeeks=[];for(var d=1;d<=c;d++)b.stageWeeks.push(d)},b.selectTime=function(a,c){b.selectedTime[c]=a,b.stageDays=[];for(var d=1;d<8;d++)b.stageDays.push(d)},b.resetModalTask=function(){f.confirm.update(function(){b.modalTask=_.cloneDeep(b.cleanTask),m()})("Master Task : "+b.cleanTask.title,"reset","This will remove any unsaved changes and restore the last saved fields.")};var m=function(){b.buildStageWeeks(b.modalTask.occurrenceObj.type);var a=c.findDayAndWeek(b.modalTask.occurrenceObj.occurrenceDay.value);b.selectTime(a.week,"week"),b.selectTime(a.day,"day"),b.updateTask=!0};b.modalTask.occurrenceObj&&m()}]),angular.module("petalApp").factory("Modal",["$rootScope","$uibModal",function(a,b){function c(){var c=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],d=arguments.length<=1||void 0===arguments[1]?"modal-default":arguments[1],e=a.$new();return angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}function d(){var c=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],d=arguments.length<=1||void 0===arguments[1]?"modal-default":arguments[1],e=arguments[2],f=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],g=a.$new();return angular.extend(g,c),b.open({templateUrl:e,windowClass:d,controller:f,scope:g,size:"lg"})}function e(a,b,c){return"mark-complete"==a?"<p>Are you sure you wish to mark the task <strong>"+b+"</strong> for <strong>"+c+"</strong> complete?</p>":"mark-incomplete"==a?"<p>You can mark the task incomplete or update the completed date for the task: <strong>"+b+"</strong> for <strong>"+c+"</strong> incomplete?</p>":"save-problem"==a?"<p>Are you sure you wish to save a problem with the task: <strong>"+b+"</strong> for <strong>"+c+"</strong>?</p>":"delete-problem"==a?"<p>You can update the problem info or remove it altogether for the task: <strong>"+b+"</strong> for <strong>"+c+"</strong>?</p>":void 0}var f={showWeeks:!1},g={dateDisabled:!1,formatYear:"yy",maxDate:new Date,minDate:new Date(2016,4,20),startingDay:1},h=[];return{confirm:{"delete":function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){console.log("args: ",d);var b,d=Array.prototype.slice.call(arguments),e=d.shift(),f=d.shift();console.log("text before",f);var g="Are you sure you want to delete ";f&&(g+=f),b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>"+g+"<strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){console.log("here"),a.apply(b,d)})}},select:function i(){var i=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var a,b=Array.prototype.slice.call(arguments),d=b.shift(),e=b.shift(),f=[];e.map(function(b){var c={classes:"btn-green",text:b.title,value:b.value,click:function(b,c){a.close(this.value)}};f.push(c)}),a=c({modal:{dismissable:!0,title:d,html:"<p>What type of task will this be?</p>",buttons:f}},"modal-green"),a.result.then(function(a){i(a)})}},update:function j(){var j=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var a,b=Array.prototype.slice.call(arguments),d=b.shift(),e=b.shift(),f=b.shift();a=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to "+e+" the <strong>"+d+"</strong>?</p><p>"+f+"</p>",buttons:[{classes:"btn-green",text:"Confirm",click:function(b){a.close(b)}},{classes:"btn-default",text:"Cancel",click:function(b){a.dismiss(b)}}]}},"modal-green"),a.result.then(function(a){j.apply(a,b)})}},edit:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){function b(a,b){v[b]===!0?v.length=0:v[b]=!0}var d,h,i,j=Array.prototype.slice.call(arguments),k=j.shift(),l=j.shift(),m=j.shift(),n=j.shift(),o=!1,p=j.shift(),q=j.shift(),r=j.shift(),s=j.shift(),t=j.shift(),u=j.shift(),v=[!1],w=j.shift(),x=j.shift();"save-problem"==l||"delete-problem"==l?(o=!0,h="(Optional) Problem info:",i=s):(s=null,console.log("completed: ",u),i=u),d=c({modal:{dismissable:!0,title:k,html:e(l,m,n),showInput:o,inputTitle:h,showDatePicker:t,completedDate:u,datePickers:v,calOpts:f,dateOptions:g,editInfo:i,showUpdateButton:w,selectDate:b,buttons:[{classes:q,text:r,click:function(a,b){d.close(b)}},{classes:"btn-default",text:"Cancel",click:function(a){d.dismiss(a)}}],updateButton:{classes:"btn-danger",text:x,click:function(a){d.close("delete")}}}},p),d.result.then(function(b){a(b)})}}},create:{newTask:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b,c=Array.prototype.slice.call(arguments),e=c.shift();b=d({modal:{dismissable:!0,title:"New Task"},modalTask:{occurrenceObj:{occurrenceDay:{}}},currentTasks:e},"modal-positive","components/timelineTask/timelineTaskModal.html","TimelineTaskController"),b.result.then(function(b){a(b)})}}},taskModal:{create:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b,c=Array.prototype.slice.call(arguments),e=c.shift(),f=c.shift();b=d({modal:{dismissable:!0,title:"New "+e+" task"},modalTask:{occurrenceObj:{occurrenceDay:{}}},taskType:e,sites:f},"modal-positive","components/timelineTask/timelineTaskModal.html","TimelineTaskController"),b.result.then(function(b){a(b)})}},edit:function k(){var k=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var a,b=Array.prototype.slice.call(arguments),c=b.shift(),e=_.cloneDeep(c),f="Task";e.title&&(f="Task : "+e.title),console.log("modalTask: ",e),a=d({modal:{dismissable:!0,title:f},modalTask:e,cleanTask:c,taskType:"edit"},"modal-positive","components/timelineTask/timelineTaskModal.html","TimelineTaskController"),a.result.then(function(a){k(a)})}}},show:{masterTaskModal:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b,c=Array.prototype.slice.call(arguments),e=c.shift(),f=_.cloneDeep(e),g="Task";f.title&&(g="Task : "+f.title),f&&f.occurrenceObj||(f.occurrenceObj={occurrenceDay:{}}),b=d({modal:{dismissable:!0,title:g},modalTask:f,cleanTask:e},"modal-positive","components/masterTask/masterTaskModal.html","MasterTaskModalCtrl"),b.result.then(function(b){a(b)})}},taskImage:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b=(Array.prototype.slice.call(arguments),d({modal:{dismissable:!0,title:"Image Upload"}},"modal-positive","components/taskImage/taskImage.html","TaskImageCtrl"));b.result.then(function(b){a(b)})}},parentTask:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b=Array.prototype.slice.call(arguments);console.log("arg: ",b[0]);var c=d({modal:{dismissable:!0,title:"This task's parent task"},selectedTask:b[0]},"modal-positive","components/parentTask/parentTask.html","ParentTaskCtrl");c.result.then(function(b){a(b)})}}},edit:{editMasterTask:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b,c=Array.prototype.slice.call(arguments),e=c.shift();console.log("modalTask",e),b=d({modal:{dismissable:!0,title:"Edit Task",buttons:[{classes:"btn-success",text:"Save",click:function(a){b.close(e)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]},modalTask:e},"modal-positive","components/timelineTask/timelineTaskModal.html","TimelineTaskController"),b.result.then(function(b){a(b)})}},editChildTask:function(){var a=arguments.length<=0||void 0===arguments[0]?angular.noop:arguments[0];return function(){var b,c=Array.prototype.slice.call(arguments),e=c.shift(),f=_.cloneDeep(e);b=d({modal:{dismissable:!0,title:"Edit Task",buttons:[{classes:"btn-success",text:"Save",click:function(a){b.close(e)}},{classes:"btn-default",text:"Cancel",click:function(a){console.log("e"),b.dismiss(a)}}]},modalTask:_.cloneDeep(e),cleanTaskCopy:f},"modal-positive","components/timelineTask/editChildTaskModal.html","EditChildTaskController"),b.result.then(function(b){console.log("modalTask",b),a(b)})}}},buildTimeline:function(a){console.log("new timeline builder!");var b;b=d({modal:{dismissable:!0,title:"Timeline Builder"},sites:a},"modal-positive","components/roomTimelineBuilder/timelineBuilder.html","RoomTimelineBuilderCtrl")},reoccurringTest:function(a){var b;b=d({modal:{dismissable:!0,title:"Reoccuring Tasks Test"},sites:a},"modal-positive","components/reoccurringTest/reoccurringTest.html","ReoccurringTestCtrl")},timelineModal:function(a){var b=a?"Edit Timeline Template":"New Timeline Template";d({modal:{dismissable:!0,title:b},timelineObj:_.cloneDeep(a)},"modal-positive","components/timelineModal/timelineModal.html","TimelineModalCtrl")},taskGenerationModal:function(a){var b=d({modal:{dismissable:!0,title:"Generate Tasks from Timeline Template"},genInfo:_.cloneDeep(a)},"modal-positive","components/taskGenerationModal/taskGenerationModal.html","TaskGenerationModalCtrl");h.push({modalId:"generationModal",modalObj:b}),b.closed.then(function(){_.remove(h,function(a){return a.modalId&&"generationModal"===a.modalId}),console.log("open",h)})},taskGenerationErrorModal:function(a,b){var c=d({modal:{dismissable:!0,title:"Error Generating Tasks"},genErrors:_.cloneDeep(a),selectedTaskTemplate:b},"modal-danger","components/taskGenerationModal/taskGenerationErrorModal.html","TaskGenerationErrorCtrl");h.push({modalId:"generationErrorModal",modalObj:c}),c.closed.then(function(){_.remove(h,function(a){return a.modalId&&"generationErrorModal"===a.modalId}),console.log("open",h)})},hideOpenModals:function(){_.map(h,function(a){a.modalObj.hide()})}}}]),angular.module("petalApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}});var NavbarController=function a(b,c,d,e){var f=this;_classCallCheck(this,a),this.isLoggedIn=b.isLoggedIn,this.isAdmin=b.isAdmin,this.getCurrentUser=b.getCurrentUser,this.showCollapse=!1,this.state=c,d.$on("$stateChangeSuccess",function(a,b){"timeline"==b.name||"timeline.task"==b.name?(f.showCollapse=!0,d.$emit("toggle-collapse",f.showCollapse)):(f.showCollapse=!1,d.$emit("toggle-collapse",f.showCollapse))}),this.toggleCollapse=function(){this.showCollapse=!this.showCollapse,d.$emit("toggle-collapse",this.showCollapse)},this.logout=function(){b.logout()},this.login=function(){c.go("login")},this.isCurrent=function(a){if(a.state==c.current.name)return!0;if("sites"==a.state){if("dashboard"==c.current.name||"sites"==c.current.name||"editSite"==c.current.name)return!0}else if("admin"==a.state){if("admin"==c.current.name||"login"==c.current.name)return!0}else if("timeline"==a.state&&("timeline"==c.current.name||"timeline.task"==c.current.name))return!0;return!1},this.menuItems=[{title:"Timelines",state:"timeline",url:"/timeline",icon:"icon-timeline-main"},{title:"Sites",state:"sites",url:"/sites",icon:"icon-light-and-dark"},{title:"Admin",state:"admin",url:"/admin",icon:"icon-tabs-rip-sessions"},{title:"Memo",state:"memo",url:"/memo",icon:"fa fa-sticky-note-o"}]};NavbarController.$inject=["Auth","$state","$rootScope","$scope"],angular.module("petalApp").controller("NavbarController",NavbarController),angular.module("petalApp").directive("navbar",function(){return{templateUrl:"components/navbar/navbar.html",restrict:"E",controller:"NavbarController",controllerAs:"nav"}}),angular.module("petalApp").controller("ParentTaskCtrl",["$uibModalInstance","$scope","Modal","TLQueryService","TimelineTaskService","Util","TimelineUtils","TaskPriority","SiteService",function(a,b,c,d,e,f,g,h,i){function j(a){a.isMaster="masterTasks"===b.selectedAction;var c=d.buildQuery(a);b.loading=!0,e.timelineTaskQuery(c).then(function(c){c.data&&c.data.length?a.isMaster?o(c.data):k(c.data):b.availableTasks=[]})["catch"](function(a){console.log("err: ",a)})["finally"](function(){b.loading=!1})}function k(a){b.availableTasks=a,l(b.availableTasks)}function l(a){a.map(function(a){a.taskTypeFormatted=g.formatTaskType(a.taskType),a.taskColor=g.formatTaskColor(a.taskType),a.subPriority||(a.subPriority=h.getDefaultSubPriority(a.priority)),a.isMaster||a.checkTemplateObj?a.isMaster?("x-check"!=a.taskType&&"daily-check"!=a.taskType||(a.taskRepeatString=g.formatTaskRepeatString(a)),a.timeEstimate&&a.timeEstimate.amount&&(a.taskTIme={value:a.timeEstimate.amount+a.timeEstimate.unit.charAt(0)})):a.checkTemplateObj&&(a.taskTime=g.findTaskTime(a.room,a),a.siteShortName=i.getSiteShortName(a.site),a.tunnelShortName=i.getTunnelShortName(a.room),a.occurrenceDate=f.standardizeDate(new Date),a.taskRepeatString=g.formatTaskRepeatString(a)):(a.taskTime=g.findTaskTime(a.room,a),a.siteShortName=i.getSiteShortName(a.site),a.tunnelShortName=i.getTunnelShortName(a.room),a.occurrenceDate=f.standardizeDate(a.occurrenceDate))}),m(a)}function m(){var a={};b.taskCount=0;for(var c=0;c<b.availableTasks.length;c++){b.taskCount++,b.availableTasks[c].occurrenceDate=moment(f.standardizeDate(new Date(b.availableTasks[c].occurrenceDate)));var d=b.availableTasks[c].occurrenceDate;a[d]||(a[d]={tasks:[]}),a[d].tasks.push(b.availableTasks[c])}n(a)}function n(a){q=[];for(var c in a)if(a.hasOwnProperty(c)){a[c].tasks=_.orderBy(a[c].tasks,"subPriority.sortLevel","desc");var d={date:moment(new Date(c)),tasks:a[c].tasks};q.push(d)}q.sort(function(a,b){var c=new Date(a.date),d=new Date(b.date);return c-d}),b.availableTasks=q}function o(a){var c=moment(new Date),d=moment(c).add(3,"weeks");b.masterTaskFormatted=a.map(function(a){var b;return"daily-check"!=a.taskType&&"x-check"!=a.taskType?(b=g.placeTask(a,21,56,!0,!0),b=g.findTaskDate(b,c,d)):(b=a,b.occurrenceDate=c),b.tunnelShortName="Master",b.siteShortName="Master",b.isMaster=!0,b.taskTypeFormatted=g.formatTaskType(a.taskType),b.taskColor=g.formatTaskColor(a.taskType),b=_.extend(a,b),b.site&&console.log("site: ",b),b}),k(g.formatRoomTasks(b.masterTaskFormatted))}console.log("parent task!",b),console.log("selected",b.selectedTask),b.selectedAction="masterTasks",b.showToggler=!0,b.availableTasks=[];var p={siteIds:[],roomIds:[],taskTypes:[],isMaster:!1,checkTemplateObj:!1};b.selectAction=function(a){b.selectedAction=a,"search"==a?b.showToggler=!1:(j(p),b.showToggler=!0)},b.saveParent=function(){b.selectedParent?a.close(b.selectedParent):b.errorMessage="Please select a parent task."},b.toggle=function(){b.showToggler=!b.showToggler},b.cancel=function(){a.dismiss()},b.selectParent=function(a){b.selectedParent=a},b.toggleTasks=function(a){var b=a.rooms,c=a.sites,d=a.taskTypes;p.roomIds=b.map(function(a){return a._id}),p.hideRooms=[],p.siteIds=c.map(function(a){return a.rooms.map(function(a){var b=p.roomIds.indexOf(a._id);b<0&&p.hideRooms.push(a._id)}),a._id}),p.taskTypes=d.map(function(a){return a.value}),j(p)};var q=[]}]),angular.module("petalApp").controller("ReoccurringTestCtrl",["$scope","TimelineTaskService","$timeout","Util",function(a,b,c,d){function e(c){a.loading||(a.loading=!0,a.generated=null,b.reoccurringTest(c).then(function(b){console.log("res: ",b),a.generated={header:"Saved!",taskCount:null,tbdTasks:null,reoccurringTasks:null},b.data.taskCount&&(a.generated.taskCount="Created "+b.data.taskCount.length+" tasks."),b.data.TBDTaskCount>0&&(a.generated.tbdTasks=b.data.TBDTaskCount+" tasks were saved to the room's TBD task object."),b.data.reoccurringTaskCount>0&&(a.generated.reoccurringTasks=b.data.reoccurringTaskCount+" reoccurring tasks were created.")})["catch"](function(b){b.data.errorMessage?a.errorMessage=b.data.errorMessage:a.errorMessage="Please close and try again :("})["finally"](function(){a.loading=!1}))}function f(b){return b.site?b.startDate?(a.flashStep=null,null):(a.flashStep=2,"Please select a start date."):(a.flashStep=1,"Please select an operation.")}a.selectedStep="1",a.loading=!1,a.errorMessage=!1,a.flashStep=null,a.selectedSite=null,a.selectedOpts={site:null,step:1,confirmedDates:!1,testDates:{}},a.selectOption=function(b,c){"site"==b?(a.selectedSite=c,a.selectedOpts.site=c._id,a.selectedOpts.step++):(a.selectedOpts[b]=c,"step"!=b&&a.selectedOpts.step++),a.generated=null,a.tlDateError=null},a.generateTasks=function(){a.selectedOpts.startDate=a.testStartDate,a.selectedOpts.endDate=a.testEndDate,a.errorMessage=f(a.selectedOpts),a.errorMessage?(a.loading=!1,c(function(){a.flashStep=null},1650)):e(a.selectedOpts)},a.datePickers=[!1,!1,!1],a.selectDate=function(b,c){console.log("index: ",c),a.datePickers[c]===!0?a.datePickers.length=0:a.datePickers[c]=!0},a.altInputFormats=["M!/d!/yyyy"],a.calOpts={showWeeks:!1},a.dateFormat="EEEE, MMMM d",a.dateOptions={dateDisabled:!1,formatYear:"yy",maxDate:new Date(2019,8,22),minDate:new Date(2016,4,20),startingDay:1}}]),angular.module("petalApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=(b.indexOf(c),"created");e=c?"updated":"add",d(e,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("petalApp").controller("TaskTogglerCtrl",["$scope","BaseObjectService","$timeout",function(a,b,c){function d(b){a.sites=b.sort(function(a,b){var c=a.name.replace("Operation ",""),d=b.name.replace("Operation ","");return c>d?1:c<d?-1:0});for(var c=0;c<b.length;c++)if(b[c].rooms.length){b[c].rooms.sort(function(a,b){var c=a.name.replace("Tunnel ",""),d=b.name.replace("Tunnel ","");return c>d?1:c<d?-1:0});var d=b[c].name.replace("Operation ","");d<10&&(d="0"+d);for(var e=0;e<b[c].rooms.length;e++){var f=b[c].rooms[e].name.replace("Tunnel ","");f<10&&(f="0"+f),b[c].rooms[e].siteShortName="CL"+d,b[c].rooms[e].tunnelShortName="T"+f,b[c].rooms[e].site=b[c]._id,b[c].mainColor?b[c].rooms[e].siteMainColor=b[c].mainColor:b[c].rooms[e].siteMainColor="#ccc",b[c].subColor?b[c].rooms[e].siteSubColor=b[c].subColor:b[c].rooms[e].siteSubColor="#ccc"}b[c].siteShortName="CL"+d,a.availableRooms=a.availableRooms.concat(b[c].rooms)}}function e(b){for(var c=a.availableRooms.length-1;c>=0;c--)a.availableRooms[c].site==b._id&&a.availableRooms.splice(c,1)}function f(b){for(var c=0;c<b.length;c++)b[c].rooms.map(function(b){var c=a.availableRooms.indexOf(b);c<0&&a.availableRooms.push(b)})}function g(b,c){a.allRoomsToggled=!0;for(var d=0;d<b.length;d++){for(var e=b[d].rooms,f=0;f<e.length;f++){var g=a.toggledRooms.indexOf(e[f]);g<0&&a.toggledRooms.push(e[f]);var h=j.rooms.indexOf(e[f]._id);h<0&&j.rooms.push(e[f]._id)}var i=j.sites.indexOf(b[d]._id);i<0&&j.sites.push(b[d]._id)}angular.isFunction(c)&&c(j)}function h(b,c){for(var d=b.rooms,e=0;e<d.length;e++){var f=a.toggledRooms.indexOf(d[e]);f>-1&&a.toggledRooms.splice(f,1);var g=j.rooms.indexOf(d[e]._id);g>-1&&j.rooms.splice(g,1)}var h=j.sites.indexOf(b._id);h>-1&&j.sites.splice(b._id),angular.isFunction(c)&&c(j)}function i(){k&&c.cancel(k),k=c(function(){a.returnSelection({rooms:a.toggledRooms,sites:a.toggledSites,taskTypes:a.toggledTypes})},1e3)}a.toggledRooms=[],a.toggledSites=[],a.toggledTypes=[],a.allSitesToggled=!1,a.allRoomsToggled=!1,a.availableRooms=[];var j={rooms:[],sites:[]};a.taskTypes=[{value:"daily-check",name:"Daily Checks",color:"#FF8B00"},{value:"tunnel-timeline",name:"Tunnel Timeline",color:"#006737"},{value:"x-check",name:"X Checks",color:"#724628"},{value:"admin-assigned",name:"Admin Assigned",color:"#231F20"}],b.getAllObjects("site").then(function(a){a.data&&d(a.data)})["catch"](function(a){console.log("err: ",a)}),a.toggleAllSites=function(){a.allSitesToggled?(a.allSitesToggled=!1,a.toggledSites=[],a.availableRooms=[],a.sites.map(h),i()):(a.allSitesToggled=!0,a.toggledSites=_.clone(a.sites),a.availableRooms=[],f(a.toggledSites),g(a.toggledSites,i))},a.toggleAllRooms=function(){a.allRoomsToggled?(a.allRoomsToggled=!1,a.toggledRooms=[],j={sites:[],rooms:[]},i()):(a.allRoomsToggled=!0,a.toggledRooms=[],g(a.toggledSites,i))},a.toggleSite=function(b){var c=a.toggledSites.indexOf(b);c>-1?(a.toggledSites.splice(c,1),h(b,i),e(b)):(a.toggledSites.push(b),a.availableRooms.length||(a.availableRooms=[]),f([b]),g([b],i)),a.allSitesToggled=a.toggledSites.length==a.sites.length},a.toggleRoom=function(b){var c=a.toggledRooms.indexOf(b);c>-1?a.toggledRooms.splice(c,1):a.toggledRooms.push(b),i(a.toggledRooms),a.allRoomsToggled=a.availableRooms.length==a.toggledRooms.length},a.toggleType=function(b){var c=a.toggledTypes.indexOf(b);c>-1?a.toggledTypes.splice(c,1):a.toggledTypes.push(b),i()},a.isSiteToggled=function(b){return a.toggledSites.indexOf(b)>-1},a.isTypeToggled=function(b){return a.toggledTypes.indexOf(b)>-1},a.isRoomToggled=function(b){return a.toggledRooms.indexOf(b)>-1};var k}]),angular.module("petalApp").directive("taskToggler",function(){return{restrict:"E",templateUrl:"components/task-toggler/task-toggler.html",scope:{returnSelection:"&"},controller:"TaskTogglerCtrl"}}),angular.module("petalApp").controller("TaskGenerationErrorCtrl",["$scope","Modal","TimelineTaskService","$state","$uibModal","$uibModalInstance",function(a,b,c,d,e,f){console.log("scope",a),a.showErrorModal=!0,a.goToTask=function(a){console.log("taskError",a);var b=_.cloneDeep(a.templateTask);c.setEditTask(b),f.hide(),d.go("timeline.task",{timelineTaskId:b._id})}}]),angular.module("petalApp").controller("TaskGenerationModalCtrl",["$scope","TimelineTaskService","$timeout","Modal","$rootScope","Util",function(a,b,c,d,e,f){function g(){b.getAllTimelines().then(function(b){a.allTimelines=b.data})["catch"](function(a){console.log("tl err",a)})["finally"](function(){a.loadingTimelines=!1})}a.errorMessage=null,a.generating=!1,a.showSaved=!1,a.generatedTaskCount=null,a.selectedTLTemplate=null,a.generated=!1,a.room=a.genInfo.room,a.fromDate=moment(a.genInfo.fromDate),a.fromDateTypeString=a.genInfo.fromDateTypeString,a.fromDateType=a.genInfo.fromDateType,a.loadingTimelines=!0,a.genInfo.lastGeneratedTasksDate?a.lastGeneratedTasksDate=moment(a.genInfo.lastGeneratedTasksDate):a.lastGeneratedTasksDate=null,a.doGenerate=function(){if(a.selectedTLTemplate&&!a.generating){a.generating=!0;var e={fromDate:a.fromDate.format(),room:a.room,tlTemplateId:a.selectedTLTemplate._id,fromDateType:a.fromDateType};b.generateTasksFromTimeline(e).then(function(b){console.log("res",b),a.generatedTaskCount=0,b&&b.data&&(b.data.newTasks&&(a.generatedTaskCount=b.data.newTasks.length),a.generated=!0,a.showSaved=!0,c(function(){a.showSaved=!1},3e3))})["catch"](function(b){a.errorMessage="Error generating tasks from this timeline.",b&&b.data&&b.data.buildErrors&&d.taskGenerationErrorModal(b.data.buildErrors,a.selectedTLTemplate.timelineName),console.log("gen err",b)})["finally"](function(){a.generating=!1})}},a.isTimelineSelected=function(b){return!!a.selectedTLTemplate&&a.selectedTLTemplate._id===b._id},a.selectTimeline=function(b){a.selectedTLTemplate&&a.selectedTLTemplate._id===b._id?a.selectedTLTemplate=null:a.selectedTLTemplate=b},g()}]),angular.module("petalApp").controller("TaskImageCtrl",["$uibModalInstance","$scope","Modal","Upload","MediaService","Auth",function(a,b,c,d,e,f){function g(a){return a.substring(0,a.lastIndexOf("."))}function h(a,c){var d=j?j._id:void 0,f={mediaType:"image",mediaUrl:k,uploadByUser:d,uploadDate:new Date,mediaName:b.imageFile.mediaName};e.newImageUpload(f)}function i(){e.allMedia().then(function(a){b.uploads=a.data})["catch"](function(a){console.log("err: ",a)})}b.selectedAction="upload",b.file=null,b.uploadedImage=!1,b.errorMessage=null,b.uploads=[],b.selectedImage=null,b.searchMedia={};var j,k;f.getCurrentUser(function(a){j=a,console.log("user: ",a)}),i(),b.loading=!1,b.uploadFile=function(a,c){b.imageFile=a,b.imageFile&&(b.imageFile.mediaName=g(_.clone(b.imageFile.name)),b.imageFile.name=e.renameImageFile(),b.loading=!0,b.errorMessage=null,b.uploadedImage=!1,k="https://claritymedia.s3-us-west-2.amazonaws.com/"+b.imageFile.name,e.getAWSCreds(a).then(function(c){e.uploadImage(c.data,a).then(function(a){b.uploadedImage=!0})["catch"](function(a){b.errorMessage="Upload Error!"})["finally"](function(){b.loading=!1})})["catch"](function(a){b.loading=!1,b.errorMessage="Upload Error!",console.log("err: ",a)}))},b.saveImageName=function(a){a.oldName=_.clone(a.mediaName)},b.changeImageName=function(a){a.updated=!0},b.saveImageName=function(a){!a.saving&&a.updated&&(a.saving=!0,e.updateMedia(a).then(function(b){console.log("res: ",b),a.mediaName=_.clone(b.data.mediaName),a.oldName=_.clone(a.mediaName)})["finally"](function(){a.saving=!1,a.updated=!1}))},b.clearSearch=function(){b.searchMedia={}},b.revertImageName=function(a){a.mediaName=a.oldName,a.oldName=_.clone(a.mediaName),a.updated=!1},b.deleteImage=function(a){c.confirm["delete"](function(){e.deleteMedia(a).then(function(c){b.selectedImage=null;var d=b.uploads.indexOf(a);d>-1&&b.uploads.splice(d,1)})})("this image")},b.selectAction=function(a){b.selectedAction=a,b.selectedImage=null},b.selectImage=function(a){b.selectedImage=a},b.saveImage=function(){var c="";b.selectedImage?c=b.selectedImage.mediaUrl:(c=k,h(c,j)),a.close(c)},b.cancel=function(){a.dismiss()}}]),angular.module("petalApp").directive("taskTemplate",function(){return{templateUrl:"components/taskTemplate/taskTemplate.html",restrict:"E",scope:{taskObj:"="},link:function(a,b,c){a.selectType=function(b){a.taskObj.taskType=b},a.selectSchedule=function(b){a.taskObj.schedule=b},a.addItem=function(){var b={text:""};a.taskObj.taskItems||(a.taskObj.taskItems=[]),a.taskObj.taskItems.push(b)},a.removeItem=function(b){a.taskObj.taskItems.splice(b,1)},a.taskObj.scheduleDate||(a.taskObj.scheduleDate=new Date),a.calOpts={showWeeks:!1}}}}),angular.module("petalApp").controller("TimelineNavController",["$scope","BaseObjectService","SiteService","moment","timelineFactory","$timeout","Modal","TimelineUtils","$rootScope","TLQueryService","TimelineTaskService","Auth","socket","$state","TaskPriority","appConfig","localStorageService","Util",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(b){a.sortTasks=[{label:"View All Tasks",query:{isMaster:!1}},{label:"Daily Checks",query:{taskType:"daily-check",isMaster:!1}},{label:"Grow Timeline Tasks",query:{taskType:"grow-timeline",isMaster:!1}},{label:"Weekly Checks",query:{taskType:"weekly-check",isMaster:!1}},{label:"Admin Assigned Tasks",query:{taskType:"admin-assigned",isMaster:!1}}],w(),t(),console.log("get templates")}function t(){var b=q.get("petal-TLFromDate"),c=q.get("petal-TLToDate");b?b._isAMomentObject?a.TLFromDate=b:a.TLFromDate=d(b):a.TLFromDate=d().subtract(30,"days"),c?c._isAMomentObject?a.TLToDate=c:a.TLToDate=d(c):a.TLToDate=d().add(30,"days"),y.TLToDate=a.TLToDate.format(),y.TLFromDate=a.TLFromDate.format()}function u(b){for(var c=0;c<a.sortTaskOpts.length;c++)a.sortQueryArr.indexOf(a.sortTaskOpts[c].queryLabel)<0&&a.sortQueryArr.push(a.sortTaskOpts[c].queryLabel);y.taskTypes=a.sortQueryArr,angular.isFunction(b)&&b(y)}function v(b){a.restoreMode?b.recentlyDeleted=!0:delete b.recentlyDeleted;var c=j.buildQuery(b);console.log("query",_.cloneDeep(b)),console.log("built",c),k.timelineTaskQuery(c).then(function(b){var c="Master View"==a.adminToolMode||!_.isNull(a.activeTimeline);console.log("is master",c),a.updateTaskView({tasks:b.data,isMaster:c})})["catch"](function(a){console.log("err: ",a)})}function w(){k.getAllTimelines().then(function(b){console.log("timelines",b),a.allTimelines=b.data})["catch"](function(a){console.log("tl err",a)})}a.selectedSort="View All Tasks",a.sortsApplied=[],a.allSites=c.getAllSites(),a.selectedSort="View All Tasks",a.sortsApplied=[],a.allSorts=!1,a.sortQueryArr=[],a.adminToolMode="",a.isAdmin=l.isAdmin,a.showTLTools=!0,a.showTLFilters=!0,a.showTLTimelines=!0,a.showTLDateFilter=!0,a.activeTimeline=null,a.TLFromDate=null,a.TLToDate=null,a.showFromDatePicker=!1,a.showToDatePicker=!1,a.restoreMode=!1;var x,y={siteIds:[],roomIds:[],taskTypes:[],isMaster:!1,checkTemplateObj:!1,TLFromDate:null,TLToDate:null};if(!a.allSites)var z=i.$on("set-sites",function(b,c){a.allSites=c,z()});if(a.currentUser=l.getCurrentUser(),a.currentUser&&a.currentUser.role)s(a.currentUser);else var A=i.$on("logged-in",function(b,c){a.currentUser=c,s(a.currentUser),A()});a.getTasksForSelections=function(a){var b=a.rooms,c=a.sites;y.roomIds=b.map(function(a){return a._id}),y.hideRooms=[],y.siteIds=c.map(function(a){return a.rooms.map(function(a){var b=y.roomIds.indexOf(a._id);b<0&&y.hideRooms.push(a._id)}),a._id}),y.hideRooms.length&&console.log("hide these rooms!"),v(y)},a.tlCopyFromMaster=function(){g.buildTimeline(a.allSites)},a.reoccurringTest=function(){g.reoccurringTest(a.allSites)},a.toggleTemplateMode=function(){"Template View"!=a.adminToolMode?a.adminToolMode="Template View":a.adminToolMode=""},a.toggleList=function(b){"TLTools"===b?a.showTLTools=!a.showTLTools:"TLFilters"===b?a.showTLFilters=!a.showTLFilters:"TLTimelines"===b?a.showTLTimelines=!a.showTLTimelines:"TLDates"===b&&(a.showTLDateFilter=!a.showTLDateFilter)},a.buildNewTL=function(){a.showToggleMenu=!1,g.buildTimeline(a.sites)},a.newTLTemplate=function(){g.timelineModal()},a.editTimeline=function(a){g.timelineModal(a)},a.toggleTimeline=function(b){b===a.activeTimeline?(a.activeTimeline=null,y.isMaster="Master View"===a.adminToolMode,y.taskTLTemplate=null,console.log("query Obj",y),v(y)):(a.activeTimeline=b,y.isMaster=!0,y.checkTemplateObj=!1,y.taskTLTemplate=b._id,v(y))},a.isTimelineActive=function(b){return a.activeTimeline===b},a.addTask=function(){console.log("add task!"),n.go("timeline.task")},a.viewMasterTasks=function(){console.log("view Master!"),"Master View"!=a.adminToolMode?a.adminToolMode="Master View":a.adminToolMode=""},a.showTool=function(b){return!b.adminOnly||a.isAdmin()},a.changeDate=function(b){"fromDate"===b?a.showFromDatePicker=!0:"toDate"===b&&(a.showToDatePicker=!0)},a.formatDate={formatDate:function(a){return d(a).format("ddd MMM Do, YYYY")}},a.updateDate=function(b){var c=r.standardizeDate(a.TLFromDate.format()),d=r.standardizeDate(a.TLToDate.format());q.set("petal-TLFromDate",c),q.set("petal-TLToDate",d),y.TLToDate=d,y.TLFromDate=c,v(y)},a.hideCalendar=function(b){"fromDate"===b&&a.showFromDatePicker?a.showFromDatePicker=!1:"toDate"===b&&a.showToDatePicker&&(a.showToDatePicker=!1)},a.sortTaskOpts=[{label:"Daily Checks",queryLabel:"daily-check",selectedColor:"#FF8B00",offColor:"#FFC47D"},{label:"Tunnel Timelines",queryLabel:"tunnel-timeline",selectedColor:"#006737",offColor:"rgba(0,103,55,0.6)"},{label:"Admin Assigned",queryLabel:"admin-assigned",selectedColor:"#231F20",offColor:"#999092"},{label:"X Checks",queryLabel:"x-check",selectedColor:"#724628",offColor:"#AF8B72"}],a.toggleAllSorts=function(){a.allSorts?(a.allSorts=!1,a.sortQueryArr=[],
y.taskTypes=a.sortQueryArr,v(y)):(a.allSorts=!0,u(v))},a.toggleSort=function(b){var c=a.sortQueryArr.indexOf(b.queryLabel);c>-1?a.sortQueryArr.splice(c,1):a.sortQueryArr.push(b.queryLabel),a.allSorts=a.sortQueryArr.length==a.sortTaskOpts.length,y.taskTypes=a.sortQueryArr,v(y)},a.isSortToggled=function(b){return a.sortQueryArr.indexOf(b.queryLabel)>-1},x=i.$on("update-templates",function(){console.log("update templates"),w()});a.isToolActive=function(b){return b.batchMode&&"restore"===b.batchMode?a.restoreMode:b.text==a.adminToolMode},a.toggleAdminTool=function(b){a.adminToolMode!=b.text?a.adminToolMode=b.text:a.adminToolMode="",b.masterMode?(y.isMaster="Master View"===a.adminToolMode,y.isMaster&&(y.taskTLTemplate=null,a.activeTimeline=null),y.checkTemplateObj="Operation Reoccurring Tasks"===a.adminToolMode,v(y)):""!==a.adminToolMode?i.$emit("batch-mode",b):i.$emit("batch-mode",null)},a.toggleRestoreMode=function(b){a.restoreMode=!a.restoreMode,a.restoreMode?i.$emit("batch-mode",b):i.$emit("batch-mode",null),v(y)},i.$on("cancel-batch",function(){a.adminToolMode=""}),a.$on("$destroy",function(){console.log("destroy"),x(),x=null}),a.adminTools=[{text:"Add task","function":a.addTask,adminOnly:!1},{text:"Master View","function":a.toggleAdminTool,query:{isMaster:!0},adminOnly:!0,masterMode:!0},{text:"Operation Reoccurring Tasks","function":a.toggleAdminTool,query:{checkTemplateObj:{$exists:!0,$ne:!1},isMaster:!1},adminOnly:!0,masterMode:!0},{text:"Mass Delete","function":a.toggleAdminTool,batchMode:"delete",adminOnly:!0,batchInfo:"delete",batchModeTitle:"Mass Delete Mode"},{text:"Mass Complete","function":a.toggleAdminTool,batchMode:"complete",adminOnly:!0,batchInfo:"complete",batchModeTitle:"Mass Complete Mode"},{text:"Restore Deleted","function":a.toggleRestoreMode,batchMode:"restore",adminOnly:!0,batchInfo:"restore",batchModeTitle:"Restore Recently Deleted"}],a.adminTools.push({text:"Reoccurring Tasks Test","function":a.reoccurringTest,adminOnly:!0})}]),angular.module("petalApp").directive("timelineNav",["timelineFactory",function(a){return{templateUrl:"components/timeline-nav/timeline-nav.html",restrict:"E",scope:{updateTaskView:"&"},controller:"TimelineNavController"}}]),angular.module("petalApp").controller("TimelineModalCtrl",["$scope","TimelineTaskService","$timeout","Modal","$rootScope","Util","Auth",function(a,b,c,d,e,f,g){function h(){a.currentUser=g.getCurrentUser(),console.log("current",a.currentUser)}a.savedTL=!1,a.saving=!1,a.errorMessage=null,a.showSaved=!1,a.editingObj=!0,a.showGenButtons=!1,a.timelineObj||(a.newTL=!0,a.editingObj=!1),h();var i=0;a.clickHeader=function(){a.currentUser&&"Danny"===a.currentUser.firstName&&(i++,i>=10&&(a.showGenButtons=!0))},a.editField=function(b){a.editedFields||(a.editedFields={}),c(function(){a.showSaved=!1}),b===a.errorField&&(a.errorField=null,a.saveError=null),a.editedFields[b]||(a.editedFields[b]=!0),"timelineMainColor"===b&&a.timelineObj.timelineMainColor&&a.timelineObj.timelineMainColor.length>2&&("#"!==a.timelineObj.timelineMainColor.charAt(0)&&(a.timelineObj.timelineMainColor="#"+a.timelineObj.timelineMainColor),a.timelineObj.timelineSubColor=f.getSubColor(f.hextToRgb(a.timelineObj.timelineMainColor)),a.editField("timelineSubColor")),"timelineSubColor"===b&&a.timelineObj.timelineSubColor&&a.timelineObj.timelineSubColor.length>2&&"#"!==a.timelineObj.timelineSubColor.charAt(0)&&(a.timelineObj.timelineSubColor="#"+a.timelineObj.timelineSubColor)},a.saveTL=function(){a.editedFields&&!a.timelineObj._id?(a.saving=!0,b.newTimeline(a.timelineObj).then(function(b){a.timelineObj=b.data,c(function(){a.savedTL=!0,a.newTL=!1,a.editedFields=null,a.errorField=null,c(function(){a.showSaved=!0,c(function(){a.showSaved=!1,a.editingObj=!0},2e3)},150)}),e.$emit("update-templates")})["catch"](function(b){console.log("err",b),b.msg?a.errorMessage=b.msg:a.errorMessage="Error saving this template."})["finally"](function(){a.saving=!1})):a.timelineObj._id&&(a.saving=!0,b.updateTimeline(a.timelineObj).then(function(b){a.timelineObj=b.data,c(function(){a.savedTL=!0,a.newTL=!1,a.editedFields=null,a.errorField=null,c(function(){a.showSaved=!0,c(function(){a.showSaved=!1,a.editingObj=!0},2e3)},150)}),e.$emit("update-templates")})["catch"](function(b){console.log("err",b),b.msg?a.errorMessage=b.msg:a.errorMessage="Error saving this template."})["finally"](function(){a.saving=!1}))},a.deleteTL=function(){if(a.timelineObj._id){var c='"'+a.timelineObj.timelineName+'"';d.confirm["delete"](function(){b.deleteTimeline(a.timelineObj._id).then(function(b){e.$emit("update-templates"),a.$dismiss()})["catch"](function(a){console.log("err",a)})})(c,"the timeline template ")}},a.copyMaster=function(c){var d=a.timelineObj._id;b.copyMasterTL(c,d).then(function(a){console.log("res",a)})["catch"](function(a){console.log("err",a)})}}]),angular.module("petalApp").controller("EditChildTaskController",["$scope","$uibModalInstance","TimelineUtils","TimelineTaskService",function(a,b,c,d){if(console.log("edit: ",a.modalTask),a.taskPriorities=[{value:"low",name:"Low"},{value:"medium",name:"Medium"},{value:"high",name:"High"}],a.modalTask.priority)for(var e=0;e<a.taskPriorities.length;e++)if(a.taskPriorities[e].value==a.modalTask.priority){console.log(" now what!"),a.modalTask.priority=a.taskPriorities[e].value;break}var f=c.calculateLengths(a.modalTask.roomDetails.startDate,a.modalTask.roomDetails.flippedDate,a.modalTask.roomDetails.endDate);a.resetTask=function(){a.modalTask=_.cloneDeep(a.cleanTaskCopy)},a.changeDate=function(){var b=moment(a.modalTask.roomDetails.startDate),d=moment(a.modalTask.roomDetails.flippedDate),e=moment(a.modalTask.occurrenceDate).diff(b,"days");console.log("taskday: ",e),e>=f.vegLength?(a.modalTask.inPeriod="flower",e=moment(a.modalTask.occurrenceDate).diff(d,"days")):a.modalTask.inPeriod="veg",e+=1;var g=c.findDayAndWeek(e);a.modalTask.taskWeek=g.week,a.modalTask.taskDay=g.day},a.altInputFormats=["M!/d!/yyyy"],a.calOpts={showWeeks:!1},a.dateFormat="EEEE, MMMM d",a.dateOptions={dateDisabled:!1,formatYear:"yy",maxDate:new Date(2019,8,22),minDate:a.modalTask.roomDetails.startDate,startingDay:1},a.saveEdits=function(){var c=_.cloneDeep(a.modalTask.masterTask),e=_.cloneDeep(a.modalTask.roomDetails);a.loading=!0,d.updateTask(a.modalTask._id,a.modalTask).then(function(a){console.log("response: ",a);var d=a.data;d.masterTask=c,d.roomDetails=e,b.close(d)})["catch"](function(a){console.log("err: ",a)})["finally"](function(){a.loading=!1})}}]),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(a,b){var c=null,d=angular.noop;return{restrict:"CA",link:function(b,e,f){b.$watch("$location.path",function(){d()}),e.parent().bind("click",function(){d()}),e.bind("click",function(b){var f=e===c;b.preventDefault(),b.stopPropagation(),c&&d(),f||e.hasClass("disabled")||e.prop("disabled")||(e.parent().addClass("open"),c=e,d=function(b){b&&(b.preventDefault(),b.stopPropagation()),a.unbind("click",d),e.parent().removeClass("open"),d=angular.noop,c=null},a.bind("click",d))})}}}]);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SignupController=function(){function a(b,c){_classCallCheck(this,a),this.Auth=b,this.$state=c}return a.$inject=["Auth","$state"],_createClass(a,[{key:"register",value:function(a){var b=this;this.submitted=!0,a.$valid&&this.Auth.createUser({name:this.user.name,email:this.user.email,password:this.user.password}).then(function(){b.$state.go("main")})["catch"](function(c){c=c.data,b.errors={},angular.forEach(c.errors,function(c,d){a[d].$setValidity("mongoose",!1),b.errors[d]=c.message})})}}]),a}();angular.module("petalApp").controller("SignupController",SignupController),function(){function a(a){var b={safeCb:function(a){return angular.isFunction(a)?a:angular.noop},urlParse:function(a){var b=document.createElement("a");return b.href=a,""===b.host&&(b.href=b.href),b},isSameOrigin:function(c,d){return c=b.urlParse(c),d=d&&[].concat(d)||[],d=d.map(b.urlParse),d.push(a.location),d=d.filter(function(a){var b=c.hostname===a.hostname,d=c.protocol===a.protocol,e=c.port===a.port||""===a.port&&("80"===c.port||"443"===c.port);return b&&d&&e}),d.length>=1},standardizeDate:function(a){if(a){var b=new Date(a);return b.setHours(13,0,0,0),b}return null},hextToRgb:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},rgbToHex:function(a,b,c){function d(a){var b=a.toString(16);return 1==b.length?"0"+b:b}return"#"+d(a)+d(b)+d(c)},getSubColor:function(a){var b=a.r,c=a.g,d=a.b,e=.4,f={r:Math.floor(b+(255-b)*e),g:Math.floor(c+(255-c)*e),b:Math.floor(d+(255-d)*e)};return this.rgbToHex(f.r,f.g,f.b)},sameDay:function(a,b){return a.getUTCFullYear()==b.getFullYear()&&a.getUTCMonth()==b.getUTCMonth()&&a.getUTCDate()==b.getUTCDate()},makeId:function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}};return b}a.$inject=["$window"],angular.module("petalApp.util").factory("Util",a)}(),angular.module("petalApp").controller("ViewTogglerCtrl",["$scope","BaseObjectService","$timeout","SiteService",function(a,b,c,d){function e(b){a.sites=b.sort(function(a,b){var c,d;return c=a.name&&_.includes(a.name,"Operation")?a.name.replace("Operation ",""):99,d=b.name&&_.includes(b.name,"Operation")?b.name.replace("Operation ",""):99,c>d?1:c<d?-1:0});for(var c=0;c<b.length;c++){var e=d.getSiteShortName(b[c]);if(b[c].rooms.length){b[c].rooms.sort(function(a,b){var c=a.name.replace("Tunnel ",""),d=b.name.replace("Tunnel ","");return c>d?1:c<d?-1:0});for(var f=0;f<b[c].rooms.length;f++){var g=b[c].rooms[f].name.replace("Tunnel ","");g<10&&(g="0"+g),b[c].rooms[f].siteShortName=e,b[c].rooms[f].tunnelShortName="T"+g,b[c].rooms[f].site=b[c]._id,b[c].mainColor?b[c].rooms[f].siteMainColor=b[c].mainColor:b[c].rooms[f].siteMainColor="#ccc",b[c].subColor?b[c].rooms[f].siteSubColor=b[c].subColor:b[c].rooms[f].siteSubColor="#ccc"}b[c].siteShortName=e,a.availableRooms=a.availableRooms.concat(b[c].rooms)}}}function f(b){for(var c=a.availableRooms.length-1;c>=0;c--)a.availableRooms[c].site==b._id&&a.availableRooms.splice(c,1)}function g(b){for(var c=0;c<b.length;c++)b[c].rooms.map(function(b){var c=a.availableRooms.indexOf(b);c<0&&a.availableRooms.push(b)})}function h(b,c){a.allRoomsToggled=!0;for(var d=0;d<b.length;d++){for(var e=b[d].rooms,f=0;f<e.length;f++){var g=a.toggledRooms.indexOf(e[f]);g<0&&a.toggledRooms.push(e[f]);var h=k.rooms.indexOf(e[f]._id);h<0&&k.rooms.push(e[f]._id)}var i=k.sites.indexOf(b[d]._id);i<0&&k.sites.push(b[d]._id)}angular.isFunction(c)&&c(k)}function i(b,c){for(var d=b.rooms,e=0;e<d.length;e++){var f=a.toggledRooms.indexOf(d[e]);f>-1&&a.toggledRooms.splice(f,1);var g=k.rooms.indexOf(d[e]._id);g>-1&&k.rooms.splice(g,1)}var h=k.sites.indexOf(b._id);h>-1&&k.sites.splice(b._id),angular.isFunction(c)&&c(k)}function j(){a.returnSelection({rooms:a.toggledRooms,sites:a.toggledSites})}a.toggledRooms=[],a.toggledSites=[],a.allSitesToggled=!1,a.allRoomsToggled=!1,a.availableRooms=[];var k={rooms:[],sites:[]};b.getAllObjects("site").then(function(a){a.data&&e(a.data)})["catch"](function(a){console.log("err: ",a)}),a.toggleAllSites=function(){a.allSitesToggled?(a.allSitesToggled=!1,a.toggledSites=[],a.availableRooms=[],a.sites.map(i),j()):(a.allSitesToggled=!0,a.toggledSites=_.clone(a.sites),a.availableRooms=[],g(a.toggledSites),h(a.toggledSites,j))},a.toggleAllRooms=function(){a.allRoomsToggled?(a.allRoomsToggled=!1,a.toggledRooms=[],k={sites:[],rooms:[]},j()):(a.allRoomsToggled=!0,a.toggledRooms=[],h(a.toggledSites,j))},a.toggleSite=function(b){var c=a.toggledSites.indexOf(b);c>-1?(a.toggledSites.splice(c,1),i(b,j),f(b)):(a.toggledSites.push(b),a.availableRooms.length||(a.availableRooms=[]),g([b]),h([b],j)),a.allSitesToggled=a.toggledSites.length==a.sites.length},a.toggleRoom=function(b){var c=a.toggledRooms.indexOf(b);c>-1?a.toggledRooms.splice(c,1):a.toggledRooms.push(b),j(a.toggledRooms),a.allRoomsToggled=a.availableRooms.length==a.toggledRooms.length},a.isSiteToggled=function(b){return a.toggledSites.indexOf(b)>-1},a.isRoomToggled=function(b){return a.toggledRooms.indexOf(b)>-1}}]),angular.module("petalApp").directive("viewToggler",function(){return{restrict:"E",templateUrl:"components/view-toggler/view-toggler.html",scope:{returnSelection:"&"},controller:"ViewTogglerCtrl"}}),angular.module("petalApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div class=container><div class=row><div class=col-sm-12><h1>Login</h1></div><div class=col-sm-6 ng-if=!vm.loggedInUser><form class=form name=form ng-submit=vm.login(form) novalidate><div class=form-group><label>First Name</label><input name=firstName class=form-control ng-model=vm.user.firstName required></div><div class=form-group><label>Password</label><input type=password name=password class=form-control ng-model=vm.user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.firstName.$error.required && form.password.$error.required && vm.submitted">Please enter your first name and password.</p><p class=help-block>{{ vm.errors.other }}</p></div><div><button class="btn btn-inverse btn-lg btn-login" type=submit>Login</button></div></form></div><div class=col-sm-4 ng-if=vm.loggedInUser><h1 class=main-section-title>You are already logged in.</h1><label class=text-muted ng-click=vm.goHome()>Click here to go home.</label><md-button class="md-raised btn-primary" ng-click=vm.goHome()><h1>Home</h1></md-button></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=vm.changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=vm.user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ vm.errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=vm.user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || vm.submitted)">Password must be at least 3 characters.</p></div><div class=form-group><label>Confirm New Password</label><input type=password name=confirmPassword class=form-control ng-model=vm.user.confirmPassword match=vm.user.newPassword ng-minlength=3 required><p class=help-block ng-show="form.confirmPassword.$error.match && vm.submitted">Passwords must match.</p></div><p class=help-block>{{ vm.message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form class=form name=form ng-submit=vm.register(form) novalidate><div class=form-group ng-class="{ \'has-success\': form.name.$valid && vm.submitted,\n                                            \'has-error\': form.name.$invalid && vm.submitted }"><label>Name</label><input name=name class=form-control ng-model=vm.user.name required><p class=help-block ng-show="form.name.$error.required && vm.submitted">A name is required</p></div><div class=form-group ng-class="{ \'has-success\': form.email.$valid && vm.submitted,\n                                            \'has-error\': form.email.$invalid && vm.submitted }"><label>Email</label><input type=email name=email class=form-control ng-model=vm.user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && vm.submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && vm.submitted">What\'s your email address?</p><p class=help-block ng-show=form.email.$error.mongoose>{{ vm.errors.email }}</p></div><div class=form-group ng-class="{ \'has-success\': form.password.$valid && vm.submitted,\n                                            \'has-error\': form.password.$invalid && vm.submitted }"><label>Password</label><input type=password name=password class=form-control ng-model=vm.user.password ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && vm.submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password.$error.mongoose>{{ vm.errors.password }}</p></div><div class=form-group ng-class="{ \'has-success\': form.confirmPassword.$valid && vm.submitted,\n                                            \'has-error\': form.confirmPassword.$invalid && vm.submitted }"><label>Confirm Password</label><input type=password name=confirmPassword class=form-control ng-model=vm.user.confirmPassword match=vm.user.password ng-minlength=3 required><p class=help-block ng-show="form.confirmPassword.$error.match && vm.submitted">Passwords must match.</p></div><div><button class="btn btn-inverse btn-lg btn-register" type=submit>Sign up</button> <a class="btn btn-default btn-lg btn-login" ui-sref=login>Login</a></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<div class=container><ul class="list-group user-list"><li class=list-group-item ng-repeat="user in admin.users"><div class=user-info><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span></div><a ng-click=admin.delete(user) class=trash><span class="fa fa-trash fa-2x"></span></a></li></ul></div>'),a.put("app/dashboard/dashboard.html",'<div class=background></div><!--<nav class="change-view">--><!--<h1>--><!--Overview--><!--</h1>--><!--<h1>--><!--Timeline--><!--</h1>--><!--</nav>--><div class=dashboard-view ng-if="selectedView == \'overview\'"><header><h1>{{dashboardObj.name}}</h1><h2>{{ clock | date:\'EEEE, MMM d\'}}</h2><h2>{{ clock | date:\'shortTime\'}}</h2></header><div class=room-table-container><table class=table><thead><tr><td>Room</td><!--<td class="small-cell">--><!--Plants--><!--</td>--><!--<td class="small-cell">--><!--Countdown--><!--</td>--><td>Light</td><td class=progress-cell>Lights On / Lights Off</td><td></td><td id=flipped>Flipped</td><td id=phase>Harvest</td><td id=harvest>Length</td><!--<td>--><!--To Do--><!--</td>--></tr></thead><tbody><tr ng-repeat="room in dashboardObj.rooms"><td class=phase-date id=phase><span class=time-to-harvest>{{$index + 1}}</span><h2 class=harvest-date><!--({{room.flippedDate | date: \'EEEE, MMM d\'}})--> ({{room.amountOfPlants}})</h2></td><!--<td class="small-cell">--><!--{{room.amountOfPlants}}--><!--</td>--><!--<td class="small-cell">--><!--<span ng-if="!room.areLightsOn">-</span>{{room.countDown.hours}}:{{room.countDown.min | digitFilter}}--><!--</td>--><td class=svg-cell><svg xmlns=http://www.w3.org/2000/svg width=100 height=100 viewBox="0 0 100 100" ng-if=room.areLightsOn><path id=sunVector d="M51 5c-0.5 4.6 0.9 8.4 3.4 12.1 3.5-4.5 8-7.3 13.7-8.2 -2.2 4-2.4 8.1-1.5 12.4 5-2.8 10.2-3.7 15.9-2.4 -3.5 2.9-5.3 6.6-6.2 10.9 5.7-0.7 10.8 0.5 15.6 3.9 -4.4 1.3-7.4 4-9.9 7.7 5.5 1.5 9.8 4.6 12.9 9.5 -2.8-0.3-5.4 0-7.9 1.1 -1.4 0.6-2.8 1.4-4.3 2.2 4.6 3.6 7.4 8.1 8.4 13.8 -4-2.2-8.1-2.4-12.4-1.5 2.9 5 3.7 10.2 2.4 15.9 -1.6-2-3.5-3.6-5.8-4.5 -1.6-0.7-3.3-1.2-5.2-1.8 0.7 5.9-0.5 11-3.9 15.8 -0.7-2.7-2.1-4.9-4-6.8 -1.1-1.1-2.4-2.1-3.7-3.2 -0.8 2.8-1.9 5.3-3.5 7.5 -1.6 2.2-3.6 4-6 5.5 0.2-2.3 0.1-4.4-0.6-6.4 -0.6-2-1.6-3.9-2.8-5.7 -3.5 4.5-8 7.3-13.7 8.2 1.1-2 1.7-4 1.9-6.1 0.2-2.1 0.1-4.2-0.4-6.3 -5 2.8-10.2 3.7-15.9 2.4 1.7-1.4 3.1-3 4.1-4.9 1-1.9 1.6-3.9 2.1-6 -5.7 0.7-10.8-0.5-15.6-3.9 4.3-1.3 7.4-4 9.9-7.7 -5.5-1.5-9.8-4.6-12.9-9.6 4.5 0.5 8.4-0.9 12.1-3.4 -4.5-3.5-7.3-8-8.2-13.7 4 2.2 8.1 2.4 12.4 1.5 -2.8-5-3.7-10.2-2.4-15.9 1.4 1.7 3 3.1 4.9 4.1 1.9 1 3.9 1.7 6 2.1 -0.7-5.7 0.5-10.8 3.9-15.6 1.3 4.3 4 7.4 7.7 9.9 0.9-3.3 2.4-6.2 4.6-8.8C47.5 7.6 49.1 6.2 51 5zM24.9 49.9c0 13.9 11.2 25.2 25 25.2 13.9 0 25.1-11.1 25.3-24.7 0.2-14.2-11.2-25.4-24.7-25.6C36.2 24.6 24.8 36.2 24.9 49.9z"/></svg> <svg xmlns=http://www.w3.org/2000/svg width=100 height=100 viewBox="0 0 100 100" ng-if=!room.areLightsOn><path id=moonVector d="M56.8 13.1c-7.9 1.8-14.1 6-18.6 12.6 -3.2 4.7-4.8 10-5 15.7 -0.3 12.6 7.2 23.3 17.9 27.9 4.1 1.8 8.5 2.6 13 2.4 4.5-0.2 8.8-1.4 12.8-3.6 4-2.2 7.2-5.1 10-8.9 -4.2 16.2-20.3 29.2-39.6 27C26.5 83.8 12.3 65.2 14.6 45.3 17.1 23.7 37.3 9.6 56.8 13.1z"/></svg><!--<img src="../../assets/images/sunVector.3152988a.svg" >--><!--<img src="../../assets/images/moon.4f821521.png" ng-if="!room.areLightsOn">--></td><td id=progress class=progress-cell><ul class=lightStatus><li><h1>{{room.lightsOn | date : \'shortTime\' }}</h1></li><li><h1>{{room.lightsOff | date : \'shortTime\'}}</h1></li></ul><uib-progressbar class="progress-striped active" value="((room.countDown.hours + (room.countDown.min/60)))" type=success ng-if=room.areLightsOn max=24></uib-progressbar><uib-progressbar class="progress-striped active" value="((room.countDown.hours + (room.countDown.min/60)))" type=danger ng-if=!room.areLightsOn max=24></uib-progressbar></td><td id=space></td><!-- Flipped --><!-- Include day through week --><td class=phase-date><span class=time-to-harvest>{{room.weekCycle}} <span class=current-day>(d-{{room.weekDay | number: 0}})</span></span><h2 class=harvest-date><!--({{room.flippedDate | date: \'EEEE, MMM d\'}})--> ({{getFlippedDate(room) | date: \'EEEE, MMM d\' }})</h2><!--{{room.phase}}--></td><!-- Phase --><td class=phase-date id=phase><span class=time-to-harvest ng-class="{\'bold-date\' : room.harvestFlag == \'high\', \'underline-date\' : room.harvestFlag == \'medium\'}">{{room.harvestDate}} days</span><h2 class=harvest-date>({{room.endDate | date: \'EEEE, MMM d\'}})</h2><!--{{room.phase}}--></td><!-- Harvest Date --><td id=progress class=day-progress-cell><ul class=lightStatus><li><h1>d:1</h1></li><li><h1>(Has run {{room.currentDay}} {{room.currentDay != 1 ? \'days\' : \'day\'}})</h1></li><li><h1>d:{{room.totalDays | number : 0}}</h1></li></ul><uib-progressbar class="progress-striped active" value=room.dayProgress type=success max=room.totalDays></uib-progressbar></td><!--<td id="harvest" class="phase-date">--><!--<span class=\'time-to-harvest\' ng-class="{\'bold-date\' : room.harvestFlag == \'high\', \'underline-date\' : room.harvestFlag == \'medium\'}">--><!--{{room.harvestDate}} days--><!--</span>--><!--<h2 class="harvest-date">--><!--({{room.endDate | date: \'EEEE, MMM d\'}})--><!--</h2>--><!--&lt;!&ndash;<span am-time-ago="room.endDate" am-full-date-threshold="60" ng-class="{\'bold-date\' : room.harvestFlag == \'high\', \'underline-date\' : room.harvestFlag == \'medium\'}"></span>&ndash;&gt;--><!--</td>--><!--<td>--><!--Coming Soon...--><!--</td>--></tr></tbody></table></div></div>'),a.put("app/download/download.html",'<section class="download-route container" data-spy=scroll><header><h1 class=app-title>Clarity</h1></header><div class="download-container container" ng-if="currentUser && !loggingIn"><h1 class=download-welcome>Hello, <span>{{currentUser.firstName}}</span></h1><h2>Steps to download & install Clarity :</h2><div class="download-steps list-group col-xs-12 col-sm-6 col-md-4"><div class=list-group-item><h1>Open this link on your phone.</h1></div><div class=list-group-item><h1>Keep this browser window open for reference.</h1></div><!-- IOS --> <a href="itms-services://?action=download-manifest&url=https://ddragon.herokuapp.com/assets/ios/manifest.plist" class="list-group-item download-link" ng-if="deviceType === \'ios\'"><span>Click Here</span></a><div class=list-group-item ng-if="deviceType === \'ios\'"><h1>Verify Clarity is installed on your home screen.</h1></div><!-- Android --> <a href=https://s3.amazonaws.com/ripstaticcontent/Dragon.apk class="list-group-item download-link" ng-if="deviceType === \'android\'"><span>Click Here</span></a><div class=list-group-item ng-if="deviceType === \'android\'"><h1>Clarity APK file will begin downloading.</h1></div><div class=list-group-item ng-if="deviceType === \'android\'"><h1>Once the download completes, in your device\'s notification area, click on the notification for "Clarity.apk download complete".</h1></div><div class=list-group-item ng-if="deviceType === \'android\'"><h1>Click "Install"</h1></div><div class=list-group-item ng-if="deviceType === \'android\'"><h1>Verify the Clarity app was installed.</h1></div><!-- Unsupported --><div class="list-group-item list-group-item-danger" ng-if="deviceType === \'unknown\' || deviceType === \'windows\'"><h1>Unsupported device.</h1></div><div class=list-group-item ng-if="deviceType === \'unknown\' || deviceType === \'windows\'"><h1>Contact FT or Cypher.</h1></div><div class=list-group-item ng-click="scrollTo(\'troubleShooting\')"><h1>Need help? Click here.</h1></div></div></div><div class="login-form container" ng-if="!currentUser && !loggingIn"><h1>Please Login to continue.</h1><div class="col-xs-12 col-sm-6 col-md-4"><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label>First Name</label><input name=firstName class=form-control ng-model=user.firstName required></div><div class=form-group><label>Password</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error alert alert-danger" ng-show="(form.firstName.$error.required && form.password.$error.required && submitted) || (submitted && errors.other)"><p class=help-block ng-show="(form.firstName.$error.required && form.password.$error.required && submitted)">Please enter your first name and password.</p><p class=help-block ng-show="(!form.firstName.$error.required || !form.password.$error.required && submitted)">{{ errors.other }}</p></div><div><button class="btn btn-inverse btn-lg btn-login" type=submit>Login</button></div></form></div></div><div class="trouble-shooting container" ng-if="currentUser && !loggingIn"><h1 class=ts-label id=troubleShooting>Troubleshooting</h1><ul class="ts-tabs col-xs-12 col-md-6 col-lg-5"><li ng-class="{\'selected-device\' : tsDevice === \'android\'}" ng-click="ts(\'android\')"><h1>Android</h1></li><li ng-class="{\'selected-device\' : tsDevice === \'ios\'}" ng-click="ts(\'ios\')"><h1>iOS</h1></li></ul><div class="ts-container col-xs-12 col-md-6 col-lg-5"><div class="ts-steps android" ng-show="tsDevice === \'android\'"><h1 class=ts-device-label>Android Troubleshooting</h1><ol class=ts-list><li class=ts-item><h1 class=ts-list-label>Cannot find Clarity.apk File</h1><ul class=ts-sub-list><li><p>Pull down your notification bar from the top of your phone. It should appear as a notification, such as "Clarity.apk Download Complete"</p></li><li><p>Using a file browser, such as ASTRO Browser, search under the "Downloads" folder on your device. You are searching for a file named "Clarity.apk"</p></li><li><p>Once you locate the "Clarity.apk" file, click this to begin the install.</p></li></ul></li><li class=ts-item><h1 class=ts-list-label>App Not Installed - <span>"An existing package by the same name..."</span></h1><h2 class=ts-list-sublabel>Follow these steps in order</h2><ol class=ts-sub-list><li><p>Go to your device settings. This can easily be accessed by pulling down your notification bar and clicking the "<i class="fa fa-cog" aria-hidden=true></i>"</p></li><li><p>Click into the "Apps" section under settings.</p></li><li><p>If you see tabs such as "Downloaded", "Running", "All", select the "All" tab.</p></li><li><p>Scroll until you find "Clarity".</p></li><li><p>Click on Clarity, which brings you to the "App Info" page for Clarity.</p></li><li><p>If you see " <i class="fa fa-ellipsis-v" aria-hidden=true></i> " at the top right, click this, then click "Uninstall for all users" and "Confirm" on the next prompt.</p></li><li><p>If you do NOT see " <i class="fa fa-ellipsis-v" aria-hidden=true></i> ", click the uninstall button.</p></li><li><p>With Clarity uninstalled, locate the "Clarity.apk" file you downloaded earlier to restart the install process.</p></li><li><p>You can also re-download the apk file by clicking the link in the "Install" steps above.</p></li></ol></li></ol></div><div class="ts-steps ios" ng-show="tsDevice === \'ios\'"><h1 class=ts-device-label>iOS Troubleshooting</h1><ol class=ts-list><li class=ts-item><h1 class=ts-list-label>Install Fails</h1><ul class=ts-sub-list><li><p>You will need to bring Cypher your iOS device in order to complete the install.</p></li></ul></li></ol></div></div></div></section>'),a.put("app/main/main.html","<div class=main-background></div><section class=container><ul class=main-list><li ng-click=\"mainCtrl.goTo('sites')\"><h1>Sites</h1></li><li ng-click=\"mainCtrl.goTo('timeline')\"><h1>Timeline Tool</h1></li></ul></section>"),a.put("app/memo/memo.doc.html","<section class=timeline-task-view ng-class=\"{'dim-out' : dimOut, 'hide-view' : hideTaskView}\" id=memoDocView><header class=custom-header><ul class=header-buttons><li ng-click=goBack() class=gray-button><i class=\"icon icon-left_close\"></i></li><li ng-click=saveMemo() class=green-button ng-class=\"{'disable-button' : !editedFields}\"><h1>Save</h1></li><li ng-click=revertMemo() class=orange-button ng-class=\"{'disable-button' : !editedFields}\"><h1>Revert</h1></li><li ng-click=deleteMemo() class=red-button ng-if=!newMemo><h1>Delete</h1></li></ul><div class=saving-task ng-if=\"savingEdits && !showSaved\"><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><div class=saved-task ng-if=\"!savingEdits && showSaved\"><span class=saved-checkmark><i class=\"fa fa-check\" aria-hidden=true></i></span><h1>{{showSaved}}</h1></div><div class=header-text><h1>{{memoCopy.title ? 'Editing -' : 'Creating new memo'}} <span>{{memoCopy.title}}</span></h1><h2 ng-class=\"{'show-error' : saveEditsError}\" class=animated>{{saveEditsError ? saveEditsError : ' '}}</h2></div></header><div class=custom-info-form><ul class=\"sub-info-list double-item\"><!-- Memo Title --><li class=\"sub-list-item extra-long\" ng-click=\"enableField('title')\"><label for=memoTitle ng-class=\"{'edited-label' : editedFields['title'], 'error-label' : errorField == 'title'}\">Memo Name :</label><textarea msd-elastic ng-model=selectedMemo.title id=memoTitle placeholder=\"Memo Name\" class=task-textarea ng-disabled=\"!enabledFields['title']\" ng-class=\"{'edited-field' : editedFields['title']}\" ng-change=\"editField('title')\"></textarea></li><!-- Memo Type --><li class=\"sub-list-item small-input\" ng-click=\"enableField('memoType')\"><label for=memoType ng-class=\"{'edited-label' : editedFields['memoType'], 'error-label' : errorField == 'memoType'}\">Type of Memo :</label><div id=memoType class=task-multiple-list><ul><li class=single-select><select name=singleSelect ng-model=selectedMemo.memoType class=task-select ng-change=\"editField('memoType')\" ng-options=\"option.value as option.name for option in memoTypes\" ng-class=\"{'edited-input' : editedFields['memoType']}\"></select><!--<h1 ng-if=\"!enabledFields['taskType']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">--><!--{{selectedMemo.taskType}}--><!--</h1>--></li></ul></div></li></ul><!-- Parent Memo --><ul class=sub-info-list ng-if=\"selectedMemo.memoType === 'child-memo'\"><li class=\"sub-list-item long-row\"><label ng-class=\"{'edited-label' : editedFields['parentMemo'], 'error-label' : errorField == 'parentMemo'}\">Parent Memo : <span class=remove-item ng-if=\"selectedMemo.parentMemo && selectedMemo.memoType == 'child-memo'\" ng-click=removeParentMemo()>Remove Parent</span></label><div class=parent-task-select ng-if=\"selectedMemo.memoType === 'child-memo' && !selectedMemo.parentMemo\" ng-click=selectParent()><h1>Select Parent Memo</h1></div><div class=parent-task-info ng-if=\"selectedMemo.memoType == 'child-memo' && selectedMemo.parentMemo\"><div class=pt-info-container><div class=upper-info><h1><span>Memo :</span> {{parentMemoInfo.title}}</h1></div></div></div></li></ul><!-- Child Memos --><ul class=sub-info-list ng-if=\"selectedMemo.childMemos && selectedMemo.childMemos.length\"><li class=\"sub-list-item long-row\"><label ng-class=\"{'edited-label' : editedFields['childMemos'], 'error-label' : errorField == 'childMemos'}\">Child Memos : <span class=text-muted>You can rearrange these by drag & drop</span></label><ul sv-root sv-part=selectedMemo.childMemos class=child-task-list sv-on-sort=\"editField('childMemos')\"><li ng-repeat=\"childMemo in selectedMemo.childMemos\" sv-element class=child-task-item><ul class=child-task-info-list><li><h1>{{childMemo.childIndex}}</h1></li><li class=child-task-title><span class=\"task-priority priority-{{childMemo.priority}}\" ng-style=\"childMemo.subPriority ? {'background-color' : childMemo.subPriority.color} : ''\"></span><h2>{{childMemo.title}}</h2></li><li ng-click=deleteChildMemo(childMemo)><i class=\"fa fa-trash\"></i></li></ul></li></ul></li></ul><!--&lt;!&ndash; Memo Priority &ndash;&gt;--><!--<ul class=\"sub-info-list double-item\">--><!--&lt;!&ndash; Main Priority &ndash;&gt;--><!--<li class=\"sub-list-item\" ng-click=\"enableField('priority')\">--><!--<label for=\"taskPriority\" ng-class=\"{'edited-label' : editedFields['priority']}\">--><!--Priority : <strong>*Will Be Depreciated</strong>--><!--</label>--><!--<ul id=\"taskPriority\" class=\"task-priority-list\">--><!--<li ng-repeat=\"priority in memoPriorities\" class=\"priority-{{priority.class}}\"--><!--ng-show=\"selectedMemo.priority == priority.class || enabledFields['priority']\"--><!--ng-class=\"{'selected-priority' : enabledFields['priority'] && selectedMemo.priority == priority.class , 'disabled-field' : currentUser.role != 'admin'}\" ng-click=\"changePriority(priority)\">--><!--<span class=\"top-color\"></span>--><!--<span class='bottom-color'></span>--><!--<h2 class=\"priority-label\">--><!--{{priority.label}}--><!--</h2>--><!--</li>--><!--</ul>--><!--</li>--><!--&lt;!&ndash; Sub Priority &ndash;&gt;--><!--<li class=\"sub-list-item\" >--><!--<label for=\"subPriority\" ng-class=\"{'edited-label' : editedFields['subPriority']}\" ng-click=\"enableField('subPriority')\">--><!--Sub Priority :--><!--</label>--><!--<ul id=\"subPriority\" class=\"task-sub-priority-list\">--><!--<li ng-repeat=\"subPriority in subPriorities track by $index\" ng-show=\"selectedMemo.subPriority.color == subPriority.color || enabledFields['subPriority']\"--><!--ng-class=\"{'selected-priority' : enabledFields['subPriority'] && selectedMemo.subPriority.color == subPriority.color}\" ng-click=\"selectSubPriority(subPriority)\">--><!--<span ng-style=\"{'background-color' : subPriority.color}\"></span>--><!--</li>--><!--</ul>--><!--<div class=\"sub-priority-labels\" ng-show=\"enabledFields['subPriority']\">--><!--<h1>--><!--Higher Priority--><!--</h1>--><!--<h1>--><!--Lower Priority--><!--</h1>--><!--</div>--><!--</li>--><!--</ul>--><!-- Memo Notes --><ul class=\"sub-info-list container\"><li class=\"task-col-section col-xs-12 col-sm-7\" ng-click=\"enableField('notes')\" ng-class=\"{'edited-notes' : editedFields['notes']}\"><label for=memoNotes ng-class=\"{'edited-label' : editedFields['notes']}\">Notes :</label><div class=task-notes-editor-container><text-angular-toolbar name=top-toolbar class=col-xs-5></text-angular-toolbar><ul class=text-editor-size><li ng-class=\"{'selected-size' : selectedSize == 'small'}\" ng-click=\"changeEditorSize('small')\"><i class=\"fa fa-mobile\" aria-hidden=true></i><h1>Small</h1></li><li ng-class=\"{'selected-size' : selectedSize == 'medium'}\" ng-click=\"changeEditorSize('medium')\"><i class=\"fa fa-mobile\" aria-hidden=true></i><h1>Medium</h1></li><li ng-class=\"{'selected-size' : selectedSize == 'large'}\" ng-click=\"changeEditorSize('large')\"><i class=\"fa fa-mobile\" aria-hidden=true></i><h1>Large</h1></li></ul><div text-angular ng-model=selectedMemo.notes id=memoNotes ng-blur=checkNotesChanged() ng-focus=saveOldNotes() ta-target-toolbars=top-toolbar class=task-notes-editor ta-disabled=\"!enabledFields['notes']\" class=col-xs-7 ng-style=editorStyle></div><!--<text-angular-toolbar name=\"bottom-toolbar\"></text-angular-toolbar>--><!--<textarea msd-elastic ng-model=\"selectedMemo.notes\" id=\"taskNotes\" placeholder=\"Task notes\" class=\"task-textarea\"--><!--ng-disabled=\"!enabledFields['notes']\" ng-class=\"{'edited-field' : editedFields['notes']}\"--><!--ng-change=\"editField('notes')\" rows=\"2\"></textarea>--></div></li><li class=\"task-col-section col-xs-12 col-sm-5\" ng-click=\"enableField('images')\" ng-class=\"{'edited-notes' : editedFields['images']}\"><label for=memoImages ng-class=\"{'edited-label' : editedFields['images']}\">Images :</label><ul class=task-images-container id=memoImages><li class=task-image-placeholder ng-click=addImage()><i class=\"fa fa-camera\"></i><h1>Add Image</h1></li><li class=task-image ng-repeat=\"image in selectedMemo.images\" ng-mouseenter=\"showImageOpts = true\" ng-mouseleave=\"showImageOpts = false;\"><img ng-src={{image}}> <span class=image-cover ng-class=\"{'show-cover' : showImageOpts}\"></span><ul class=image-opts ng-class=\"{'show-opts' : showImageOpts}\"><li ng-click=removeImage(image)><i class=\"fa fa-trash\"></i></li><li ngclipboard data-clipboard-text={{image}} ngclipboard-success=copiedText(e,image)><i class=\"fa fa-link\" ng-if=\"copied != image\"></i><h2 ng-if=\"copied == image\">Copied!</h2></li></ul></li></ul><!--<textarea msd-elastic ng-model=\"selectedMemo.notes\" id=\"taskNotes\" placeholder=\"Task notes\" class=\"task-textarea\"--><!--ng-disabled=\"!enabledFields['notes']\" ng-class=\"{'edited-field' : editedFields['notes']}\"--><!--ng-change=\"editField('notes')\" rows=\"2\"></textarea>--></li></ul><!-- Left Bar Color --><ul class=sub-info-list><li class=\"sub-list-item full-width-item\"><label ng-class=\"{'edited-label' : editedFields['leftBarColor']}\">Left Bar Color :</label><div class=custom-colors-container><header class=colors-header><ul class=colors-header-list><li ng-click=\"changeColorType('leftBarColor', 'pre-defined')\" ng-class=\"{'selected-type' : isSelectedColorType('leftBarColor', 'pre-defined')}\"><h1>Use Saved Color</h1></li><li ng-click=\"changeColorType('leftBarColor', 'custom')\" ng-class=\"{'selected-type' : isSelectedColorType('leftBarColor', 'custom')}\"><h1>Use Custom Color</h1></li></ul></header><ul class=custom-colors-list><li class=custom-colors-item ng-if=\"isSelectedColorType('leftBarColor', 'pre-defined')\"><ul class=custom-colors><li ng-repeat=\"colorItem in colorItems\" class=color-item><ul class=color-item-list><li ng-repeat=\"color in colorItem\" class=color-{{$index}} ng-click=\"selectColor('leftBarColor', color)\" ng-class=\"{'visible-color' :isSelectedColorType('leftBarColor', 'pre-defined')}\"><span class=color-square ng-style=\"{'background-color' : color}\"></span> <span class=color-selected ng-if=\"isColorSelected('leftBarColor', color)\"><i class=\"fa fa-check\"></i></span></li></ul></li></ul></li><li class=custom-colors-item ng-if=\"isSelectedColorType('leftBarColor', 'custom')\"><div class=color-input-item><input colorpicker=hex class=\"task-input color-input\" ng-model=\"selectedMemo['leftBarColor'].customColor\" ng-change=\"editField('leftBarColor', 'custom-color')\"> <span class=\"input-group-addon color-preview\" ng-style=\"{'background-color' : selectedMemo['leftBarColor'].customColor}\">Color Preview</span></div></li></ul></div></li></ul><!-- Right Bar Color --><ul class=sub-info-list><li class=\"sub-list-item full-width-item\"><label ng-class=\"{'edited-label' : editedFields['rightBarColor']}\">Right Bar Color :</label><div class=custom-colors-container><header class=colors-header><ul class=colors-header-list><li ng-click=\"changeColorType('rightBarColor', 'pre-defined')\" ng-class=\"{'selected-type' : isSelectedColorType('rightBarColor', 'pre-defined')}\"><h1>Use Saved Color</h1></li><li ng-click=\"changeColorType('rightBarColor', 'custom')\" ng-class=\"{'selected-type' : isSelectedColorType('rightBarColor', 'custom')}\"><h1>Use Custom Color</h1></li></ul></header><ul class=custom-colors-list><li class=custom-colors-item ng-if=\"isSelectedColorType('rightBarColor', 'pre-defined')\"><ul class=custom-colors><li ng-repeat=\"colorItem in colorItems\" class=color-item><ul class=color-item-list><li ng-repeat=\"color in colorItem\" class=color-{{$index}} ng-click=\"selectColor('rightBarColor', color)\" ng-class=\"{'visible-color' :isSelectedColorType('rightBarColor', 'pre-defined')}\"><span class=color-square ng-style=\"{'background-color' : color}\"></span> <span class=color-selected ng-if=\"isColorSelected('rightBarColor', color)\"><i class=\"fa fa-check\"></i></span></li></ul></li></ul></li><li class=custom-colors-item ng-if=\"isSelectedColorType('rightBarColor', 'custom')\"><div class=color-input-item><input colorpicker=hex class=\"task-input color-input\" ng-model=\"selectedMemo['rightBarColor'].customColor\" ng-change=\"editField('rightBarColor', 'custom-color')\"> <span class=\"input-group-addon color-preview\" ng-style=\"{'background-color' : selectedMemo['rightBarColor'].customColor}\">Color Preview</span></div></li></ul></div></li></ul><!-- Title Text Color --><ul class=sub-info-list><li class=\"sub-list-item full-width-item\"><label ng-class=\"{'edited-label' : editedFields['titleTextColor']}\">Title Text Color :</label><div class=custom-colors-container><header class=colors-header><ul class=colors-header-list><li ng-click=\"changeColorType('titleTextColor', 'pre-defined')\" ng-class=\"{'selected-type' : isSelectedColorType('titleTextColor', 'pre-defined')}\"><h1>Use Saved Color</h1></li><li ng-click=\"changeColorType('titleTextColor', 'custom')\" ng-class=\"{'selected-type' : isSelectedColorType('titleTextColor', 'custom')}\"><h1>Use Custom Color</h1></li></ul></header><ul class=custom-colors-list><li class=custom-colors-item ng-if=\"isSelectedColorType('titleTextColor', 'pre-defined')\"><ul class=custom-colors><li ng-repeat=\"colorItem in colorItems\" class=color-item><ul class=color-item-list><li ng-repeat=\"color in colorItem\" class=color-{{$index}} ng-click=\"selectColor('titleTextColor', color)\" ng-class=\"{'visible-color' :isSelectedColorType('titleTextColor', 'pre-defined')}\"><span class=color-square ng-style=\"{'background-color' : color}\"></span> <span class=color-selected ng-if=\"isColorSelected('titleTextColor', color)\"><i class=\"fa fa-check\"></i></span></li></ul></li></ul></li><li class=custom-colors-item ng-if=\"isSelectedColorType('titleTextColor', 'custom')\"><div class=color-input-item><input colorpicker=hex class=\"task-input color-input\" ng-model=\"selectedMemo['titleTextColor'].customColor\" ng-change=\"editField('titleTextColor', 'custom-color')\"> <span class=\"input-group-addon color-preview\" ng-style=\"{'background-color' : selectedMemo['titleTextColor'].customColor}\">Color Preview</span></div></li></ul></div></li></ul><!-- Memo Bar Color --><ul class=sub-info-list><li class=\"sub-list-item full-width-item\"><label ng-class=\"{'edited-label' : editedFields['memoBarColor']}\">Memo Bar Color :</label><div class=custom-colors-container><header class=colors-header><ul class=colors-header-list><li ng-click=\"changeColorType('memoBarColor', 'pre-defined')\" ng-class=\"{'selected-type' : isSelectedColorType('memoBarColor', 'pre-defined')}\"><h1>Use Saved Color</h1></li><li ng-click=\"changeColorType('memoBarColor', 'custom')\" ng-class=\"{'selected-type' : isSelectedColorType('memoBarColor', 'custom')}\"><h1>Use Custom Color</h1></li></ul></header><ul class=custom-colors-list><li class=custom-colors-item ng-if=\"isSelectedColorType('memoBarColor', 'pre-defined')\"><ul class=custom-colors><li ng-repeat=\"colorItem in colorItems\" class=color-item><ul class=color-item-list><li ng-repeat=\"color in colorItem\" class=color-{{$index}} ng-click=\"selectColor('memoBarColor', color)\" ng-class=\"{'visible-color' :isSelectedColorType('memoBarColor', 'pre-defined')}\"><span class=color-square ng-style=\"{'background-color' : color}\"></span> <span class=color-selected ng-if=\"isColorSelected('memoBarColor', color)\"><i class=\"fa fa-check\"></i></span></li></ul></li></ul></li><li class=custom-colors-item ng-if=\"isSelectedColorType('memoBarColor', 'custom')\"><div class=color-input-item><input colorpicker=hex class=\"task-input color-input\" ng-model=\"selectedMemo['memoBarColor'].customColor\" ng-change=\"editField('memoBarColor', 'custom-color')\"> <span class=\"input-group-addon color-preview\" ng-style=\"{'background-color' : selectedMemo['memoBarColor'].customColor}\">Color Preview</span></div></li></ul></div></li></ul></div></section>"),
a.put("app/memo/memo.main.html",'<section class=memo-route><header class=memo-header><ul class=memo-header-list><li class="memo-title-cell memo-cell"><h1>Memo Name</h1></li><li class=sort-prompt ng-class="{\'visible-title\' : !sortDisabled}"><h1>Sorting Memos</h1></li></ul></header><div class=memo-batch-prompt ng-class="{\'show-select-prompt\' : showSelectPrompt}"><h1>Select Parent Memo</h1><h2>Parent: {{selectedParentMemo.title}}</h2><ul class=batch-buttons><li ng-click=cancelSelect()><h1>Cancel</h1></li><li ng-click=confirmSelect()><h1>Confirm</h1></li></ul></div><div ng-if="!allMemos || !allMemos.length" class=no-memos ng-click=addMemo()><i class="fa fa-sticky-note-o"></i><h1>No Memos</h1><h2>Click here to add one.</h2></div><ul class=memo-table ng-if="allMemos && allMemos.length" sv-root sv-part=allMemos sv-on-sort=updateParentSorts()><li sv-element ng-repeat="memo in allMemos track by $index" class=memo-container ng-class="{\'selected-memo\' : selectedMemo === memo,\n                    \'selected-parent\' : selectedParentMemo === memo,\n                    \'flash-update-parent\' : memo.flashUpdate}" ng-style="{\'height\' : memo.showChildren ? memo.childrenHeight : \'\', \'min-height\' : memo.showChildren ? memo.childrenHeight : \'\',\n            \'background-color\' : memo.memoBarColor ? memo.memoBarColor.selectedColor : \'\' }"><ul class=memo-info-list><li class="memo-cell memo-title-cell parent-cell" ng-click=selectMemo(memo) sv-handle sv-handle-disabled={{disableSort()}}><span class="memo-color-bar memo-left-bar" ng-if=memo.leftBarColor ng-style="{\'background-color\' : memo.leftBarColor.selectedColor}"></span><h1 sv-handle-disabled={{disableSort()}} ng-style="memo.titleTextColor ? {\'color\' : memo.titleTextColor.selectedColor} : {\'color\' : \'#555555\'}">{{memo.title}}</h1><span class="memo-color-bar memo-right-bar" ng-if=memo.rightBarColor ng-style="{\'background-color\' : memo.rightBarColor.selectedColor}"></span></li><li class="memo-cell memo-children-count parent-cell" ng-click=toggleChildren(memo)><h1>{{memo.childMemos ? memo.childMemos.length : 0}}</h1><h2>Nested Memos</h2></li><li class="memo-cell memo-children parent-cell" ng-click=toggleChildren(memo) ng-if=memo.childMemos><i class=fa ng-class="{\'fa-chevron-up\' : memo.showChildren , \'fa-chevron-down\' : !memo.showChildren}"></i><h1>{{memo.showChildren ? \'Hide\' : \'Show\'}} Nested</h1></li></ul><ul class=child-memo-list ng-if=memo.childMemos ng-class="{\'show-child-memo-list\' : memo.showChildren}"><li ng-repeat="childMemo in memo.childMemos track by $index" class=memo-container ng-class="{\'selected-memo\' : selectedMemo === childMemo,\n            \'flash-update-child\' : childMemo.flashUpdate}" ng-style="childMemo.memoBarColor ? {\'background-color\' : childMemo.memoBarColor.selectedColor} : \'\'"><ul class=memo-info-list><li class="memo-cell memo-title-cell child-cell" ng-click=selectMemo(childMemo)><span class="memo-color-bar memo-left-bar" ng-if=childMemo.leftBarColor ng-style="{\'background-color\' : childMemo.leftBarColor.selectedColor}"></span><h1 ng-style="childMemo.titleTextColor ? {\'color\' : childMemo.titleTextColor.selectedColor} : {\'color\' : \'#555555\'}">{{childMemo.title}}</h1><span class="memo-color-bar memo-right-bar" ng-if=childMemo.rightBarColor ng-style="{\'background-color\' : childMemo.rightBarColor.selectedColor}"></span></li></ul></li></ul></li></ul><aside class=memo-side-info><header><h1>Memo Info</h1></header><div class=selected-memo-info><div class=no-selected-memo ng-if=!selectedMemo><h1>No Memo Selected</h1></div><ul class=info-list ng-if=selectedMemo><li><label class=selected-memo-label>Memo Name</label><h1 class=selected-memo-title>{{selectedMemo.title}}</h1></li><li><label class=selected-memo-label>Created</label><h1 class=selected-memo-title>{{selectedMemo.createdDate | date : \'mediumDate\'}}</h1></li><li class=memo-notes><label class=selected-memo-label>Notes</label><div id=memoNotes placeholder="Memo Notes" class=memo-textarea ng-bind-html=selectedMemo.notes rows=4></div></li><li><label class=selected-memo-label>Child Memo Count</label><h1 class=selected-memo-title>{{selectedMemo.childMemos ? selectedMemo.childMemos.length : 0}}</h1></li></ul></div><footer><ul class=footer-list><li class=edit-memo ng-class="{\'show-edit\' : selectedMemo}"><button class=edit-memo-action id=redButton ng-if="currentUser.role === \'admin\'" ng-click=deleteMemo()><h1>Delete</h1></button> <button class=edit-memo-action ng-if="currentUser.role === \'admin\'" ng-click=editMemo()><h1>Edit</h1></button></li><li ng-click=addMemo() class="footer-button green-button"><i class="fa fa-plus"></i><h1>New Memo</h1></li><li ng-click=toggleSort() ng-class="{\'sort-mode\' : !sortDisabled}" class=footer-button><i class="fa fa-circle-thin" ng-if=sortDisabled></i> <i class="fa fa-check-circle-o" aria-hidden=true ng-if=!sortDisabled></i><h1>Toggle Sort</h1></li></ul></footer></aside><!--<button class="add-memo" ng-click="addMemo()">--><!--<i class="fa fa-plus"></i>--><!--</button>--><div ui-view></div></section>'),a.put("app/site/edit-site.html",'<section class=edit-site><nav class=edit-tabs><div ng-repeat="tab in tabs" ng-click=changeTab(tab) ng-class="{\'selected-tab\' : selectedTab === tab}"><h1>{{tab}}</h1></div></nav><section class="edit-container container"><div class=site-details ng-if="selectedTab == \'app environment\'"><h1 class=section-title>App Environment</h1><div class="row room-row" ng-class="{\'edited-row\' : site.changeMainColor || site.changeSubColor}"><h2 class=section-label>Operation Colors</h2><div class="form-group col-xs-12 col-sm-4 col-sm-offset-2 col-md-3"><h1 class=custom-label ng-class="{\'edited-label\' : site.changeMainColor}">Main Color</h1><input colorpicker=hex class="form-control color-input" ng-model=site.mainColor ng-change="changeColor(\'main\')"> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : site.mainColor}">Color Preview</span></div><div class="form-group col-xs-12 col-sm-4 col-sm-offset-1 col-md-3 col-md-offset-1"><h1 class=custom-label ng-class="{\'edited-label\' : site.changeSubColor}">Sub Color</h1><input colorpicker=hex class="form-control color-input" ng-model=site.subColor ng-change="changeColor(\'sub\')"> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : site.subColor}">Color Preview</span></div><div class=save-container ng-if="site.changeMainColor || site.changeSubColor"><ul class=edit-buttons ng-if=!site.savingColors><li><button ng-click=saveColors()><h1>Save</h1></button><label class=text-muted>Press "Save" to save changes.</label></li><li><button class=red-button ng-click=revertColors()><h1>Cancel</h1></button><label class=text-muted>Press "Cancel" to revert changes.</label></li></ul><label class=save-warning ng-if=saveColorsError>{{saveColorsError}}</label><div ng-if=site.savingColors><div class=loading-container><h1>Saving...</h1><md-progress-circular md-mode=indeterminate md-diameter=20px></md-progress-circular></div></div></div></div><div class="row room-row" ng-class="{\'edited-row\' : changedDetails}"><h2 class=section-label>Location Details</h2><div class="form-group col-xs-12 col-sm-4 col-sm-offset-2 col-md-3"><h1 class=custom-label ng-class="{\'edited-label\' : changedDisplayName}">Display Name</h1><input class=form-control ng-model=site.displayName ng-change="changeDetails(\'displayName\')"></div><div class="form-group col-xs-12 col-sm-4 col-sm-offset-2 col-md-3"><h1 class=custom-label ng-class="{\'edited-label\' : changedDetails}">Is Non-Grow Site</h1><div class=checkbox-container><input type=checkbox class=form-control ng-model=site.isNonGrow ng-click="changeDetails(\'isNonGrow\')"><p>This location will not show up under the \'Dashboard\' tab & older versions of Clarity.</p></div></div><div class=save-container ng-if=changedDetails><ul class=edit-buttons ng-if=!savingDetails><li><button ng-click=saveDetails()><h1>Save</h1></button><label class=text-muted>Press "Save" to save changes.</label></li><li><button class=red-button ng-click=revertDetails()><h1>Cancel</h1></button><label class=text-muted>Press "Cancel" to revert changes.</label></li></ul><label class=save-warning ng-if=saveDetailsError>{{saveDetailsError}}</label><div ng-if=savingDetails><div class=loading-container><h1>Saving...</h1><md-progress-circular md-mode=indeterminate md-diameter=20px></md-progress-circular></div></div></div></div><!--<div class="row room-row" ng-class="{\'edited-row\' : site.changeMainColor || site.changeSubColor}">--><!--<h2 class="section-label">--><!--Tunnel Colors--><!--</h2>--><!--<div class="form-group col-xs-12 col-sm-4 col-md-6">--><!--<ul class="room-color-list">--><!--<li class="room-color" ng-repeat="room in site.rooms | orderBy : \'name\'">--><!--<label>--><!--{{room.name}}--><!--</label>--><!--<div class="color-square" ng-style="{\'background-color\' : room.mainColor}">--><!--</div>--><!--</li>--><!--</ul>--><!--</div>--><!--<div class="save-container" ng-if="site.changeMainColor || site.changeSubColor">--><!--<ul class="edit-buttons" ng-if="!site.savingColors">--><!--<li>--><!--<button ng-click="saveColors()">--><!--<h1>--><!--Save--><!--</h1>--><!--</button>--><!--<label  class="text-muted">--><!--Press "Save" to save changes.--><!--</label>--><!--</li>--><!--<li>--><!--<button class="red-button" ng-click="revertColors()">--><!--<h1>--><!--Cancel--><!--</h1>--><!--</button>--><!--<label  class="text-muted">--><!--Press "Cancel" to revert changes.--><!--</label>--><!--</li>--><!--</ul>--><!--<label  class="save-warning" ng-if="saveColorsError">--><!--{{saveColorsError}}--><!--</label>--><!--<div ng-if="site.savingColors">--><!--<div class="loading-container">--><!--<h1>--><!--Saving...--><!--</h1>--><!--<md-progress-circular md-mode="indeterminate" md-diameter="20px"></md-progress-circular>--><!--</div>--><!--</div>--><!--</div>--><!--</div>--> <button class=site-button ng-click=goToDashboard()>View Dashboard</button></div><!-- Room Details --><div ng-if="selectedTab == \'room details\'"><h1 class=section-title>Room Details</h1><button class=new-room ng-click=newRoom()><i class="fa fa-plus"></i><h1>New Room</h1></button><div class=container><div class="row room-row" ng-repeat="room in site.rooms" ng-class="{\'edited-row\' : room.edited, \'removed-room\' : room.removed}"><h1 class=section-label ng-if=room.newRoom><i class="fa fa-star"></i> New Room <i class="fa fa-star"></i></h1><h1 class=section-label>{{room.name}}</h1><div class=row><!--<div class="form-group col-xs-10 col-sm-3">--><!--<h1 class="custom-label" ng-class="{\'edited-label\' : room.changedDetails[\'name\']}">--><!--Name--><!--</h1>--><!--<input type="text" class="form-control" id="roomName" placeholder="Room Name e.g., Tunnel 1" ng-model="room.name"  ng-change="changeRoomDetails(room, \'name\')">--><!--</div>--><div class="form-group col-xs-10 col-sm-3"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedDetails[\'amountOfPlants\']}">Amount of Plants</h1><input type=number class=form-control id=amountOfPlants placeholder="" ng-model=room.amountOfPlants ng-change="changeRoomDetails(room, \'amountOfPlants\')"><label class="pull-right text-muted">Whole numbers only please.</label></div><div class="form-group col-xs-10 col-sm-3"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedDetails[\'amountOfLights\']}">Amount of Lights</h1><input type=number class=form-control placeholder="" ng-model=room.amountOfLights ng-change="changeRoomDetails(room, \'amountOfLights\')"><label class="pull-right text-muted">Whole numbers only please.</label></div><div class="form-group col-xs-10 col-sm-3"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedDetails[\'amountOfReservoirs\']}">Amount of Reservoirs</h1><input type=number class=form-control placeholder="" ng-model=room.amountOfReservoirs ng-change="changeRoomDetails(room, \'amountOfReservoirs\')"><label class="pull-right text-muted">Whole numbers only please.</label></div></div><div class=row><div class="form-group col-xs-10 col-sm-3"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedDetails[\'amountOfTables\']}">Amount of Tables</h1><input type=number class=form-control placeholder="" ng-model=room.amountOfTables ng-change="changeRoomDetails(room, \'amountOfTables\')"><label class="pull-right text-muted">Whole numbers only please.</label></div><div class="form-group col-xs-10 col-sm-3"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedDetails[\'roomType\']}">Type of Room</h1><input class=form-control placeholder="E.g., Undercurrents" ng-model=room.roomType ng-change="changeRoomDetails(room, \'roomType\')"></div><div class=save-container ng-if=room.edited><ul class=edit-buttons ng-if=!room.savingDetails><li><button ng-click="saveRoomDetails(room, $index)"><h1>Save</h1></button><label class=text-muted>Press "Save" to save changes.</label></li><li><button class=red-button ng-click=revertRoomDetails(room)><h1>Cancel</h1></button><label class=text-muted>Press "Cancel" to revert changes.</label></li></ul><h1 class=save-warning ng-if=room.saveDetailsError>{{room.saveDetailsError}}</h1><div ng-if=room.savingDetails><div class=loading-container><h1>Saving...</h1><md-progress-circular md-mode=indeterminate md-diameter=20px></md-progress-circular></div></div></div></div><div class=delete-room ng-click="deleteRoom(room, $index)"><i class="fa fa-trash"></i></div></div></div></div><!-- Room Lights --><div ng-if="selectedTab == \'room lights\'"><h1 class=section-title>Room Lights</h1><div class=container><div class="row room-row" ng-repeat="room in site.rooms | orderBy : \'name\'" ng-class="{\'edited-row\' : room.editedLights}" ng-if=room._id><h2 class=section-label>{{room.name}}</h2><div class="form-group col-xs-10 col-sm-4 col-sm-offset-3"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedLightsOn}">Lights On</h1><div uib-timepicker ng-model=room.lightsOn ng-change="changeLights(room, \'on\')"></div></div><div class="form-group col-xs-10 col-sm-4 col-sm-offset-0"><h1 class=custom-label ng-class="{\'edited-label\' : room.changedLightsOff}">Lights Off</h1><div uib-timepicker ng-model=room.lightsOff ng-change="changeLights(room, \'off\')"></div></div><div class=save-container ng-if=room.editedLights><ul class=edit-buttons ng-if=!room.saving><li><button ng-click="saveRoom(room, $index)"><h1>Save</h1></button><label class=text-muted>Press "Save" to save changes.</label></li><li><button class=red-button ng-click=revertRoomLights(room)><h1>Cancel</h1></button><label class=text-muted>Press "Cancel" to revert changes.</label></li></ul><label class=save-warning ng-if=room.saveError>{{room.saveError}}</label><div ng-if=room.saving><div class=loading-container><h1>Saving...</h1><md-progress-circular md-mode=indeterminate md-diameter=20px></md-progress-circular></div></div></div></div></div></div><div class=room-dates ng-if="selectedTab == \'room dates\'" ng-init=formatDates()><h1 class=section-title>Room Dates</h1><h2 class=section-subtitle>*Note: Clicking "Generate" will prompt you to specify a \'Timeline Template\' before generation.</h2><div class=container><div class="row room-row" ng-repeat="room in site.rooms | orderBy : \'name\'" ng-if=room._id ng-class="{\'edited-row\' : room.changedStart || room.changedFlipped || room.changedEnd}"><h1 class=section-label>{{room.name}}</h1><div class="col-xs-12 col-sm-4"><h4 class=custom-label ng-class="{\'edited-label\' : room.changedStart}">Start Date</h4><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" ng-model=room.startDate is-open=openStartPickers[$index] datepicker-options=dateOptions ng-required=true close-text=Close alt-input-formats=altInputFormats ng-change="changeDate(room,\'startDate\')" placeholder="No Start Date."> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="openStart($event, $index)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><div class=generate-tasks-button><div class=generate-info><h1>Generate tasks from this date</h1><h2><span>Last generated : </span>{{room.lastGeneratedStartTasks ? room.lastGeneratedStartTasks : \'NA\' | date : \'EEEE, MMM, d\'}}</h2><h3 ng-class="{\'show-error\': room.startDateError}">Please include a start date.</h3></div><div class=generate-button ng-click="generateTasks(room,\'startDate\')"><h1>Generate</h1></div></div></div><div class=col-sm-4><h4 class=custom-label ng-class="{\'edited-label\' : room.changedFlipped}">Flipped Date <span class=custom-label-button ng-click="populateDate(room, \'flippedDate\')" ng-if="(room.changedStart && room.startDate) || (room.startDate && !room.flippedDate)">\'Click to add 3 weeks from start date.\'</span></h4><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" ng-model=room.flippedDate is-open=openFlippedPickers[$index] datepicker-options=dateOptions ng-required=true close-text=Close alt-input-formats=altInputFormats ng-change="changeDate(room,\'flippedDate\')" placeholder="Not Yet Flipped."> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="openFlipped($event, $index)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><div class=generate-tasks-button><div class=generate-info><h1>Generate tasks from this date</h1><h2><span>Last generated : </span>{{room.lastGeneratedFlippedTasks ? room.lastGeneratedFlippedTasks : \'NA\' | date : \'EEEE, MMM, d\'}}</h2><h3 ng-class="{\'show-error\': room.flippedDateError}">Please include a flipped date.</h3></div><div class=generate-button ng-click="generateTasks(room,\'flippedDate\')"><h1>Generate</h1></div></div></div><div class=col-sm-4><h4 class=custom-label ng-class="{\'edited-label\' : room.changedEnd}">End Date <span class=custom-label-button ng-click="populateDate(room, \'endDate\')" ng-if="(!room.endDate && (room.flippedDate || room.startDate)) ||\n                                                                    ((room.changedFlipped && room.flippedDate) || (room.changedStart && room.startDate))">{{room.flippedDate ? \'Click to add 8 weeks from flipped date.\' : \'Click to add 12 weeks from start date.\'}}</span></h4><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" ng-model=room.endDate is-open=openEndPickers[$index] datepicker-options=dateOptions ng-required=true close-text=Close alt-input-formats=altInputFormats ng-change="changeDate(room,\'endDate\')" placeholder="No End Date."> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="openEnd($event, $index)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><div class=generate-tasks-button><div class=generate-info><h1>Generate tasks from this date</h1><h2><span>Last generated : </span>{{room.lastGeneratedEndTasks ? room.lastGeneratedEndTasks : \'NA\' | date : \'EEEE, MMM, d\'}}</h2><h3 ng-class="{\'show-error\': room.endDateError}">Please include an end date.</h3></div><div class=generate-button ng-click="generateTasks(room,\'endDate\')"><h1>Generate</h1></div></div></div><div class=save-container ng-if="room.changedStart || room.changedFlipped || room.changedEnd"><ul class=edit-buttons ng-if=!room.savingDates><li><button ng-click=saveDates(room)><h1>Save</h1></button><label class=text-muted>Press "Save" to save changes.</label></li><li><button class=red-button ng-click=revertDates(room)><h1>Cancel</h1></button><label class=text-muted>Press "Cancel" to revert changes.</label></li></ul><label class=save-warning ng-if=room.saveDatesError>{{room.saveDatesError}}</label><div ng-if=room.savingDates><div class=loading-container><h1>Saving...</h1><md-progress-circular md-mode=indeterminate md-diameter=20px></md-progress-circular></div></div></div></div></div></div></section></section>'),a.put("app/site/site.html",'<div class=site-container><div class=cover></div><div class=container><div class=site ng-repeat="site in sites"><h1>{{site.name}}</h1><h2>Rooms: <span>{{site.rooms.length}}</span></h2><nav><a no-href ng-click=viewDashboard(site)>Dashboard </a><a no-href ng-click=editSite(site)>Edit </a><!--<a no-href ng-click="deleteSite(site)">--><!--Delete--><!--</a>--></nav></div><!--<uib-accordion close-other="true">--><!--<uib-accordion-group heading="{{site.name}}"--><!--ng-repeat="site in sites" panel-class="panel-success"--><!--template-url="components/baseObjAccordion/accordionTemplate.html">--><!--<base-obj-accordion accordion-obj="site" edit-object="editSite" delete-object="deleteSite" view-dashboard="viewDashboard"></base-obj-accordion>--><!--</uib-accordion-group>--><!--</uib-accordion>--> <button type=submit class=add-site ng-click=createSite()><span class="glyphicon glyphicon-plus" aria-hidden=true></span><h1>New Site</h1></button><base-object ng-if=showBaseObj model-type={{modelType}} selected-action={{selectedAction}} close-view=closeView save-callback=childSaveCallback saved-base-obj=savedBaseObj></base-object></div></div>'),a.put("app/timeline/timeline.html","<section class=timeline-route><aside class=collapse-menu ng-class=\"{'show-nav' : showSideNav}\"><timeline-nav update-task-view=\"updateTaskView({tasks: tasks, isMaster : isMaster})\" add-task=addTask()></timeline-nav></aside><div class=timeline-table ng-class=\"{'has-side-info' : toggledTask, 'has-side-nav' : showSideNav}\"><header><ul class=left-side-cells><li class=move-task-cell><h1>Move Task One Day</h1></li><li class=from-timeline-cell><h1>From Timeline</h1></li><li class=due-date-cell><h1>Date This Task is Due</h1></li><li class=operation-cell><h1>Operation Number</h1></li><li class=tunnel-cell><h1>Tunnel Number</h1></li><li class=tunnel-cycle-cell><h1>Tunnel Week / Day</h1></li></ul><ul class=right-side-cells><li class=task-name-cell></li><li class=time-estimate-cell><h1>Estimated Task Time</h1></li><li class=assigned-to-cell><h1>Assigned To</h1></li><li class=countdown-cell><h1>Countdown Until Due</h1></li></ul><div class=batch-prompt ng-class=\"{'show-prompt' : showBatchPrompt}\"><h1 class={{showBatchPrompt}} ng-if=\"showBatchPrompt !== 'select-parent'\">{{batchTitle}}</h1><h1 class=select-parent-task ng-if=\"showBatchPrompt === 'select-parent'\">Select Parent Task</h1><h2 ng-if=\"showBatchPrompt !== 'select-parent'\">{{batchInfo}} {{batchItems.length ? batchItems.length : 0}} items</h2><h2 ng-if=\"showBatchPrompt === 'select-parent'\" ng-class=\"{'prompt-error' : selectParentError}\">{{selectParentMessage}}</h2><ul><li ng-click=cancelBatch()><h3>Cancel</h3></li><li ng-click=confirmBatch()><h3>Confirm</h3></li></ul></div></header><div class=timeline-list-container><ul class=timeline-list ng-repeat=\"timelineTask in timelineTaskArr\"><div class=timeline-task-date><span class=date-line></span><h2><span am-time-ago=timelineTask.date._i ng-if=!timelineTask.isToday></span> <span id=endOfList ng-if=\"todayNotFound && $last\"></span> <span ng-if=timelineTask.isToday id=todaysDate>{{getTodayLabel(timelineTask)}}</span></h2><h2>{{timelineTask.date._i | date : 'MMMM d'}}</h2></div><li class=tl-main-list-item ng-repeat=\"task in timelineTask.tasks\" ng-class=\"{'flash-update' : task.flashUpdate,\n                'mark-for-delete' : showBatchPrompt == 'delete' && selectedForBatch(task),\n                'batch-green' : (showBatchPrompt == 'complete' || showBatchPrompt == 'restore') && selectedForBatch(task),\n                'selected-task' : (selectedParentTask === task || toggledTask._id === task._id)}\" ng-style=\"task.showChildTasks && {'height' : task.childTaskHeight}\"><ul class=\"left-side-cells tl-sub-list\" ng-click=\"!showBatchPrompt || batchItem(task)\"><li class=\"move-task-cell split-cell button-cell\"><div ng-click=addTaskDay()><i class=\"fa fa-chevron-up\"></i></div><div ng-click=subtractDay()><i class=\"fa fa-chevron-down\"></i></div></li><li class=\"from-timeline-cell full-cell small-text colored-cell\" ng-click=\"showBatchPrompt || toggleTask(task)\" ng-class=\"{'white-text' : task.taskColor}\" ng-style=\"task.taskColor ? {'background-color' : task.taskColor} : ''\"><h1>{{task.taskTypeFormatted}}</h1></li><li class=\"due-date-cell split-cell\" ng-click=\"showBatchPrompt || toggleTask(task)\"><div><h1 ng-if=!task.checkTemplateObj>{{task.occurrenceDate._i | date : 'EEEE'}}</h1><h1 ng-if=task.checkTemplateObj>Repeats</h1></div><div><h1 ng-if=!task.checkTemplateObj>{{task.occurrenceDate._i | date : 'MMMM d'}}</h1><h1 ng-if=task.checkTemplateObj>{{task.taskRepeatString}}</h1></div></li><li class=\"operation-cell full-cell colored-cell\" ng-click=\"showBatchPrompt || toggleTask(task)\" ng-class=\"{'dim-cell-text' : task.siteShortName == 'NA', 'white-text' : task.site && task.site.mainColor}\" ng-style=\"task.site && task.site.mainColor ? {'background-color' : task.site.mainColor} : ''\"><h1>{{task.isMaster ? 'Master' : task.siteShortName}}</h1></li><li class=\"tunnel-cell full-cell colored-cell\" ng-class=\"{'dim-cell-text' : task.tunnelShortName == 'NA', 'white-text' : task.site && task.site.mainColor}\" ng-style=\"task.room && task.site && task.site.subColor ? {'background-color' : task.site.subColor} : ''\"><h1>{{task.isMaster ? 'Master' : task.tunnelShortName}}</h1></li><li class=\"tunnel-cycle-cell split-cell small-text\" ng-click=\"showBatchPrompt || toggleTask(task)\" ng-class=\"{'full-cell dim-cell-text' : task.checkTemplateObj}\"><div ng-if=!task.checkTemplateObj><h1 ng-if=\"task.taskWeek && task.inPeriod && (task.inPeriod === 'flower' || task.inPeriod === 'veg')\">W{{task.taskWeek}}-{{task.inPeriod.charAt(0)}}</h1><h1 ng-if=\"task.taskWeek && (!task.inPeriod || task.inPeriod === 'na' || task.inPeriod === 'finalize')\">W{{task.taskWeek}}</h1><h1 ng-if=!task.taskWeek class=\"dim-text small-text\">NA</h1></div><div ng-if=!task.checkTemplateObj><h1 ng-if=task.taskDay>Day {{task.taskDay}}</h1><h1 ng-if=!task.taskDay class=\"dim-text small-text\">NA</h1></div><h1 ng-if=task.checkTemplateObj>NA</h1></li></ul><ul class=\"right-side-cells tl-sub-list\" ng-click=\"!showBatchPrompt || batchItem(task)\"><li class=task-name-cell><span class=\"task-priority priority-{{task.priority}}\" ng-style=\"task.subPriority ? {'background-color' : task.subPriority.color} : ''\" ng-click=toggleTask(task)></span><h1 ng-class=\"{'shrink-title' : task.childTasks}\" ng-click=toggleTask(task)>{{task.title}}</h1><div class=child-tasks ng-if=\"task.childTasks && task.childTasks.length\" ng-click=toggleChildTasks(task)><i class=fa ng-class=\"{'fa-chevron-up' : task.showChildTasks, 'fa-chevron-down' : !task.showChildTasks}\"></i><h2>{{task.showChildTasks ? 'Hide' : 'Show'}} Nested</h2></div></li><li class=\"time-estimate-cell split-cell\" ng-if=!task.isMaster ng-class=\"{'full-cell dim-cell-text' : !task.taskTime}\"><div ng-if=task.taskTime><h1>{{task.taskTime['hr']}} <span>{{task.taskTime['hr'] != 1 ? 'hrs' : 'hr'}}</span></h1></div><div ng-if=task.taskTime><h1>{{task.taskTime['min']}} <span>{{task.taskTime['min'] != 1 ? 'mins' : 'min'}}</span></h1></div><h1 ng-if=!task.taskTime>NA</h1></li><li class=\"time-estimate-cell split-cell\" ng-if=task.isMaster><div><h1>{{task.timeEstimate.amount}} {{task.timeEstimate.unit == 'minute' ? 'min' : 'hr'}}</h1></div><div><h1>{{task.timeEstimate.per}}</h1></div></li><li class=\"assigned-to-cell icon-text small-text\"><i class=\"icon icon-friend-l\"></i><h1>Anyone</h1></li><li class=\"countdown-cell split-cell small-text\" ng-class=\"{'icon-text' : task.completed}\" ng-click=completeTask(task)><div ng-if=!task.completed><h1>{{getDaysFrom(timelineTask.date)}}</h1></div><div ng-if=!task.completed><h1>{{timelineTask.date | amDifference : null : 'days' }} Days</h1></div><span class=check-mark-circle ng-if=task.completed><i class=\"fa fa-check\" aria-hidden=true></i></span><h1 ng-if=task.completed>Complete</h1></li></ul><ul class=child-tasks-list ng-if=task.childTasks ng-class=\"{'show-child-tasks-list' : task.showChildTasks}\"><li ng-repeat=\"childTask in task.childTasks\" class=child-task-container ng-class=\"{'selected-task' : toggledTask._id === childTask._id}\"><ul class=\"left-side-cells tl-sub-list\" ng-click=\"!showBatchPrompt || batchItem(childTask)\"><li class=\"from-timeline-cell full-cell\"><h1>{{childTask.childIndex}}</h1></li><li class=\"from-timeline-cell full-cell small-text colored-cell\" ng-click=\"showBatchPrompt || toggleTask(childTask)\" ng-class=\"{'white-text' : childTask.taskColor}\" ng-style=\"childTask.taskColor ? {'background-color' : childTask.taskColor} : ''\"><h1>{{childTask.taskTypeFormatted}}</h1></li><li class=\"due-date-cell split-cell\" ng-click=\"showBatchPrompt || toggleTask(childTask)\"><div><h1 ng-if=!childTask.checkTemplateObj>{{childTask.occurrenceDate._i | date : 'EEEE'}}</h1><h1 ng-if=childTask.checkTemplateObj>Repeats</h1></div><div><h1 ng-if=!childTask.checkTemplateObj>{{childTask.occurrenceDate._i | date : 'MMMM d'}}</h1><h1 ng-if=childTask.checkTemplateObj>{{childTask.taskRepeatString}}</h1></div></li><li class=\"operation-cell full-cell colored-cell\" ng-click=\"showBatchPrompt || toggleTask(childTask)\" ng-class=\"{'dim-cell-text' : childTask.siteShortName == 'NA', 'white-text' : childTask.site && childTask.site.mainColor}\" ng-style=\"childTask.site && childTask.site.mainColor ? {'background-color' : childTask.site.mainColor} : ''\"><h1>{{childTask.isMaster ? 'Master' : childTask.siteShortName}}</h1></li><li class=\"tunnel-cell full-cell colored-cell\" ng-class=\"{'dim-cell-text' : childTask.tunnelShortName == 'NA'}\"><h1>{{childTask.isMaster ? 'Master' : childTask.tunnelShortName}}</h1></li><li class=\"tunnel-cycle-cell split-cell small-text\" ng-click=\"showBatchPrompt || toggleTask(childTask)\" ng-class=\"{'full-cell dim-cell-text' : childTask.checkTemplateObj}\"><div ng-if=!childTask.checkTemplateObj><h1 ng-if=childTask.taskWeek>W{{childTask.taskWeek}}-{{childTask.inPeriod.charAt(0)}}</h1><h1 ng-if=!childTask.taskWeek class=\"dim-text small-text\">NA</h1></div><div ng-if=!childTask.checkTemplateObj><h1 ng-if=childTask.taskDay>Day {{childTask.taskDay}}</h1><h1 ng-if=!childTask.taskDay class=\"dim-text small-text\">NA</h1></div><h1 ng-if=childTask.checkTemplateObj>NA</h1></li></ul><ul class=\"right-side-cells tl-sub-list\" ng-click=\"!showBatchPrompt || batchItem(childTask)\"><li class=task-name-cell><span class=\"task-priority priority-{{childTask.priority}}\" ng-style=\"childTask.subPriority ? {'background-color' : childTask.subPriority.color} : ''\" ng-click=toggleTask(childTask)></span><h1 ng-class=\"{'shrink-title' : childTask.childTasks}\" ng-click=toggleTask(childTask)>{{childTask.title}}</h1></li><li class=\"time-estimate-cell split-cell\" ng-if=!childTask.isMaster ng-class=\"{'full-cell dim-cell-text' : !childTask.taskTime}\"><div ng-if=childTask.taskTime><h1>{{childTask.taskTime['hr']}} <span>{{childTask.taskTime['hr'] != 1 ? 'hrs' : 'hr'}}</span></h1></div><div ng-if=childTask.taskTime><h1>{{childTask.taskTime['min']}} <span>{{childTask.taskTime['min'] != 1 ? 'mins' : 'min'}}</span></h1></div><h1 ng-if=!childTask.taskTime>NA</h1></li><li class=\"time-estimate-cell split-cell\" ng-if=childTask.isMaster><div><h1>{{childTask.timeEstimate.amount}} {{childTask.timeEstimate.unit == 'minute' ? 'min' : 'hr'}}</h1></div><div><h1>{{childTask.timeEstimate.per}}</h1></div></li><li class=\"assigned-to-cell icon-text small-text\"><i class=\"icon icon-friend-l\"></i><h1>Anyone</h1></li><li class=\"countdown-cell split-cell small-text\" ng-class=\"{'icon-text' : childTask.completed}\" ng-click=completeTask(childTask)><div ng-if=!childTask.completed><h1>{{getDaysFrom(timelineTask.date)}}</h1></div><div ng-if=!childTask.completed><h1>{{timelineTask.date | amDifference : null : 'days' }} Days</h1></div><span class=check-mark-circle ng-if=childTask.completed><i class=\"fa fa-check\" aria-hidden=true></i></span><h1 ng-if=childTask.completed>Complete</h1></li></ul></li></ul></li></ul></div></div><div class=timeline-info ng-class=\"{'show-side-info' : toggledTask}\"><header><h1>{{newTask ? 'New Task' : 'Task Info'}}</h1></header><header class=sub-header><h1>Task Description</h1></header><div class=main-info ng-class=\"{'changed-toggled' : changedToggled}\"><ul class=main-info-list><li class=sub-info-container><h1 class=list-title>Details</h1><ul class=sub-info-list><!-- Task Title --><li class=sub-list-item ng-click=\"enableField('title')\"><label for=taskTitle ng-class=\"{'edited-label' : editedFields['title'], 'error-label' : errorField == 'title'}\">Name :</label><textarea msd-elastic ng-model=toggledTask.title id=taskTitle placeholder=\"Task title\" class=task-textarea ng-disabled=\"!enabledFields['title']\" ng-class=\"{'edited-field' : editedFields['title']}\" ng-change=\"editField('title')\"></textarea></li><!-- Task Notes --><li class=sub-list-item ng-click=\"enableField('notes')\"><label for=taskNotes ng-class=\"{'edited-label' : editedFields['notes']}\">Notes :</label><div id=taskNotes placeholder=\"Task notes\" class=task-textarea ng-bind-html=toggledTask.notes rows=4></div></li><li class=sub-list-item ng-show=\"!newTask && toggledTask.siteShortName\"><label for=taskTitle>Operation :</label><h2 class=sub-list-label>{{toggledTask.siteShortName}}</h2></li><li class=sub-list-item ng-show=\"!newTask && toggledTask.tunnelShortName\"><label for=taskTitle>Tunnel :</label><h2 class=sub-list-label>{{toggledTask.tunnelShortName}}</h2></li><li class=sub-list-item ng-show=\"!newTask && toggledTask.occurrenceDate && !toggledTask.checkTemplateObj\" ng-click=\"enableField('occurrenceDate')\"><label ng-class=\"{'edited-label' : editedFields['occurrenceDate'], 'error-label' : errorField == 'occurrenceDate'}\">Task Date :</label><h2 class=sub-list-label ng-if=\"!enabledFields['occurrenceDate']\">{{toggledTask.occurrenceDate._i | date : 'MMMM d'}}</h2><div class=task-date-container ng-if=\"enabledFields['occurrenceDate']\"><md-datepicker ng-model=toggledTask.occurrenceDate._d md-placeholder=\"Enter date\" ng-change=\"editField('occurrenceDate')\"></md-datepicker></div></li><!-- Task Type --><li class=sub-list-item ng-click=\"enableField('taskType')\"><label for=taskType ng-class=\"{'edited-label' : editedFields['taskType'], 'error-label' : errorField == 'taskType'}\">Type of Task :</label><div id=taskType class=task-multiple-list><ul class=wide-items><li class=single-select><select name=singleSelect ng-model=toggledTask.taskType class=task-select ng-change=\"editField('taskType')\" ng-options=\"option.value as option.name for option in taskTypes\" ng-class=\"{'edited-input' : editedFields['taskType']}\" ng-if=\"enabledFields['taskType']\"></select><h1 ng-if=\"!enabledFields['taskType']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.taskType}}</h1></li></ul></div></li><!-- Task Priority --><li class=sub-list-item ng-click=\"enableField('priority')\"><label for=taskPriority ng-class=\"{'edited-label' : editedFields['priority']}\">Priority :</label><ul id=taskPriority class=task-priority-list><li ng-repeat=\"priority in taskPriorities\" class=priority-{{priority.class}} ng-show=\"toggledTask.priority == priority.class || enabledFields['priority']\" ng-class=\"{'selected-priority' : enabledFields['priority'] && toggledTask.priority == priority.class , 'disabled-field' : currentUser.role != 'admin'}\" ng-click=changePriority(priority)><span class=top-color></span> <span class=bottom-color></span><h2 class=priority-label>{{priority.label}}</h2></li><li ng-if=toggledTask.subPriority ng-style=\"toggledTask.subPriority ? {'background-color' : toggledTask.subPriority.color} : ''\" class=sub-priority><!--<h2 class=\"priority-label\">--><!--{{toggledTask.subPriority.sortLevel}}--><!--</h2>--></li></ul></li><!-- Task Time Estimate --><li class=sub-list-item ng-click=\"enableField('timeEstimate')\"><label for=taskTimeEstimate ng-class=\"{'edited-label' : editedFields['timeEstimateAmount'] || editedFields['timeEstimateUnit'] || editedFields['timeEstimatePer']}\">Time Estimate :</label><div id=taskTimeEstimate class=task-multiple-list><ul ng-class=\"{'wide-items' : enabledFields['timeEstimate']}\"><li><h2 ng-class=\"{'edited-label' : editedFields['timeEstimateAmount'], 'disabled-field' : currentUser.role != 'admin'}\">Value :</h2><input type=number ng-model=toggledTask.timeEstimate.amount placeholder=Amount class=task-input ng-class=\"{'edited-input' : editedFields['timeEstimateAmount']}\" ng-disabled=\"!enabledFields['timeEstimate']\" ng-change=\"editField('timeEstimateAmount')\" ng-if=\"enabledFields['timeEstimate']\"><h1 ng-if=\"!enabledFields['timeEstimate']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.timeEstimate.amount}}</h1></li><li><h2 ng-class=\"{'edited-label' : editedFields['timeEstimateUnit'], 'disabled-field' : currentUser.role != 'admin'}\">Unit :</h2><select name=singleSelect ng-model=toggledTask.timeEstimate.unit class=task-select ng-change=\"editField('timeEstimateUnit')\" ng-options=\"option.value as option.name for option in timeEstimateUnitOpts\" ng-class=\"{'edited-input' : editedFields['timeEstimateUnit']}\" ng-if=\"enabledFields['timeEstimate']\"></select><h1 ng-if=\"!enabledFields['timeEstimate']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.timeEstimate.unit}}</h1></li><li><h2 ng-class=\"{'edited-label' : editedFields['timeEstimatePer'], 'disabled-field' : currentUser.role != 'admin'}\">Per :</h2><select name=singleSelect ng-model=toggledTask.timeEstimate.per class=task-select ng-change=\"editField('timeEstimatePer')\" ng-options=\"option.value as option.name for option in timeEstimatePerOpts\" ng-class=\"{'edited-input' : editedFields['timeEstimatePer']}\" ng-if=\"enabledFields['timeEstimate']\"></select><h1 ng-if=\"!enabledFields['timeEstimate']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.timeEstimate.per}}</h1></li></ul></div></li><!-- Task Occurrence --><li class=sub-list-item ng-click=\"enableField('occurrenceObj')\" ng-if=\"toggledTask.isMaster && !newTask && !toggledTask.checkTemplateObj\"><label for=taskTimeEstimate ng-class=\"{'edited-label' : editedFields['occurrenceObjType'] || editedFields['occurrenceObjWeek'] || editedFields['occurrenceObjDay'],\n              'error-label' : errorField == 'occurrenceObjType' || errorField == 'occurrenceObjWeek' || errorField == 'occurrenceObjDay'}\">Task Occurrence :</label><div id=occurrenceObj class=task-multiple-list><ul ng-class=\"{'wide-items' : enabledFields['occurrenceObj']}\"><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjType'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjType'}\">Period :</h2><select name=singleSelect ng-model=toggledTask.occurrenceObj.type class=task-select ng-change=\"editField('occurrenceObjType')\" ng-options=\"option.value as option.name for option in occurrenceObjTypeOpts\" ng-class=\"{'edited-input' : editedFields['occurrenceObjType']}\" ng-if=\"enabledFields['occurrenceObj']\"></select><h1 ng-if=\"!enabledFields['occurrenceObj']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.occurrenceObj.type}}</h1></li><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjWeek'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjWeek'}\">Week :</h2><h1 ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.taskWeek}}</h1></li><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjDay'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjDay'}\">Day :</h2><h1 ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">{{toggledTask.taskDay}}</h1></li></ul></div></li></ul><!--<h2>--><!--<span>Name :</span>{{toggledTask.title}}--><!--</h2>--></li></ul><div class=task-complete-button></div><ul class=task-action-buttons><li class=action-button id=redButton ng-if=\"currentUser.role == 'admin' && !newTask\" ng-click=deleteTask(toggledTask)><h1>Delete</h1></li><li class=action-button ng-if=\"currentUser.role == 'admin'\" ng-click=editTask(toggledTask)><h1>Edit</h1></li><div class=action-button id=aguaButton ng-click=toggleTask()><h1>{{newTask ? 'Cancel' : 'Close'}}</h1></div></ul></div><div class=main-info-footer ng-class=\"{'show-footer' : editedFields, 'saved-footer' : showSaved}\"><h1 class=footer-title ng-if=\"!showSaved && !newTask\">You have edited {{editedFieldsCount}} {{editedFieldsCount != 1 ? 'fields' : 'field'}}. Please save or revert your changes.</h1><h1 class=footer-title ng-if=\"!showSaved && newTask\">Your task has not been saved yet.</h1><ul class=footer-buttons ng-if=\"!savingEdits && !showSaved\"><li ng-click=saveTask() class=green-button><h1>Save</h1></li><li ng-click=revertEdits() ng-if=!newTask><h1>Revert</h1></li><li ng-click=toggleTask() ng-if=newTask><h1>Cancel</h1></li></ul><div class=saving-edits ng-if=\"savingEdits && !showSaved\"><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><div class=saving-error ng-if=\"saveEditsError && !savingEdits && !showSaved\"><h1>{{saveEditsError}}</h1></div><div class=saved-edits ng-if=showSaved><div class=check-mark-circle><i class=\"fa fa-check\" aria-hidden=true></i></div><h1 ng-if=showSaved>{{showSaved.length ? showSaved : \"Successfully saved.\"}}</h1></div></div></div><div ui-view></div></section>"),
a.put("app/timeline/timeline.task.html","<section class=timeline-task-view ng-class=\"{'dim-out' : dimOut, 'hide-view' : hideTaskView}\"><header class=custom-header><ul class=header-buttons><li ng-click=goBack() class=gray-button><i class=\"icon icon-left_close\"></i></li><li ng-click=saveTask() class=green-button ng-class=\"{'disable-button' : !editedFields}\"><h1>Save</h1></li><li ng-click=revertTask() class=orange-button ng-class=\"{'disable-button' : !editedFields}\"><h1>Revert</h1></li><li ng-click=deleteTask() class=red-button ng-if=!newTask><h1>Delete</h1></li><li ng-click=copyTemplate() class=darkBlue-button ng-if=\"copyToTemplates.length > 0\"><h1>Copy</h1></li></ul><div class=saving-task ng-if=\"savingEdits && !showSaved\"><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><div class=saved-task ng-if=\"!savingEdits && showSaved\"><span class=saved-checkmark><i class=\"fa fa-check\" aria-hidden=true></i></span><h1>{{showSaved}}</h1></div><div class=header-text><h1>{{taskCopy.title ? 'Editing -' : 'Creating new task'}} <span>{{taskCopy.title}}</span></h1><h2 ng-class=\"{'show-error' : saveEditsError}\" class=animated>{{saveEditsError ? saveEditsError : ' '}}</h2></div></header><div class=custom-info-form><ul class=\"sub-info-list double-item\"><!-- Task Title --><li class=\"sub-list-item extra-long\" ng-click=\"enableField('title')\"><label for=taskTitle ng-class=\"{'edited-label' : editedFields['title'], 'error-label' : errorField == 'title'}\">Task Name :</label><textarea msd-elastic ng-model=selectedTask.title id=taskTitle placeholder=\"Task title\" class=task-textarea ng-disabled=\"!enabledFields['title']\" ng-class=\"{'edited-field' : editedFields['title']}\" ng-change=\"editField('title')\"></textarea></li><!-- Task Type --><li class=\"sub-list-item small-input\" ng-click=\"enableField('taskType')\"><label for=taskType ng-class=\"{'edited-label' : editedFields['taskType'], 'error-label' : errorField == 'taskType'}\">Type of Task :</label><div id=taskType class=task-multiple-list><ul><li class=single-select><select name=singleSelect ng-model=selectedTask.taskType class=task-select ng-change=\"editField('taskType')\" ng-options=\"option.value as option.name for option in taskTypes\" ng-class=\"{'edited-input' : editedFields['taskType']}\"></select><!--<h1 ng-if=\"!enabledFields['taskType']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">--><!--{{selectedTask.taskType}}--><!--</h1>--></li></ul></div></li></ul><!-- Occurrence Date --><ul class=sub-info-list ng-class=\"{'disabled-list' : disableOccurrenceDate()}\"><li class=\"sub-list-item full-row\"><label ng-class=\"{'edited-label' : editedFields['occurrenceDate'], 'error-label' : errorField == 'occurrenceDate'}\">Task Date :</label><div class=task-date-container><md-datepicker ng-model=selectedTask.occurrenceDate._d md-placeholder=\"Enter date\" ng-change=\"editField('occurrenceDate')\" ng-disabled=disableOccurrenceDate()></md-datepicker></div></li></ul><!-- Parent Task --><ul class=sub-info-list ng-if=\"selectedTask.taskType === 'child-task'\"><li class=\"sub-list-item long-row\"><label ng-class=\"{'edited-label' : editedFields['parentTask'], 'error-label' : errorField == 'parentTask'}\">Parent Task : <span class=remove-item ng-if=\"selectedTask.parentTask && selectedTask.taskType == 'child-task'\" ng-click=removeParentTask()>Remove Parent</span></label><div class=parent-task-select ng-if=\"selectedTask.taskType === 'child-task' && !selectedTask.parentTask\" ng-click=selectParent()><h1>Select Parent Task</h1></div><div class=parent-task-info ng-if=\"selectedTask.taskType == 'child-task' && selectedTask.parentTask\"><div class=pt-info-container><div class=upper-info><h1><span>Task :</span> {{parentTaskInfo.title}}</h1></div><ul class=lower-info><li><h1><span>Task Type :</span> {{parentTaskInfo.taskTypeFormatted}}</h1></li><li ng-if=!parentTaskInfo.isMaster><h1><span>Date : </span>{{parentTaskInfo.occurrenceDate._i | date : 'MMMM d'}}</h1></li><li ng-if=\"parentTaskInfo.isMaster && parentTaskInfo.taskWeek\"><h1>W{{parentTaskInfo.taskWeek}}-{{parentTaskInfo.inPeriod.charAt(0)}} (d-{{parentTaskInfo.taskDay}})</h1></li><li ng-if=parentTaskInfo.isMaster><h1>Master Task</h1></li><li ng-if=!parentTaskInfo.isMaster><h1><span>Operation : </span>{{parentTaskInfo.siteShortName}}</h1></li><li ng-if=!parentTaskInfo.isMaster><h1><span>Tunnel : </span>{{parentTaskInfo.tunnelShortName}}</h1></li></ul></div></div></li></ul><ul class=sub-info-list ng-if=\"selectedTask.childTasks && selectedTask.childTasks.length\"><li class=\"sub-list-item long-row\"><label ng-class=\"{'edited-label' : editedFields['childTasks'], 'error-label' : errorField == 'childTasks'}\">Child Tasks : <span class=text-muted>You can rearrange these by drag & drop</span></label><ul sv-root sv-part=selectedTask.childTasks class=child-task-list sv-on-sort=\"editField('childTasks')\"><li ng-repeat=\"childTask in selectedTask.childTasks\" sv-element class=child-task-item><ul class=child-task-info-list><li><h1>{{childTask.childIndex}}</h1></li><li class=child-task-title><span class=\"task-priority priority-{{childTask.priority}}\" ng-style=\"childTask.subPriority ? {'background-color' : childTask.subPriority.color} : ''\"></span><h2>{{childTask.title}}</h2></li><li ng-click=deleteChildTask(childTask)><i class=\"fa fa-trash\"></i></li></ul></li></ul></li></ul><!-- Task Priority --><ul class=\"sub-info-list double-item\"><!-- Task Priority --><li class=sub-list-item ng-click=\"enableField('priority')\"><label for=taskPriority ng-class=\"{'edited-label' : editedFields['priority']}\">Priority :</label><ul id=taskPriority class=task-priority-list><li ng-repeat=\"priority in taskPriorities\" class=priority-{{priority.class}} ng-show=\"selectedTask.priority == priority.class || enabledFields['priority']\" ng-class=\"{'selected-priority' : enabledFields['priority'] && selectedTask.priority == priority.class , 'disabled-field' : currentUser.role != 'admin'}\" ng-click=changePriority(priority)><span class=top-color></span> <span class=bottom-color></span><h2 class=priority-label>{{priority.label}}</h2></li></ul></li><!-- Sub Priority --><li class=sub-list-item><label for=subPriority ng-class=\"{'edited-label' : editedFields['subPriority']}\" ng-click=\"enableField('subPriority')\">Sub Priority :</label><ul id=subPriority class=task-sub-priority-list><li ng-repeat=\"subPriority in subPriorities track by $index\" ng-show=\"selectedTask.subPriority.color == subPriority.color || enabledFields['subPriority']\" ng-class=\"{'selected-priority' : enabledFields['subPriority'] && selectedTask.subPriority.color == subPriority.color}\" ng-click=selectSubPriority(subPriority)><span ng-style=\"{'background-color' : subPriority.color}\"></span></li></ul><div class=sub-priority-labels ng-show=\"enabledFields['subPriority']\"><h1>Higher Priority</h1><h1>Lower Priority</h1></div></li></ul><!-- Task Saving Location --><ul class=\"sub-info-list tri-item-list\"><!-- Save Location --><li class=sub-list-item ng-click=\"enableField('taskLocation')\" ng-if=newTask ng-class=\"{'disabled-item' : selectedTask.taskType != 'tunnel-timeline'}\"><label for=taskLocation ng-class=\"{'edited-label' : editedFields['taskLocation'], 'error-label' : errorField == 'taskLocation'}\">Save Location :</label><div id=taskLocation class=task-multiple-list><ul><li class=single-select><select name=singleSelect ng-model=selectedTask.taskLocation class=task-select ng-change=\"editField('taskLocation')\" ng-options=\"option.value as option.name for option in taskSaveLocations\" ng-class=\"{'edited-input' : editedFields['taskLocation']}\" ng-disabled=\"selectedTask.taskType != 'tunnel-timeline'\"></select></li></ul></div></li><!-- Operation --><li class=sub-list-item ng-click=\"enableField('site')\" ng-class=\"{'disabled-item' : selectedTask.isMaster || selectedTask.taskType === 'child-task'}\"><label for=taskSite ng-class=\"{'edited-label' : editedFields['site'], 'error-label' : errorField == 'site'}\">Operation : <span class=remove-item ng-if=\"selectedTask.site && selectedTask.taskType == 'admin-assigned'\" ng-click=removeSite()>Remove</span></label><div id=taskSite class=task-multiple-list><ul><li class=single-select><select name=singleSelect ng-model=selectedTask.site class=task-select ng-change=\"editField('site')\" ng-disabled=\"(selectedTask.isMaster || selectedTask.taskType === 'child-task')\" ng-options=\"option as option.siteShortName for option in allSites track by option._id\" ng-class=\"{'edited-input' : editedFields['site']}\"></select></li></ul></div></li><!-- Tunnel --><li class=sub-list-item ng-click=\"enableField('room')\" ng-class=\"{'disabled-item' : selectedTask.isMaster || selectedTask.taskType === 'child-task'}\"><label for=taskRoom ng-class=\"{'edited-label' : editedFields['room'], 'error-label' : errorField == 'room'}\">Tunnel : <span class=remove-item ng-if=selectedTask.room ng-click=removeRoom()>Remove</span></label><div id=taskRoom class=task-multiple-list><ul><li class=single-select><select name=singleSelect ng-model=selectedTask.room class=task-select ng-change=\"editField('room')\" ng-disabled=\"selectedTask.isMaster || selectedTask.taskType === 'child-task'\" ng-options=\"option as option.tunnelShortName for option in siteRooms track by option._id\" ng-class=\"{'edited-input' : editedFields['room']}\"></select></li></ul></div></li><!--&lt;!&ndash; Check Location &ndash;&gt;--><!--<li class=\"sub-list-item\" ng-click=\"enableField('checkLocation')\" ng-class=\"{'disabled-item' : !selectedTask.isMaster || selectedTask.taskType != 'tunnel-timeline'}\">--><!--<label for=\"checkLocation\" ng-class=\"{'edited-label' : editedFields['checkLocation'], 'error-label' : errorField == 'checkLocation'}\">--><!--Perform Check Here :--><!--</label>--><!--<div id=\"checkLocation\" class=\"task-multiple-list\">--><!--<ul>--><!--<li class=\"single-select\">--><!--<select name=\"singleSelect\" ng-model=\"selectedTask.masterCheckLocation\" class=\"task-select\" ng-change=\"editField('checkLocation')\" ng-disabled=\"!selectedTask.isMaster || selectedTask.taskType != 'tunnel-timeline'\"--><!--ng-options=\"option.value as option.name for option in masterCheckLocations\" ng-class=\"{'edited-input' : editedFields['checkLocation']}\">--><!--</select>--><!--</li>--><!--</ul>--><!--</div>--><!--</li>--><h4 class=list-label ng-class=\"{'show-label' :selectedTask.taskType === 'child-task'}\">* Info pulled from this task's parent.</h4></ul><!-- Timeline Template --><ul class=sub-info-list ng-if=\"showTemplateCopy || showTemplateSelect\"><li class=sub-list-item ng-if=\"showTemplateSelect && selectedTask.isMaster\"><label for=taskTLTemplate ng-class=\"{'edited-label' : editedFields['taskTLTemplate'], 'error-label' : errorField === 'taskTLTemplate'}\">Timeline Templates</label><ul class=\"custom-multi-select task-template-list\" id=taskTLTemplate><li ng-click=selectTemplate(template) ng-repeat=\"template in allTLTemplates\" ng-class=\"{'selected-template' : isSelectedTemplate(template)}\"><div class=inner-select ng-style=\"isSelectedTemplate(template) ? {'background-color' : template.timelineMainColor} : {'background-color' : template.timelineSubColor}\"><h1>{{template.timelineName}}</h1></div><span ng-if=isSelectedTemplate(template)><i class=\"fa fa-star\"></i></span></li></ul></li><li class=sub-list-item ng-if=\"showTemplateCopy && selectedTask.isMaster\"><label for=taskTLTemplateCopy ng-class=\"{'edited-label' : editedFields['taskTLTemplateCopy'], 'error-label' : errorField === 'taskTLTemplateCopy'}\">Copy to Timeline Templates</label><ul class=\"custom-multi-select task-template-list\" id=taskTLTemplateCopy><li ng-click=toggleTemplate(template) ng-repeat=\"template in allTLTemplates\" ng-class=\"{'selected-template' : isToggledTemplate(template)}\"><div class=inner-select ng-style=\"isToggledTemplate(template) ? {'background-color' : template.timelineMainColor} : {'background-color' : template.timelineSubColor}\"><h1>{{template.timelineName}}</h1></div><span ng-if=isToggledTemplate(template)><i class=\"fa fa-star\"></i></span></li></ul></li></ul><!-- Task Notes --><ul class=\"sub-info-list container\"><li class=\"task-col-section col-xs-12 col-sm-7\" ng-click=\"enableField('notes')\" ng-class=\"{'edited-notes' : editedFields['notes']}\"><label for=taskNotes ng-class=\"{'edited-label' : editedFields['notes']}\">Notes :</label><div class=task-notes-editor-container><text-angular-toolbar name=top-toolbar class=col-xs-5></text-angular-toolbar><ul class=text-editor-size><li ng-class=\"{'selected-size' : selectedSize == 'small'}\" ng-click=\"changeEditorSize('small')\"><i class=\"fa fa-mobile\" aria-hidden=true></i><h1>Small</h1></li><li ng-class=\"{'selected-size' : selectedSize == 'medium'}\" ng-click=\"changeEditorSize('medium')\"><i class=\"fa fa-mobile\" aria-hidden=true></i><h1>Medium</h1></li><li ng-class=\"{'selected-size' : selectedSize == 'large'}\" ng-click=\"changeEditorSize('large')\"><i class=\"fa fa-mobile\" aria-hidden=true></i><h1>Large</h1></li></ul><div text-angular ng-model=selectedTask.notes id=taskNotes ng-blur=checkNotesChanged() ng-focus=saveOldNotes() ta-target-toolbars=top-toolbar class=task-notes-editor ta-disabled=\"!enabledFields['notes']\" class=col-xs-7 ng-style=editorStyle></div><!--<text-angular-toolbar name=\"bottom-toolbar\"></text-angular-toolbar>--><!--<textarea msd-elastic ng-model=\"selectedTask.notes\" id=\"taskNotes\" placeholder=\"Task notes\" class=\"task-textarea\"--><!--ng-disabled=\"!enabledFields['notes']\" ng-class=\"{'edited-field' : editedFields['notes']}\"--><!--ng-change=\"editField('notes')\" rows=\"2\"></textarea>--></div></li><li class=\"task-col-section col-xs-12 col-sm-5\" ng-click=\"enableField('images')\" ng-class=\"{'edited-notes' : editedFields['images']}\"><label for=taskImages ng-class=\"{'edited-label' : editedFields['images']}\">Images :</label><ul class=task-images-container id=taskImages><li class=task-image-placeholder ng-click=addImage()><i class=\"fa fa-camera\"></i><h1>Add Image</h1></li><li class=task-image ng-repeat=\"image in selectedTask.images\" ng-mouseenter=\"showImageOpts = true\" ng-mouseleave=\"showImageOpts = false;\"><img ng-src={{image}}> <span class=image-cover ng-class=\"{'show-cover' : showImageOpts}\"></span><ul class=image-opts ng-class=\"{'show-opts' : showImageOpts}\"><li ng-click=removeImage(image)><i class=\"fa fa-trash\"></i></li><li ngclipboard data-clipboard-text={{image}} ngclipboard-success=copiedText(e,image)><i class=\"fa fa-link\" ng-if=\"copied != image\"></i><h2 ng-if=\"copied == image\">Copied!</h2></li></ul></li></ul><!--<textarea msd-elastic ng-model=\"selectedTask.notes\" id=\"taskNotes\" placeholder=\"Task notes\" class=\"task-textarea\"--><!--ng-disabled=\"!enabledFields['notes']\" ng-class=\"{'edited-field' : editedFields['notes']}\"--><!--ng-change=\"editField('notes')\" rows=\"2\"></textarea>--></li></ul><!-- X Check --><ul class=sub-info-list ng-class=\"{'disabled-list' : selectedTask.taskType != 'x-check'}\"><li class=sub-list-item><label for=taskRepeat ng-class=\"{'edited-label' : editedFields['taskRepeat-preset'] || editedFields['taskRepeat-custom'], 'error-label' : errorField == 'taskRepeat'}\">Repeat Options :</label><div id=taskRepeat class=task-multiple-list><ul class=wide-items><li><h2 ng-class=\"{'edited-label' : editedFields['taskRepeat-preset']}\">Repeats :</h2><select name=singleSelect ng-model=selectedTask.taskRepeatPreset class=task-select ng-change=\"editField('taskRepeat-preset')\" ng-disabled=\"selectedTask.taskType != 'x-check'\" ng-options=\"option.value as option.name for option in taskRepeatOpts\" ng-class=\"{'edited-input' : editedFields['taskRepeat-preset']}\"></select></li><li class=list-break><h4>Or</h4></li><li><h2 ng-class=\"{'edited-label' : editedFields['taskRepeat-custom']}\">Custom Length:</h2><input type=number ng-model=selectedTask.taskRepeatCustom placeholder=\"Every X Days\" class=task-input ng-disabled=\"selectedTask.taskType != 'x-check'\" ng-class=\"{'edited-input' : editedFields['taskRepeat-custom']}\" ng-change=\"editField('taskRepeat-custom')\"></li><li class=list-break><h4>Or</h4></li><li class=taskRepeat-days><h2 ng-class=\"{'edited-label' : editedFields['taskRepeat-days']}\">Specific Days:</h2><div class=day-container><div ng-repeat=\"day in days\" ng-class=\"{'repeat-day' : (selectedTask.taskType == 'x-check' && isRepeat(day))}\" class=task-day ng-click=\"(selectedTask.taskType != 'x-check') || toggleDay(day)\"><h1>{{day.label}}</h1></div></div></li></ul></div></li><h4 class=list-label ng-class=\"{'show-label' :selectedTask.taskType != 'x-check'}\">*This task needs to be an \"X Check\" task to enable these options.</h4></ul><!-- Time Estimte --><ul class=sub-info-list><!--<li class=\"sub-list-item\" ng-show=\"!newTask && selectedTask.occurrenceDate\" ng-click=\"enableField('occurrenceDate')\">--><!--<label ng-class=\"{'edited-label' : editedFields['occurrenceDate'], 'error-label' : errorField == 'occurrenceDate'}\">--><!--Task Date :--><!--</label>--><!--<h2 class=\"sub-list-label\" ng-if=\"!enabledFields['occurrenceDate']\">--><!--{{selectedTask.occurrenceDate._i | date : 'EEEE, MMMM d'}}--><!--</h2>--><!--<div class=\"task-date-container\" ng-if=\"enabledFields['occurrenceDate']\">--><!--<md-datepicker ng-model=\"selectedTask.occurrenceDate._d\" md-placeholder=\"Enter date\" ng-change=\"editField('occurrenceDate')\"></md-datepicker>--><!--</div>--><!--</li>--><!-- Task Time Estimate --><li class=sub-list-item ng-click=\"enableField('timeEstimate')\"><label for=taskTimeEstimate ng-class=\"{'edited-label' : editedFields['timeEstimateAmount'] || editedFields['timeEstimateUnit'] || editedFields['timeEstimatePer']}\">Time Estimate :</label><div id=taskTimeEstimate class=task-multiple-list><ul class=wide-items><li><h2 ng-class=\"{'edited-label' : editedFields['timeEstimateAmount'], 'disabled-field' : currentUser.role != 'admin'}\">Value :</h2><input type=number ng-model=selectedTask.timeEstimate.amount placeholder=Amount class=task-input ng-class=\"{'edited-input' : editedFields['timeEstimateAmount']}\" ng-disabled=\"!enabledFields['timeEstimate']\" ng-change=\"editField('timeEstimateAmount')\"></li><li><h2 ng-class=\"{'edited-label' : editedFields['timeEstimateUnit'], 'disabled-field' : currentUser.role != 'admin'}\">Unit :</h2><select name=singleSelect ng-model=selectedTask.timeEstimate.unit class=task-select ng-change=\"editField('timeEstimateUnit')\" ng-options=\"option.value as option.name for option in timeEstimateUnitOpts\" ng-class=\"{'edited-input' : editedFields['timeEstimateUnit']}\"></select></li><li><h2 ng-class=\"{'edited-label' : editedFields['timeEstimatePer'], 'disabled-field' : currentUser.role != 'admin'}\">Per :</h2><select name=singleSelect ng-model=selectedTask.timeEstimate.per class=task-select ng-change=\"editField('timeEstimatePer')\" ng-options=\"option.value as option.name for option in timeEstimatePerOpts\" ng-class=\"{'edited-input' : editedFields['timeEstimatePer']}\"></select></li></ul></div></li><!-- Task Occurrence --><!--<li class=\"sub-list-item\" ng-click=\"enableField('occurrenceObj')\" ng-if=\"selectedTask.isMaster && !newTask\">--><!--<label for=\"taskTimeEstimate\" ng-class=\"{'edited-label' : editedFields['occurrenceObjType'] || editedFields['occurrenceObjWeek'] || editedFields['occurrenceObjDay'],--><!--'error-label' : errorField == 'occurrenceObjType' || errorField == 'occurrenceObjWeek' || errorField == 'occurrenceObjDay'}\">--><!--Task Occurrence :--><!--</label>--><!--<div id=\"occurrenceObj\" class=\"task-multiple-list\">--><!--<ul ng-class=\"{'wide-items' : enabledFields['occurrenceObj']}\">--><!--<li>--><!--<h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjType'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjType'}\">--><!--Period :--><!--</h2>--><!--<select name=\"singleSelect\" ng-model=\"selectedTask.occurrenceObj.type\" class=\"task-select\" ng-change=\"editField('occurrenceObjType')\"--><!--ng-options=\"option.value as option.name for option in occurrenceObjTypeOpts\" ng-class=\"{'edited-input' : editedFields['occurrenceObjType']}\"--><!--ng-if=\"enabledFields['occurrenceObj']\">--><!--</select>--><!--<h1 ng-if=\"!enabledFields['occurrenceObj']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">--><!--{{selectedTask.occurrenceObj.type}}--><!--</h1>--><!--</li>--><!--<li>--><!--<h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjWeek'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjWeek'}\">--><!--Week :--><!--</h2>--><!--<select name=\"singleSelect\" ng-model=\"selectedTask.occurrenceInfo.selectedTime.week\" class=\"task-select\" ng-change=\"editField('occurrenceObjWeek')\"--><!--ng-options=\"option.value as option.name for option in selectedTask.occurrenceInfo.stageWeeks\" ng-class=\"{'edited-input' : editedFields['occurrenceObjWeek']}\"--><!--ng-if=\"enabledFields['occurrenceObj']\">--><!--</select>--><!--<h1 ng-if=\"!enabledFields['occurrenceObj']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">--><!--{{selectedTask.occurrenceInfo.selectedTime.week}}--><!--</h1>--><!--</li>--><!--<li>--><!--<h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjDay'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjDay'}\" >--><!--Day :--><!--</h2>--><!--<select name=\"singleSelect\" ng-model=\"selectedTask.occurrenceInfo.selectedTime.day\" class=\"task-select\" ng-change=\"editField('occurrenceObjDay')\"--><!--ng-options=\"option.value as option.name for option in selectedTask.occurrenceInfo.stageDays\"  ng-class=\"{'edited-input' : editedFields['occurrenceObjDay']}\"--><!--ng-if=\"enabledFields['occurrenceObj']\">--><!--</select>--><!--<h1 ng-if=\"!enabledFields['occurrenceObj']\" ng-class=\"{'disabled-field' : currentUser.role != 'admin'}\">--><!--{{selectedTask.occurrenceInfo.selectedTime.day}}--><!--</h1>--><!--</li>--><!--</ul>--><!--</div>--><!--</li>--></ul><!-- Occurrence Info --><ul class=sub-info-list ng-show=\"selectedTask.isMaster && (selectedTask.taskType != 'daily-check' && selectedTask.taskType != 'x-check' && selectedTask.taskType !== 'child-task')\"><!-- Task Type --><li class=sub-list-item ng-click=\"enableField('occurrenceObj')\"><label for=taskTimeEstimate ng-class=\"{'edited-label' : editedFields['occurrenceObj'], 'error-label' : errorField == 'occurrenceObj'}\">Master Occurrence :</label><div class=task-multiple-list><ul class=wide-items><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjType'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjType'}\">Period :</h2><select name=singleSelect ng-model=selectedTask.occurrenceObj.type class=task-select ng-change=\"editField('occurrenceObjType')\" ng-options=\"option.value as option.name for option in occurrenceObjTypeOpts\" ng-class=\"{'edited-input' : editedFields['occurrenceObjType']}\"></select></li><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjWeek'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjWeek'}\">Week :</h2><input type=number ng-model=selectedTask.occurrenceInfo.selectedTime.week placeholder=Week class=task-input ng-class=\"{'edited-input' : editedFields['occurrenceObjWeek']}\" ng-change=\"editField('occurrenceObjWeek')\"><!--<select name=\"singleSelect\" ng-model=\"selectedTask.occurrenceInfo.selectedTime.week\" class=\"task-select\" ng-change=\"editField('occurrenceObjWeek')\"--><!--ng-options=\"option.value as option.name for option in selectedTask.occurrenceInfo.stageWeeks\" ng-class=\"{'edited-input' : editedFields['occurrenceObjWeek']}\">--><!--</select>--></li><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjDay'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjDay'}\">Day :</h2><select name=singleSelect ng-model=selectedTask.occurrenceInfo.selectedTime.day class=task-select ng-change=\"editField('occurrenceObjDay')\" ng-options=\"option.value as option.name for option in selectedTask.occurrenceInfo.stageDays\" ng-class=\"{'edited-input' : editedFields['occurrenceObjDay']}\"></select></li></ul></div></li><!--<li class=\"sub-list-item\" ng-click=\"enableField('occurrenceDate')\" ng-if=\"selectedTask.taskLocation == 'tunnel' || selectedTask.taskLocation == 'operation'\">--><!--<div class=\"task-date-container\">--><!--<md-datepicker ng-model=\"selectedTask.occurrenceDate\" md-placeholder=\"Enter date\" ng-change=\"editField('occurrenceDate')\"></md-datepicker>--><!--</div>--><!--</li>--></ul><!-- Occurrence Info --><ul class=sub-info-list ng-show=\"!selectedTask.isMaster && (selectedTask.taskType != 'daily-check' && selectedTask.taskType != 'x-check' && selectedTask.taskType !== 'child-task')\"><!-- Task Type --><li class=sub-list-item ng-click=\"enableField('occurrenceObj')\"><label for=taskTimeEstimate ng-class=\"{'edited-label' : editedFields['occurrenceObj'], 'error-label' : errorField == 'occurrenceObj'}\">Occurrence Info :</label><div class=task-multiple-list><ul class=wide-items><li><h2 ng-class=\"{'edited-label' : editedFields['occurrenceObjType'], 'disabled-field' : currentUser.role != 'admin', 'error-label' : errorField == 'occurrenceObjType'}\">Period :</h2><select name=singleSelect ng-model=selectedTask.occurrenceObj.type class=task-select ng-change=\"editField('occurrenceObjType')\" ng-options=\"option.value as option.name for option in occurrenceObjTypeOpts\" ng-class=\"{'edited-input' : editedFields['occurrenceObjType']}\"></select></li><li><h2 class=disabled-field>Week :</h2><input type=number ng-model=selectedTask.occurrenceInfo.selectedTime.week placeholder=Week class=task-input ng-disabled=true ng-class=\"{'edited-input' : editedFields['occurrenceObjWeek']}\" ng-change=\"editField('occurrenceObjWeek')\"><!--<select name=\"singleSelect\" ng-model=\"selectedTask.occurrenceInfo.selectedTime.week\" class=\"task-select\" ng-change=\"editField('occurrenceObjWeek')\"--><!--ng-options=\"option.value as option.name for option in selectedTask.occurrenceInfo.stageWeeks\" ng-class=\"{'edited-input' : editedFields['occurrenceObjWeek']}\">--><!--</select>--></li><li><h2 class=disabled-field>Day :</h2><select name=singleSelect ng-model=selectedTask.occurrenceInfo.selectedTime.day class=task-select ng-change=\"editField('occurrenceObjDay')\" ng-disabled=true ng-options=\"option.value as option.name for option in selectedTask.occurrenceInfo.stageDays\" ng-class=\"{'edited-input' : editedFields['occurrenceObjDay']}\"></select></li></ul></div></li><h4 class=list-label ng-class=\"{'show-label' :selectedTask.taskType != 'x-check'}\">*You can only change the label. To change the day/week, please update the 'Task Date'</h4><!--<li class=\"sub-list-item\" ng-click=\"enableField('occurrenceDate')\" ng-if=\"selectedTask.taskLocation == 'tunnel' || selectedTask.taskLocation == 'operation'\">--><!--<div class=\"task-date-container\">--><!--<md-datepicker ng-model=\"selectedTask.occurrenceDate\" md-placeholder=\"Enter date\" ng-change=\"editField('occurrenceDate')\"></md-datepicker>--><!--</div>--><!--</li>--></ul></div></section>"),a.put("app/whiteboard/whiteboard.html",'<section class=timeline-task-view ng-class="{\'dim-out\' : dimOut}"><header class=custom-header><ul class=header-buttons><li ng-click=saveWhiteboardObj() class=green-button ng-class="{\'disable-button\' : !editedFields}"><h1>Save</h1></li><li ng-click=revertEdits() class=orange-button ng-class="{\'disable-button\' : !editedFields}"><h1>Revert</h1></li></ul><div class=saving-task ng-if="savingEdits && !showSaved"><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><div class=saved-task ng-if="!savingEdits && showSaved"><span class=saved-checkmark><i class="fa fa-check" aria-hidden=true></i></span><h1>{{showSaved}}</h1></div><div class=header-text><h1>Online Whiteboard</h1><h2 ng-class="{\'show-error\' : saveEditsError}" class=animated>{{saveEditsError ? saveEditsError : \' \'}}</h2></div></header><div class=timeline-task-info><!-- Task Notes --><ul class="sub-info-list container"><li class="task-col-section col-xs-12 col-sm-8" ng-click="enableField(\'text\')" ng-class="{\'edited-text\' : editedFields[\'text\']}"><label for=textEditor ng-class="{\'edited-label\' : editedFields[\'text\']}">Text Field :</label><div class=text-editor-container><text-angular-toolbar name=top-toolbar class=col-xs-5></text-angular-toolbar><div text-angular ng-model=whiteboardObj.text id=textEditor ng-blur=checkTextChanged() ng-focus=saveOldText() ta-target-toolbars=top-toolbar class="text-editor whiteboard-editor" class=col-xs-7></div><!--<text-angular-toolbar name="bottom-toolbar"></text-angular-toolbar>--><!--<textarea msd-elastic ng-model="selectedTask.notes" id="taskNotes" placeholder="Task notes" class="task-textarea"--><!--ng-disabled="!enabledFields[\'notes\']" ng-class="{\'edited-field\' : editedFields[\'notes\']}"--><!--ng-change="editField(\'notes\')" rows="2"></textarea>--></div></li><li class="task-col-section col-xs-12 col-sm-4" ng-click="enableField(\'images\')" ng-class="{\'edited-notes\' : editedFields[\'images\']}"><label for=WBImages ng-class="{\'edited-label\' : editedFields[\'images\']}">Images :</label><ul class=task-images-container id=WBImages><li class=task-image-placeholder ng-click=addImage()><i class="fa fa-camera"></i><h1>Add Image</h1></li><li class=task-image ng-repeat="image in whiteboardObj.images" ng-mouseenter="showImageOpts = true" ng-mouseleave="showImageOpts = false;"><img ng-src={{image}}> <span class=image-cover ng-class="{\'show-cover\' : showImageOpts}"></span><ul class=image-opts ng-class="{\'show-opts\' : showImageOpts}"><li ng-click=removeImage(image)><i class="fa fa-trash"></i></li><li ngclipboard data-clipboard-text={{image}} ngclipboard-success=copiedText(e,image)><i class="fa fa-link" ng-if="copied != image"></i><h2 ng-if="copied == image">Copied!</h2></li></ul></li></ul><!--<textarea msd-elastic ng-model="selectedTask.notes" id="taskNotes" placeholder="Task notes" class="task-textarea"--><!--ng-disabled="!enabledFields[\'notes\']" ng-class="{\'edited-field\' : editedFields[\'notes\']}"--><!--ng-change="editField(\'notes\')" rows="2"></textarea>--></li></ul></div></section>'),a.put("components/RoomTimelineBuilder/timelineBuilder.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body timeline-task-modal-body"><h4 class="nav-header text-muted">This will walk you through the steps to build a new task timeline for a specified room.</h4><div class="row collapse-row" ng-class="{\'selected-row-short\' : selectedOpts.step == 1, \'flash-step\' : flashStep == 1}"><h4 class=nav-header ng-click="selectOption(\'step\', 1)">Step 1 : Select which operation <span class=modal-label ng-if=selectedSite>: {{selectedSite.name}}</span></h4><div class="col-xs-3 custom-modal-button" ng-repeat="site in sites" ng-class="{\'selected-button\' : selectedOpts.site == site}" ng-click="selectOption(\'site\', site)"><h1>{{site.name}}</h1></div></div><div class="row collapse-row" ng-class="{\'selected-row-tall\' : selectedOpts.step == 2, \'flash-step\' : flashStep == 2}"><h4 class=nav-header ng-click="selectOption(\'step\', 2)">Step 2 : Select which room <span class=modal-label ng-if=selectedRoom>: {{selectedRoom.name}}</span></h4><div class="col-xs-3 custom-modal-button" ng-repeat="room in selectedSite.rooms" ng-class="{\'selected-button\' : selectedOpts.room == room}" ng-click="selectOption(\'room\', room)"><h1>{{room.name}}</h1></div></div><div class="row collapse-row" ng-class="{\'selected-row-short\' : selectedOpts.step == 3, \'flash-step\' : flashStep == 3}"><h4 class=nav-header ng-click="selectOption(\'step\', 3)">Step 3 : Select base timeline <span class=modal-label ng-if=selectedOpts.baseTimeline>: {{selectedOpts.baseTimeline}}</span></h4><div class="col-xs-3 custom-modal-button" ng-repeat="base in baseTimelines" ng-class="{\'selected-button\' : selectedOpts.baseTimeline == base}" ng-click="selectOption(\'baseTimeline\', base)"><h1>{{base}}</h1></div></div><div class="row collapse-row" ng-class="{\'selected-row-extra-tall\' : selectedOpts.step == 4, \'flash-step\' : flashStep == 4}"><h4 class=nav-header ng-click="selectOption(\'step\', 4)">Step 4 : Confirm Dates <span class=modal-label ng-if=selectedOpts.confirmedDates>: Confirmed</span></h4><div class=col-sm-5><h5>Start Date</h5><p class=input-group><input class=form-control uib-datepicker-popup={{dateFormat}} popup-placement=bottom ng-model=roomStartDate is-open=datePickers[0] datepicker-options=dateOptions ng-change="changeDate(\'roomStartDate\')" ng-required=true close-text=Close alt-input-formats=altInputFormats popup-placement=top> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="selectDate($event, 0)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label class=date-warning ng-if=startDateWarning>{{startDateWarning}}</label></div><div class=col-sm-5><h5>Flipped Date</h5><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" popup-placement=bottom ng-model=roomFlippedDate is-open=datePickers[1] datepicker-options=dateOptions ng-change="changeDate(\'roomFlippedDate\')" ng-required=true close-text=Close alt-input-formats=altInputFormats> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="selectDate($event, 1)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label class=date-warning ng-if=flippedDateWarning>{{flippedDateWarning}}</label></div><div class=col-sm-5><h5>End Date</h5><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" popup-placement=bottom ng-model=roomEndDate is-open=datePickers[2] datepicker-options=dateOptions ng-change="changeDate(\'roomEndDate\')" ng-required=true close-text=Close alt-input-formats=altInputFormats> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="selectDate($event, 2)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label class=date-warning ng-if=endDateWarning>{{endDateWarning}}</label></div><div class="row col-xs-12"><div class="col-xs-2 custom-modal-button" ng-click="selectOption(\'confirmedDates\', true)"><h1>Confirm Dates</h1></div></div></div><div class="row collapse-row" ng-class="{\'selected-row-tall\' : selectedOpts.step == 5}"><h4 class=nav-header ng-click="selectOption(\'step\', 5)">Step 5 : Save</h4><div class="row col-xs-12" ng-if="!tlDateError && !savedTL"><div class="custom-modal-button col-xs-2" ng-click=saveTimeline()><h1>Save</h1></div></div><div class="row warning-save" ng-if=tlDateError><i class="fa fa-warning"></i><p class=input-group>{{tlDateError}}</p><div class="custom-modal-button col-xs-2" ng-click=ignoreError()><h1>Proceed</h1></div></div><div class=saved-tl ng-show="!loading && savedTL"><h1>{{savedTL.header}}</h1><h2 ng-if=savedTL.taskCount>{{savedTL.taskCount}}</h2><h2 ng-if=savedTL.tbdTasks>{{savedTL.tbdTasks}}</h2><h2 ng-if=savedTL.reoccurringTasks>{{savedTL.reoccurringTasks}}</h2></div></div></div><div class=modal-footer><div class=error-box ng-show=errorMessage><h1>{{errorMessage}}</h1></div><div class=loading-container ng-show=loading><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-default" ng-click=$dismiss()>{{savedTL ? \'Close\' : \'Cancel\'}}</button></div>'),
a.put("components/baseObjAccordion/accordionTemplate.html",'<div class="panel panel-default"><div class=panel-heading><h4 class=panel-title><a href tabindex=0 class=accordion-toggle ng-click=toggleOpen() uib-accordion-transclude=heading><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></a></h4></div><div class="panel-collapse collapse" uib-collapse=!isOpen><div class=panel-body ng-transclude></div></div></div>'),a.put("components/baseObjAccordion/baseObjAccordion.html",'<div class=accordion-container>Name: {{accordionObj.name}}</div><div class=edit-accordion><div ng-click=editObject(accordionObj)><span class="glyphicon glyphicon-pencil"></span></div><div ng-click=deleteObject(accordionObj) ng-if="accordionObj.__t != \'Site\'"><span class="glyphicon glyphicon-trash red-delete"></span></div><div ng-click=viewDashboard(accordionObj) ng-if="accordionObj.__t == \'Site\'"><span class="glyphicon glyphicon-eye-open"></span></div></div><h1>{{childTypePlural}}</h1><uib-accordion close-other=true><uib-accordion-group heading={{child.name}} ng-repeat="child in accordionObj[childTypePlural]" panel-class=panel-success template-url=components/baseObjAccordion/accordionTemplate.html><base-obj-accordion accordion-obj=child edit-object=editObject delete-object=deleteObject></base-obj-accordion></uib-accordion-group></uib-accordion>'),a.put("components/baseObject/baseObject.html",'<div class=base-object-container><nav class=base-object-actions><div ng-click=saveObject()><span class="glyphicon glyphicon-floppy-disk" aria-hidden=true></span><h1>Save</h1></div><div ng-click=closeView()><span class="glyphicon glyphicon-remove" aria-hidden=true></span><h1>Cancel</h1></div></nav><h1>{{selectedAction}} {{modelType}}</h1><div class=base-object-name><input placeholder=Name ng-model=baseObj.name></div><div class=field-container ng-if="modelType == \'room\'"><h1>Details</h1><div class=input-label-group><label for=width>Width</label><input id=width ng-model=baseObj.width></div><div class=input-label-group><label for=length>Length</label><input id=length ng-model=baseObj.length></div><div class=input-label-group><label for=amountOfPlants>Amount of Plants</label><input id=amountOfPlants ng-model=baseObj.amountOfPlants></div><div class=input-label-group><label for=amountOfLights>Amount of Lights</label><input id=amountOfLights ng-model=baseObj.amountOfLights></div><div class=input-label-group><label for=typeOfRoom>Type of Room</label><input id=typeOfRoom ng-model=baseObj.roomType></div><div class=input-label-group><label>Lights ON</label><div uib-timepicker ng-model=baseObj.lightsOn ng-change=changedTime()></div></div><div class=input-label-group><label>Lights OFF</label><div uib-timepicker ng-model=baseObj.lightsOff ng-change=changedTime()></div></div><div class=custom-calendar><h2>Start Date: {{baseObj.startDate | date: \'fullDate\'}}</h2><div style=min-height:290px><uib-datepicker ng-model=baseObj.startDate class="well well-sm" datepicker-options=calOpts></uib-datepicker></div></div><div class=custom-calendar><h2>Expected Harvest Date: {{baseObj.endDate | date: \'fullDate\'}}</h2><div style=min-height:290px><uib-datepicker ng-model=baseObj.endDate class="well well-sm" datepicker-options=calOpts></uib-datepicker></div></div></div><div ng-if="modelType == \'task\'"><task-template task-obj=baseObj></task-template></div><h1>{{modelType == \'task\' ? "Sub-" : \'\'}}{{childTypePlural}}</h1><uib-accordion close-other=true><uib-accordion-group heading={{child.name}} ng-repeat="child in baseObj[childTypePlural]" panel-class=panel-success template-url=components/baseObjAccordion/accordionTemplate.html><base-obj-accordion accordion-obj=child edit-object=editObject delete-object=deleteObject view-dashboard=viewDashboard></base-obj-accordion></uib-accordion-group></uib-accordion><button type=submit class="btn btn-primary" ng-click=createNew()><span class="glyphicon glyphicon-plus" aria-hidden=true></span> New {{childType}}</button><base-object ng-if=showBaseObj model-type={{childType}} selected-action={{selectedAction}} close-view=closeBaseView save-callback=childSaveCallback saved-base-obj=savedBaseObj></base-object></div>'),a.put("components/directives/toggleArrow/toggleArrow.html","<div class=toggle-arrow ng-class=\"{'up-arrow' : toggle}\"><span class=line-a></span> <span class=line-b></span></div>"),a.put("components/footer/footer.html",'<div class=container><p>Angular Fullstack v3.7.6 | <a href=https://twitter.com/tyhenkel>@tyhenkel</a> | <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p></div>'),a.put("components/masterTask/masterTaskModal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body timeline-task-modal-body"><h4 class="nav-header text-muted">Note: For now, ALL master tasks are based on the standard 77 day cycle with 3 weeks of veg and 8 weeks of flower.</h4><form><div class=row><div class="form-group col-xs-10 col-sm-4"><label for=taskTitle>Title</label><input class=form-control id=taskTitle placeholder=Title ng-model=modalTask.title></div><div class="form-group col-xs-10 col-sm-4"><label for=backgroundColor>Background Color</label><input colorpicker=hex id=backgroundColor class=form-control ng-model=modalTask.backgroundColor> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : modalTask.backgroundColor}">Color Preview</span></div><div class="form-group col-xs-10 col-sm-4"><label for=backgroundColor>Warning Color</label><input colorpicker=hex id=warningColor class=form-control ng-model=modalTask.warningColor> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : modalTask.warningColor}">Color Preview</span></div></div><div class="form-group container"><h4 class=nav-header>Time Estimate (for one person)</h4><div class="col-xs-10 col-sm-3"><h5 class=nav-header>Amount</h5><div class=input-group><input type=number class=form-control placeholder="E.g., 2" id=amountInput ng-model=modalTask.timeEstimate.amount><label for=amountInput class="pull-right text-muted">Whole numbers only please.</label></div></div><div class="col-xs-10 col-sm-4"><h5 class=nav-header>Unit</h5><div class="col-xs-6 custom-modal-button" ng-click="modalTask.timeEstimate.unit = \'hour\'" ng-class="{\'selected-button\' : modalTask.timeEstimate.unit == \'hour\'}"><h1>{{modalTask.timeEstimate.amount == 1 ? \'Hour\' : \'Hours\'}}</h1></div><div class="col-xs-6 custom-modal-button" ng-click="modalTask.timeEstimate.unit = \'minute\'" ng-class="{\'selected-button\' : modalTask.timeEstimate.unit == \'minute\'}"><h1>{{modalTask.timeEstimate.amount == 1 ? \'Minute\' : \'Minutes\'}}</h1></div></div><div class="col-xs-6 col-sm-5"><h5 class=nav-header>Per</h5><select name=singleSelect ng-model=modalTask.timeEstimate.per ng-options="item.value as item.name for item in timeEstimateOpts"><!--<option value="">-&#45;&#45;Please select-&#45;&#45;</option>--><!--<option ng-repeat="option in timeEstimateOpts" ng-value="option.value">{{option.name}}</option>--></select></div></div><!--<div class="col-xs-6 custom-modal-button" ng-click="showValue()">--><!--<h1>--><!--Display--><!--</h1>--><!--</div>--><div class="form-group row"><h4 class=nav-header>Notes</h4><textarea class=form-control rows=3 id=taskNotes ng-model=modalTask.notes placeholder="E.g., Make sure this is done with gloves."></textarea></div><div class="form-group row"><h4 class=nav-header>Occurrence</h4><div class="col-xs-3 custom-modal-button" ng-click="(modalTask.occurrenceObj.type = \'veg\'); buildStageWeeks(\'veg\')" ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'veg\'}"><h1>In Veg</h1></div><div class="col-xs-3 custom-modal-button" ng-click="(modalTask.occurrenceObj.type = \'flower\'); buildStageWeeks(\'flower\')" ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'flower\'}"><h1>In Flower</h1></div><!--<div class="col-xs-3 custom-modal-button" ng-click="modalTask.occurrenceObj.type = \'relationship\'"--><!--ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'relationship\'}">--><!--<h1>--><!--In Relation to Other--><!--</h1>--><!--</div>--><!--<div class="col-xs-3 custom-modal-button" ng-click="modalTask.occurrenceObj.type = \'event\'"--><!--ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'event\'}">--><!--<h1>--><!--Event--><!--</h1>--><!--</div>--></div><div class="form-group row" ng-show="modalTask.occurrenceObj.type == \'event\'"><h4 class="nav-header text-muted">Use this to quickly set a task to occur on a specific event.</h4><div class="list-group col-xs-6 col-sm-4"><h5 class=nav-header>Event</h5><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.event = \'start-of-room\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.event == \'start-of-room\'}"><h4 class=list-group-item-heading>Start of Room</h4><p class=list-group-item-text>Day the room starts.</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.event = \'end-of-room\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.event == \'end-of-room\'}"><h4 class=list-group-item-heading>End of Room</h4><p class=list-group-item-text>Day the room ends.</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.event = \'lights-flipped-to-flower\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.event == \'lights-flipped-to-flower\'}"><h4 class=list-group-item-heading>Lights flipped to flower</h4><p class=list-group-item-text>Day the lights are flipped</p></a></div><div class="col-xs-6 col-sm-4"><div class=row><h5 class=nav-header>Value of Unit</h5><div class=input-group><input type=number class=form-control placeholder="E.g., 7" id=valueInput ng-model=modalTask.occurrenceObj.occurrenceDay.value><label for=valueInput class="pull-right text-muted">Whole numbers only please.</label></div></div><div class=row><h5 class=nav-header>Unit</h5><div class="col-xs-6 custom-modal-button" ng-click="occurrenceUnit = \'day\'" ng-class="{\'selected-button\' : occurrenceUnit == \'day\'}"><h1>{{modalTask.occurrenceObj.occurrenceDay.value == 1 ? \'Day\' : \'Days\'}}</h1></div><div class="col-xs-6 custom-modal-button" ng-click="occurrenceUnit = \'week\'" ng-class="{\'selected-button\' : occurrenceUnit == \'week\'}"><h1>{{modalTask.occurrenceObj.occurrenceDay.value == 1 ? \'Week\' : \'Weeks\'}}</h1></div></div><div class=row><h5 class=nav-header>Occurs</h5><div class="col-xs-6 custom-modal-button" ng-click="modalTask.occurrenceObj.relationshipType = \'before\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.relationshipType == \'before\'}"><h1>Before Event</h1></div><div class="col-xs-6 custom-modal-button" ng-click="modalTask.occurrenceObj.relationshipType = \'after\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.relationshipType == \'after\'}"><h1>After Event</h1></div></div></div><div class="clearfix visible-xs"></div><div class="list-group col-xs-10 col-sm-4"><h5 class=nav-header>Type of Unit</h5><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'day\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'day\'}"><h4 class=list-group-item-heading>Hard Type</h4><p class=list-group-item-text>E.g., This will ALWAYS happen {{modalTask.occurrenceObj.occurrenceDay.value ? modalTask.occurrenceObj.occurrenceDay.value : \' x \'}} {{occurrenceUnit ? (modalTask.occurrenceObj.occurrenceDay.value == 1 ? occurrenceUnit : occurrenceUnit + \'s\') : \' units \'}} from event.</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'percent\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'percent\'}"><h4 class=list-group-item-heading>Soft Type</h4><p class=list-group-item-text>Calculates units based on % through cycle length.</p></a></div><div class=col-xs-6 ng-show=!disablePreview><div class="panel panel-default"><div class=panel-heading><h4>Occurrence Preview</h4></div><div class=panel-body><h5 class="nav-header text-muted">This task will occur...</h5><ul class=list-group><li class=list-group-item>{{eventPreviewStandard}}</li><li class=list-group-item>{{eventPreviewShort}}</li><li class=list-group-item>{{eventPreviewLong}}</li></ul><h5 class="nav-header text-muted">Or try it with a custom cycle length!</h5><div class=input-group><input type=number class=form-control placeholder="Custom cycle length in days" ng-model=customCycleLength> <span class=input-group-btn><button class="btn btn-default" type=button ng-click=calculateCustom(modalTask.occurrenceObj)>Calculate</button></span></div><h5 class="nav-header text-muted" ng-show=eventPreviewCustom.length>This task will occur...</h5><ul class=list-group ng-show=eventPreviewCustom.length><li class=list-group-item>{{eventPreviewCustom}}</li></ul></div></div></div></div><div class="form-group container-fluid" ng-show="modalTask.occurrenceObj.type == \'relationship\'"><div class="col-xs-6 col-sm-4 col-sm-offset-1"><h4>Veg Tasks</h4><div class=list-group><a href=# class=list-group-item ng-repeat="task in vegTasks"><h5 class=list-group-item-heading>{{task.title}}</h5><p class=list-group-item-text>{{task.notes}}</p></a></div></div><div class="col-xs-6 col-sm-4 col-sm-offset-2"><h4>Flower Tasks</h4><div class=list-group><a href=# class=list-group-item ng-repeat="task in flowerTasks"><h5 class=list-group-item-heading>{{task.title}}</h5><p class=list-group-item-text>{{task.notes}}</p></a></div></div></div><div class="form-group container-fluid" ng-show="modalTask.occurrenceObj.type == \'veg\' || modalTask.occurrenceObj.type == \'flower\'"><h4 class="nav-header text-muted">Note: This is based off of a standard 77 day cycle.</h4><h5 class=nav-header>Week</h5><ul class=horizontal-row><li ng-repeat="week in stageWeeks" ng-click="selectTime(week, \'week\')" ng-class="{\'selected-child\' : selectedTime.week == week}"><h1>W{{week}}-{{modalTask.occurrenceObj.type}}</h1></li></ul><h5 class=nav-header ng-show=selectedTime.week>Day in Week</h5><ul class=horizontal-row ng-show=selectedTime.week><li ng-repeat="day in stageDays" ng-click="selectTime(day, \'day\')" ng-class="{\'selected-child\' : selectedTime.day == day}"><h1>d-{{day}}</h1></li></ul><div class="list-group col-xs-10 col-sm-4" ng-show="selectedTime.week && selectedTime.day"><h5 class=nav-header>Type of Unit</h5><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'day\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'day\'}"><h4 class=list-group-item-heading>Hard Type</h4><p class=list-group-item-text>E.g., This will ALWAYS happen in W{{selectedTime.week}}-{{modalTask.occurrenceObj.type}} (d-{{selectedTime.day}}).</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'percent\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'percent\'}"><h4 class=list-group-item-heading>Soft Type</h4><p class=list-group-item-text>Calculates units based on % through cycle length.</p></a></div><div class=col-xs-6 ng-show=!disablePreview><div class="panel panel-default"><div class=panel-heading><h4>Occurrence Preview</h4></div><div class=panel-body><h5 class="nav-header text-muted">This task will occur...</h5><ul class=list-group><li class=list-group-item>{{periodPreviewStandard}}</li><li class=list-group-item>{{periodPreviewShort}}</li><li class=list-group-item>{{periodPreviewLong}}</li></ul><h5 class="nav-header text-muted">Or try it with a custom cycle length!</h5><div class=input-group><input type=number class=form-control placeholder="Custom cycle length in days" ng-model=customCycleLength> <span class=input-group-btn><button class="btn btn-default" type=button ng-click=calculateOccurrenceInCustomCycle()>Calculate</button></span></div><h5 class="nav-header text-muted" ng-show=periodPreviewCustom.length>This task will occur...</h5><ul class=list-group ng-show=periodPreviewCustom.length><li class=list-group-item>{{periodPreviewCustom}}</li></ul></div></div></div></div><!--<label ng-if="modalTask.stage.length">--><!--{{modalTask.stage}} week--><!--</label>--><!--<ul ng-if="modalTask.stage.length" class="stage-week">--><!--<li ng-repeat="week in getWeeks() track by $index">--><!--<h1>--><!--Week {{$index+1}}--><!--</h1>--><!--<h2>--><!--Days:--><!--</h2>--><!--<ul>--><!--<li ng-repeat="day in [1,2,3,4,5,6,7]" ng-click="setTime($parent.$index+1,$index+1)"--><!--ng-class="{\'selected-day\' : isActiveDay($parent.$index+1, $index+1)}">--><!--{{day}}--><!--</li>--><!--</ul>--><!--</li>--><!--</ul>--></form></div><div class=modal-footer><div class=error-box ng-show=showError><h1>{{errorMessage}}</h1></div><div class=loading-container ng-show=loading><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-light-green" ng-click=resetModalTask() ng-if=updateTask>Reset</button> <button class="btn btn-success" ng-click=save()>Save</button> <button class="btn btn-default" ng-click=cancel()>Cancel</button></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div><div ng-if=modal.showInput class=row><div class="form-group col-xs-7"><label for=modalInput>{{modal.inputTitle}}</label><textarea class=form-control rows=3 id=modalInput ng-model=modal.editInfo placeholder="Additional details"></textarea></div></div><div ng-if=modal.showDatePicker class=row><div class=col-xs-6><h5>Completed On</h5><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" ng-model=modal.editInfo is-open=modal.datePickers[0] datepicker-options=modal.dateOptions ng-required=true close-text=Close> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="modal.selectDate($event, 0)"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></div></div><div class=modal-footer><button ng-class=modal.buttons[0].classes ng-click="modal.buttons[0].click($event, modal.editInfo)" ng-bind=modal.buttons[0].text class=btn></button> <button ng-if=modal.showUpdateButton ng-class=modal.updateButton.classes ng-click="modal.updateButton.click($event, modal.editInfo)" ng-bind=modal.updateButton.text class=btn></button> <button ng-class=modal.buttons[1].classes ng-click="modal.buttons[1].click($event, modal.editInfo)" ng-bind=modal.buttons[1].text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<section class=side-navbar ng-if="nav.state.current.name !== \'download\'"><nav class=nav-menu><div class=nav-menu-item ng-repeat="navItem in nav.menuItems" title={{navItem.title}} ng-class="{\'active\' : nav.isCurrent(navItem)}" ui-sref={{navItem.state}} ng-click=nav.changeState(navItem.state)><i class={{navItem.icon}}></i></div><ul class=nav-footer><li ng-click=nav.toggleCollapse() ng-if="nav.state.current.name == \'timeline\'"><i class=fa ng-class="{\'fa-chevron-right\' : !nav.showCollapse, \'fa-chevron-left\' : nav.showCollapse}"></i><h1>{{showCollapse ? \'Hide Menu\' : \'Show Menu\'}}</h1></li><li ng-click=nav.logout() ng-if=nav.isLoggedIn() class=bottom-nav><i class="fa fa-user-times"></i><h1>Logout</h1></li><li ng-click=nav.login() ng-if=!nav.isLoggedIn() class=bottom-nav><i class="fa fa-user"></i><h1>Login</h1></li></ul><!--<div class="nav-footer" ng-click="nav.logOut()" ng-if="nav.isLoggedIn">--><!--<i class="fa"></i>--><!--<h1>--><!--{{showCollapse ? \'Hide Menu\' : \'Show Menu\'}}--><!--</h1>--><!--</div>--><!--<div class="nav-footer" ng-click="nav.toggleCollapse()" ng-if="nav.state.current.name == \'timeline\'">--><!--<i class="fa" ng-class="{\'fa-chevron-right\' : !nav.showCollapse, \'fa-chevron-left\' : nav.showCollapse}"></i>--><!--<h1>--><!--{{showCollapse ? \'Hide Menu\' : \'Show Menu\'}}--><!--</h1>--><!--</div>--></nav></section>'),a.put("components/parentTask/parentTask.html",'<div class="modal-header custom-modal-header"><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4><ul class=custom-modal-action><li ng-class="{\'selected-action\' : selectedAction == \'masterTasks\'}" ng-click="selectAction(\'masterTasks\')"><h1>Master Tasks</h1><span class=selected-underline></span></li><li ng-class="{\'selected-action\' : selectedAction == \'general\'}" ng-click="selectAction(\'general\')"><h1>General Tasks</h1><span class=selected-underline></span></li></ul><!--<i class="toggle-tasks fa" ng-class="showToggler ? \'fa-chevron-up\' : \'fa-chevron-down\'" ng-click="toggle()"></i>--></div><div class=parent-task-toggler ng-class="{\'hide-toggler\' : !showToggler}"><task-toggler return-selection="toggleTasks({rooms : rooms, sites : sites, taskTypes : taskTypes})"></task-toggler></div><div class="modal-body parent-task-modal"><h3 ng-if=availableTasks.length class=available-count>{{taskCount}} tasks</h3><ul class=available-tasks ng-if=availableTasks.length><li class=parent-task-dates ng-repeat="taskDate in availableTasks"><ul class=parent-date><li ng-repeat="task in taskDate.tasks" class=parent-task-container ng-click=selectParent(task)><div class=selected-task><i class="fa fa-check-circle" ng-if="selectedParent === task"></i></div><div class=task-info><div class=upper-info><h1><span>Task :</span> {{task.title}}</h1></div><ul class=lower-info><li><h1><span>Task Type :</span> {{task.taskTypeFormatted}}</h1></li><li ng-if=!task.isMaster><h1><span>Date : </span>{{task.occurrenceDate._i | date : \'MMMM d\'}}</h1></li><li ng-if="task.isMaster && task.taskWeek"><h1>W{{task.taskWeek}}-{{task.inPeriod.charAt(0)}} (d-{{task.taskDay}})</h1></li><li ng-if=task.isMaster><h1>Master Task</h1></li><li ng-if=!task.isMaster><h1><span>Operation : </span>{{task.siteShortName}}</h1></li><li ng-if=!task.isMaster><h1><span>Tunnel : </span>{{task.tunnelShortName}}</h1></li></ul></div></li></ul></li></ul><div class=no-available-tasks ng-if="!availableTasks || !availableTasks.length"><h1>No Results</h1></div></div><div class="modal-footer custom-modal-footer"><div class=error-box ng-show="errorMessage && !uploadedImage"><h1>{{errorMessage}}</h1></div><div class=loading-container ng-show=loading><h1>Loading</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-success" ng-click=saveParent() ng-class="{\'dim-button\' : !selectedParent}">Save</button> <button class="btn btn-default" ng-click=cancel()>Cancel</button></div>'),a.put("components/reoccurringTest/reoccurringTest.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body timeline-task-modal-body"><h4 class="nav-header text-muted">This will walk you through reoccurring tests being built through a span of time.</h4><div class="row collapse-row" ng-class="{\'selected-row-short\' : selectedOpts.step == 1, \'flash-step\' : flashStep == 1}"><h4 class=nav-header ng-click="selectOption(\'step\', 1)">Step 1 : Select which operation <span class=modal-label ng-if=selectedSite>: {{selectedSite.name}}</span></h4><div class="col-xs-3 custom-modal-button" ng-repeat="site in sites" ng-class="{\'selected-button\' : selectedOpts.site == site}" ng-click="selectOption(\'site\', site)"><h1>{{site.name}}</h1></div></div><div class="row collapse-row" ng-class="{\'selected-row-extra-tall\' : selectedOpts.step == 2 , \'flash-step\' : flashStep == 2}"><h4 class=nav-header ng-click="selectOption(\'step\', 2)">Step 2 : Choose Dates <span class=modal-label ng-if=selectedOpts.confirmedDates>: Confirmed</span></h4><div class=col-sm-5><h5>Start Date</h5><p class=input-group><input class=form-control uib-datepicker-popup={{dateFormat}} popup-placement=bottom ng-model=testStartDate is-open=datePickers[0] datepicker-options=dateOptions ng-change="changeDate(\'testStartDate\')" ng-required=true close-text=Close alt-input-formats=altInputFormats popup-placement=top> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="selectDate($event, 0)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label class=date-warning ng-if=startDateWarning>{{startDateWarning}}</label></div><div class=col-sm-5><h5>End Date</h5><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" popup-placement=bottom ng-model=testEndDate is-open=datePickers[2] datepicker-options=dateOptions ng-change="changeDate(\'testEndDate\')" ng-required=true close-text=Close alt-input-formats=altInputFormats> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="selectDate($event, 2)"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label class=date-warning ng-if=endDateWarning>{{endDateWarning}}</label></div><div class="row col-xs-12"><div class="col-xs-2 custom-modal-button" ng-click="selectOption(\'confirmedDates\', true)"><h1>Confirm Dates</h1></div></div></div><div class="row collapse-row" ng-class="{\'selected-row-tall\' : selectedOpts.step == 3}"><h4 class=nav-header ng-click="selectOption(\'step\', 3)">Step 3 : Generate Tasks</h4><div class="row col-xs-12" ng-if=!generated><div class="custom-modal-button col-xs-2" ng-click=generateTasks()><h1>Generate</h1></div></div><div class=saved-tl ng-show="!loading && generated"><h1>{{generated.header}}</h1><h2 ng-if=generated.taskCount>{{generated.taskCount}}</h2><h2 ng-if=generated.tbdTasks>{{generated.tbdTasks}}</h2><h2 ng-if=generated.reoccurringTasks>{{generated.reoccurringTasks}}</h2></div></div></div><div class=modal-footer><div class=error-box ng-show=errorMessage><h1>{{errorMessage}}</h1></div><div class=loading-container ng-show=loading><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-default" ng-click=$dismiss()>{{generated ? \'Close\' : \'Cancel\'}}</button></div>'),a.put("components/task-toggler/task-toggler.html",'<ul class=toggle-list><li class=toggle-item><label>Operation</label><ul class=toggle-inner-list><li ng-click=toggleAllSites() class=toggle-all-button ng-class="{\'all-toggled\' : allSitesToggled}"><h1>All</h1></li><li ng-repeat="site in sites" ng-click=toggleSite(site) ng-style="{\n            \'background-color\' : (isSiteToggled(site)) ? site.mainColor : site.subColor\n          }" ng-class="{\'selected-item\' : isSiteToggled(site)}"><h1>{{site.siteShortName}}</h1></li></ul></li><li class=toggle-item><label>Tunnel</label><ul class=toggle-inner-list><li ng-click=toggleAllRooms() class=toggle-all-button ng-class="{\'all-toggled\' : allRoomsToggled && availableRooms.length}"><h1>All</h1></li><li ng-repeat="room in availableRooms" ng-click=toggleRoom(room) ng-style="{\n            \'background-color\' : (isRoomToggled(room)) ? room.siteMainColor : room.siteSubColor\n          }" ng-class="{\'selected-item\' : isRoomToggled(room)}"><h1>{{room.tunnelShortName}}</h1></li></ul></li><li class=toggle-item><label>Task Type</label><ul class=toggle-inner-list><li ng-repeat="taskType in taskTypes" ng-click=toggleType(taskType) ng-style="{\n            \'background-color\' : (isTypeToggled(taskType)) ? taskType.color : \'#B3B3B3\'\n          }" ng-class="{\'selected-item\' : isTypeToggled(taskType)}" class=task-types><h1>{{taskType.name}}</h1></li></ul></li></ul>'),a.put("components/taskGenerationModal/taskGenerationErrorModal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body custom-modal-body"><div class=task-generation-info><h1 class=generation-title>({{genErrors.length}}) {{genErrors.length > 1 ? \'errors\' : \'error\'}} occurred when attempting to generate tasks from the template : <span class=error-text>{{selectedTaskTemplate}}</span></h1></div><ul class=task-generation-error-list><li ng-repeat="genError in genErrors" class=task-generation-error ng-click=goToTask(genError)><ul class=gen-error-list><li class=gen-error-task><h1><span>{{$index+1}}. </span>{{genError.genError.taskTitle}}</h1></li><li class=gen-error-title><label>Error</label><h1>{{genError.genError.genTitle}}</h1></li><li class=gen-error-solution><label>Solution</label><h1>{{genError.genError.solution}}</h1></li></ul></li></ul></div><div class=modal-footer-with-buttons><ul class="footer-buttons full-width"><li ng-click=$dismiss() class=orange-button><h1>Close</h1></li></ul></div>'),a.put("components/taskGenerationModal/taskGenerationModal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body custom-modal-body"><div class=task-generation-info><h1 class=generation-title>Location Details</h1><ul class=task-generation-list><li class=task-location><div ng-style="room.siteMainColor ? {\'background-color\' : room.siteMainColor} : {\'background-color\' : \'#B3B3B3\'}"><h1>{{room.siteShortName}}</h1></div><div ng-style="room.siteSubColor ? {\'background-color\' : room.siteSubColor} : {\'background-color\' : \'#E5E6E7\'}"><h1>{{room.tunnelShortName}}</h1></div></li><li class=task-location-details><ul><li><h2>Date to generate from:</h2><h1>{{fromDate | amDateFormat:\'ddd MMM Do, YYYY\'}}</h1></li><li><h2>Date of last generation:</h2><h1 ng-if=lastGeneratedTasksDate>{{lastGeneratedTasksDate | amDateFormat:\'ddd MMM Do, YYYY\'}}</h1><h1 ng-if=!lastGeneratedTasksDate class=gray-text>NA</h1></li><li><h2>Date in relation to room:</h2><h1>{{fromDateTypeString}}</h1></li></ul></li></ul></div><div class=task-generation-templates><h1 class=generation-title>Timeline Templates</h1><ul class=generation-timeline-templates-list ng-if=!loadingTimelines><li ng-repeat="timeline in allTimelines" ng-class="{\'selected-timeline\' : isTimelineSelected(timeline)}" ng-click=selectTimeline(timeline)><div class=inner-select ng-style="isTimelineSelected(timeline) ? {\'background-color\' : timeline.timelineMainColor} : {\'background-color\' : timeline.timelineSubColor}"><h1>{{timeline.timelineName}}</h1><span class=tl-task-count><h2>({{timeline.taskCount}})</h2><h3>Tasks</h3></span></div><span ng-if=isTimelineSelected(timeline)><i class="fa fa-star"></i></span></li></ul><span class=loading-timelines ng-if=loadingTimelines><h1>Loading Timelines</h1><md-progress-circular md-mode=indeterminate class="md-accent saving-spinner" md-diameter=24px></md-progress-circular></span></div></div><div class=modal-footer-with-buttons><div class=prompt-container><div class="prompt-box error-prompt" ng-if="errorMessage && !generating"><h1>{{errorMessage}}</h1></div><div class=prompt-box ng-if=generating><h1>Generating...</h1><md-progress-circular md-mode=indeterminate class="md-accent saving-spinner" md-diameter=24px></md-progress-circular></div><div class="prompt-box flash-message" ng-if=showSaved><h1>Successfully generated {{generatedTaskCount ? generatedTaskCount : 0}} tasks.</h1><i class="fa fa-check success-check"></i></div></div><ul class=footer-buttons><li ng-click=doGenerate() class="green-button normal-text" ng-class="{\'disable-button\' : !selectedTLTemplate}"><h1>Generate</h1></li><li ng-click=$dismiss() class=orange-button><h1 ng-if=!generated>Cancel</h1><h1 ng-if=generated>Close</h1></li></ul></div>'),
a.put("components/taskImage/taskImage.html",'<div class="modal-header custom-modal-header"><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4><ul class=custom-modal-action><li ng-class="{\'selected-action\' : selectedAction == \'upload\'}" ng-click="selectAction(\'upload\')"><h1>Upload</h1><span class=selected-underline></span></li><li ng-class="{\'selected-action\' : selectedAction == \'library\'}" ng-click="selectAction(\'library\')"><h1>Library</h1><span class=selected-underline></span></li></ul><div class=media-search ng-show="selectedAction == \'library\'"><label>Filter Images</label><div class=input-search><input ng-model=searchMedia.mediaName> <span ng-class="{\'show-delete\' : searchMedia.mediaName || searchMedia.mediaName.length >= 0}" ng-click=clearSearch()><i class="fa fa-ban" aria-hidden=true></i></span></div></div></div><div class="modal-body task-image-modal"><div ng-if="selectedAction == \'upload\'" class=image-upload-container><div class="button upload-button" ngf-accept="\'image/*\'" ngf-max-size=20MB ngf-min-height=100 ngf-select="uploadFile($file, $invalidFiles)" ngf-resize="{quality : .8}" ngf-multiple=false accept=image/* ngf-fix-orientation=true><h1>Choose photo to upload</h1></div><div class="col-xs-6 col-sm-4 image-name" ng-show=imageFile><label for=fileName>Media Name</label><input ng-model=imageFile.mediaName id=fileName placeholder="File Name"></div><img ngf-src=imageFile></div><ul ng-if="selectedAction == \'library\'" class=image-library-container><li ng-repeat="image in uploads | filter:searchMedia" class="image-upload col-xs-4 col-sm-4" ng-class="{\'selected-image\' : selectedImage == image}"><header class=image-upload-header><span ng-class="{\'show-selected\' : selectedImage == image}"><h1>Selected</h1></span><i class="fa fa-trash" ng-click=deleteImage(image)></i></header><img ng-src={{image.mediaUrl}} ng-click=selectImage(image)><ul class=image-footer ng-class="{\'updated-image\' : image.updated}"><li class=image-name-input><label for=imageName>Media Name</label><input ng-model=image.mediaName id=imageName placeholder="" ng-change=changeImageName(image) ng-focus=saveImageName(image)></li><li class=image-name-buttons><ul><li ng-click=saveImageName(image)><i class=fa aria-hidden=true ng-class="{\'fa-spinner fa-spin\' : image.saving, \' fa-floppy-o\' : !image.saving }"></i></li><li ng-click=revertImageName(image)><i class="fa fa-undo" aria-hidden=true></i></li></ul></li></ul></li></ul></div><div class="modal-footer custom-modal-footer"><div class=error-box ng-show="errorMessage && !uploadedImage"><h1>{{errorMessage}}</h1></div><div class=success-container ng-show="!errorMessage && uploadedImage"><h1>Uploaded Image</h1></div><div class=loading-container ng-show=loading><h1>Uploading...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-light-green" ng-click=resetModalTask() ng-if=updateTask>Reset</button> <button class="btn btn-success" ng-click=saveImage() ng-class="{\'dim-button\' : !uploadedImage && !selectedImage}">Save</button> <button class="btn btn-default" ng-click=cancel()>Cancel</button></div>'),a.put("components/taskTemplate/taskTemplate.html",'<div class=custom-radio-container><h1>Task Schedule</h1><div ng-class="{\'selected-radio\' : taskObj.schedule == \'daily\'}" ng-click="selectSchedule(\'daily\')"><h2>Daily</h2></div><div ng-class="{\'selected-radio\' : taskObj.schedule == \'weekly\'}" ng-click="selectSchedule(\'weekly\')"><h2>Weekly</h2></div><div ng-class="{\'selected-radio\' : taskObj.schedule == \'date\'}" ng-click="selectSchedule(\'date\')"><h2>Date</h2></div></div><div class=custom-calendar ng-if="taskObj.schedule == \'date\'"><h2>Scheduled Date: {{taskObj.scheduleDate | date: \'fullDate\'}}</h2><div style=min-height:290px><uib-datepicker ng-model=taskObj.scheduleDate class="well well-sm" datepicker-options=calOpts></uib-datepicker></div></div><div class=custom-radio-container><h1>Task Type</h1><div ng-class="{\'selected-radio\' : taskObj.taskType == \'checkBox\'}" ng-click="selectType(\'checkBox\')"><h2>Checkbox</h2></div><div ng-class="{\'selected-radio\' : taskObj.taskType == \'radio\'}" ng-click="selectType(\'radio\')"><h2>Radio</h2></div><div ng-class="{\'selected-radio\' : taskObj.taskType == \'confirm\'}" ng-click="selectType(\'confirm\')"><h2>Confirmation</h2></div><div ng-class="{\'selected-radio\' : taskObj.taskType == \'progress\'}" ng-click="selectType(\'progress\')"><h2>Progress</h2></div></div><div class=custom-container ng-if="taskObj.taskType == \'checkBox\' || taskObj.taskType == \'radio\'"><label>{{taskObj.taskType}} Items:</label><div ng-repeat="item in taskObj.taskItems" class=edit-checkbox-item><input ng-model=item.text placeholder="Item\'s Text"><div ng-click=removeItem($index)><span class="glyphicon glyphicon-trash"></span></div></div><div class=add-checkbox ng-click=addItem()><span class="glyphicon glyphicon-plus"></span><h1>Add Item</h1></div></div><div class="custom-container progress-container" ng-if="taskObj.taskType == \'progress\'"><label>Progress Steps:</label><div ng-repeat="item in taskObj.taskItems" class=progress-step><h2>Step : {{$index+1}}</h2><div class=step-container><input ng-model=item.title placeholder="Step\'s Title"> <input ng-model=item.value placeholder="Step\'s Value"></div><div class=step-container><textarea ng-model=item.details placeholder="Item\'s Details" cols=3></textarea></div><div class=step-container><input ng-model=item.pictureUrl placeholder="Picture Url"></div></div><div class=add-checkbox ng-click=addItem()><span class="glyphicon glyphicon-plus"></span><h1>Add Step</h1></div></div><div class=custom-input-container ng-if="taskObj.taskType == \'confirm\'"><label>Confirmation Text:</label><input ng-model=taskObj.confirmText></div><div class=custom-input-container><label>Estimated Time to Completion(in minutes):</label><input ng-model=taskObj.estimatedTTC></div><div class=custom-checkbox-item><h2>Requires Verification?</h2><input type=checkbox ng-model=taskObj.requiresVerification name=requiresVerification></div><div class=custom-input-container><label>Additional Notes:</label><textarea rows=3 ng-model=taskObj.additionalNotes></textarea></div>'),a.put("components/timeline-nav/timeline-nav.html",'<header class=aside-header><h1>Timelines</h1><h2>View needed tasks. Mark complete as you go.</h2></header><view-toggler return-selection="getTasksForSelections({rooms : rooms, sites : sites})"></view-toggler><div class="aside-menu margin-top-menu"><header ng-click="toggleList(\'TLFilters\')"><h1>Category Filters:</h1><h2>Toggle to display timelines.</h2><i class="fa fa-chevron-down" ng-if=!showTLFilters></i> <i class="fa fa-chevron-up" ng-if=showTLFilters></i></header><ul class=sort-menu ng-class="{\'collapsed-list\' : !showTLFilters}" }><li ng-click=toggleAllSorts() ng-class="{\'all-sorts\' : allSorts}" class=all-sort-item><h1>All</h1></li><!--ng-style="isSortToggled(sort) ? {\'background-color\' : sort.selectedColor} : {\'background-color\' : sort.offColor} "--><li ng-repeat="sort in sortTaskOpts" ng-click=toggleSort(sort) ng-class="{\'selected-sort\' : isSortToggled(sort)}" ng-style="isSortToggled(sort) ? {\'background-color\' : sort.selectedColor} : {\'background-color\' : sort.offColor}"><h1>{{sort.label}}</h1></li></ul></div><div class="aside-menu margin-top-menu"><header ng-click="toggleList(\'TLTools\')"><h1>Timeline Tools</h1><h2>Create/edit tasks and more.</h2><i class="fa fa-chevron-down" ng-if=!showTLTools></i> <i class="fa fa-chevron-up" ng-if=showTLTools></i></header><ul class=sort-menu ng-class="{\'collapsed-list\' : !showTLTools}" }><li ng-repeat="tool in adminTools" ng-click=tool.function(tool) ng-class="{\'current-tool\' : isToolActive(tool)}" ng-show=showTool(tool)><h1>{{tool.text}}</h1></li></ul></div><div class="aside-menu margin-top-menu"><header ng-click="toggleList(\'TLTimelines\')"><h1>Timeline Templates</h1><h2>Templates for Task Generation</h2><i class="fa fa-chevron-down" ng-if=!showTLTimelines></i> <i class="fa fa-chevron-up" ng-if=showTLTimelines></i></header><ul class=sort-menu ng-class="{\'collapsed-list\' : !showTLTimelines}" }><li ng-click=newTLTemplate()><h1>New Template</h1><!--<i class="sort-menu-icon fa fa-plus"></i>--></li><!--ng-style="isSortToggled(sort) ? {\'background-color\' : sort.selectedColor} : {\'background-color\' : sort.offColor} "--><li ng-repeat="timeline in allTimelines" ng-class="{\'current-timeline\' : isTimelineActive(timeline)}" class=sort-item-with-action ng-style="isTimelineActive(timeline) ? {\'background-color\' : timeline.timelineMainColor} : {\'background-color\' : timeline.timelineSubColor} "><div class=sort-label-container ng-click=toggleTimeline(timeline)><h1>{{timeline.timelineName}}</h1></div><div class=sort-action-button ng-click=editTimeline(timeline)><i class="fa fa-pencil"></i></div></li></ul></div><div class="aside-menu margin-top-menu"><header ng-click="toggleList(\'TLDates\')"><h1>Date Filters</h1><h2>Return only tasks within this range.</h2><i class="fa fa-chevron-down" ng-if=!showTLDateFilter></i> <i class="fa fa-chevron-up" ng-if=showTLDateFilter></i></header><ul class="sort-menu date-range-list" ng-class="{\'collapsed-list\' : !showTLDateFilter}" }><li ng-click="changeDate(\'fromDate\')" ng-class="{\'green-text\' : showFromDatePicker}"><h2>From:</h2><md-datepicker ng-model=TLFromDate._d md-is-open=showFromDatePicker md-hide-icons=all md-max-date=TLToDate._d md-date-locale=formatDate ng-change="updateDate(\'fromDate\')" ng-blur="hideCalendar(\'fromDate\')"></md-datepicker><!--<h1>--><!--{{TLFromDate | amDateFormat:\'ddd MMM Do, YYYY\'}}--><!--</h1>--> <i class="fa fa-calendar-o"></i></li><li ng-click="changeDate(\'toDate\')" ng-class="{\'green-text\' : showToDatePicker}"><h2>To:</h2><md-datepicker ng-model=TLToDate._d md-is-open=showToDatePicker md-hide-icons=all md-min-date=TLFromDate._d md-date-locale=formatDate ng-change="updateDate(\'toDate\')" ng-blur="hideCalendar(\'toDate\')"></md-datepicker><i class="fa fa-calendar-o"></i></li></ul></div>'),a.put("components/timelineModal/timelineModal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title ng-click=clickHeader()></h4></div><div class="modal-body custom-modal-body"><div class=custom-info-form><ul class="sub-info-list double-item no-border"><!-- Task Title --><li class=sub-list-item><label for=timelineName ng-class="{\'edited-label\' : editedFields[\'timelineName\'], \'error-label\' : errorField == \'timelineName\'}">Template Name :</label><textarea msd-elastic ng-model=timelineObj.timelineName id=timelineName placeholder="Example Task Template" class=task-textarea ng-class="{\'edited-field\' : editedFields[\'timelineName\']}" ng-change="editField(\'timelineName\')"></textarea></li></ul><ul class="sub-info-list double-item no-border"><li class="sub-list-item small-input-item color-input-item no-margin"><label for=timelineMainColor ng-class="{\'edited-label\' : editedFields[\'timelineMainColor\'], \'error-label\' : errorField == \'timelineMainColor\'}">(Optional) Main Color :</label><input colorpicker=hex class="task-input color-input" ng-model=timelineObj.timelineMainColor ng-change="editField(\'timelineMainColor\')" id=timelineMainColor> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : timelineObj.timelineMainColor}">Color Preview</span></li><li class="sub-list-item small-input-item color-input-item"><label for=timelineSubColor ng-class="{\'edited-label\' : editedFields[\'timelineSubColor\'], \'error-label\' : errorField == \'timelineSubColor\'}">(Optional) Sub Color :</label><input colorpicker=hex class="task-input color-input" ng-model=timelineObj.timelineSubColor ng-change="editField(\'timelineSubColor\')" id=timelineSubColor> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : timelineObj.timelineSubColor}">Color Preview</span></li></ul></div></div><div class=modal-footer-with-buttons><div class=prompt-container><div class="prompt-box error-prompt" ng-if="errorMessage && !saving"><h1>{{errorMessage}}</h1></div><div class=prompt-box ng-if=saving><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class="md-accent saving-spinner" md-diameter=24px></md-progress-circular></div><div class="prompt-box flash-message" ng-if=showSaved><h1>{{editingObj ? \'Update Successful\' : \'Created Timeline Template\'}}</h1><i class="fa fa-check success-check"></i></div></div><ul class=footer-buttons><li ng-click="copyMaster(\'flower\')" class=green-button ng-if=showGenButtons><h1>Gen Flower</h1></li><li ng-click="copyMaster(\'veg\')" class=green-button ng-if=showGenButtons><h1>Gen Veg</h1></li><li ng-click=saveTL() class=green-button ng-class="{\'disable-button\' : !editedFields}" ng-if=!showGenButtons><h1>Save</h1></li><li ng-click=deleteTL() class=red-button ng-class="{\'disable-button\' : newTL}" ng-if=!showGenButtons><h1>Delete</h1></li><li ng-click=$dismiss() class=orange-button><h1 ng-if=!savedTL>Cancel</h1><h1 ng-if=savedTL>Close</h1></li></ul></div>'),a.put("components/timelineTask/editChildTaskModal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body timeline-task-modal-body"><h4 class="nav-header text-muted">Note: You are editing a specific task.</h4><form><h5 class="text-muted text-center">Task Details</h5><div class="row child-task-info"><div class=col-xs-4><h1>{{modalTask.siteShortName}}</h1><h2>Site</h2></div><div class=col-xs-4><h1>{{modalTask.tunnelShortName}}</h1><h2>Tunnel</h2></div><div class=col-xs-4><h1>{{modalTask.inPeriod}}</h1><h2>Cycle Period</h2></div><div class=col-xs-4><h1>W{{modalTask.taskWeek}}-{{modalTask.inPeriod.charAt(0)}}</h1><h2>Week</h2></div><div class=col-xs-4><h1>{{modalTask.taskDay}}</h1><h2>Day</h2></div><div class=col-xs-4><h1>{{modalTask.occurrenceDate._d | date : \'EEEE, MMMM d\'}}</h1><h2>Task Date</h2></div><div class=col-xs-4><h1>{{modalTask.roomDetails.startDate | date : \'EEEE, MMMM d\'}}</h1><h2>Room Start</h2></div><div class=col-xs-4><h1 ng-class="{\'dim-text\' : !modalTask.roomDetails.flippedDate}">{{modalTask.roomDetails.flippedDate ? modalTask.roomDetails.flippedDate : \'Not yet flipped\' | date : \'EEEE, MMMM d\'}}</h1><h2>Room Flipped</h2></div><div class=col-xs-4><h1>{{modalTask.roomDetails.endDate | date : \'EEEE, MMMM d\'}}</h1><h2>Room End</h2></div></div><div class="row form-group"><div class="form-group col-xs-8 col-sm-4"><h5 class=nav-header>Task Title</h5><input class=form-control id=taskTitle placeholder=Title ng-model=modalTask.childTitle></div><div class="col-xs-6 col-sm-4"><h5 class=nav-header>Priority</h5><select name=singleSelect ng-model=modalTask.priority class=modal-select><option value="">---Please select---</option><option ng-repeat="option in taskPriorities" ng-value=option.value>{{option.name}}</option></select></div><div class="col-xs-8 col-sm-4"><h5 class=nav-header>Edit Date</h5><p class="input-group edit-task-date"><input class=form-control uib-datepicker-popup="EEEE, MMMM d" ng-model=modalTask.occurrenceDate._d is-open=showCal datepicker-options=dateOptions ng-required=true close-text=Close alt-input-formats=altInputFormats ng-change=changeDate()> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="showCal = !showCal"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></div><div class="form-group row"><h5 class=nav-header>Notes</h5><textarea class=form-control rows=3 id=taskNotes ng-model=modalTask.taskNotes placeholder="E.g., Make sure this is done with gloves."></textarea></div><div class="form-group row"></div></form></div><div class=modal-footer><div class=error-box ng-show=showError><h1>{{errorMessage}}</h1></div><div class=loading-container ng-show=loading><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-light-green" ng-click=resetTask()>Reset</button> <button class="btn btn-success" ng-click=saveEdits()>Save</button> <button class="btn btn-default" ng-click=$dismiss()>Cancel</button></div>'),a.put("components/timelineTask/timelineTaskModal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class="modal-body timeline-task-modal-body"><h4 class="nav-header text-muted" ng-if="taskType == \'master\'">Note: For now, ALL master tasks are based on the standard 77 day cycle with 3 weeks of veg and 8 weeks of flower.</h4><form><div class=row ng-if="taskType == \'room\'"><h4 class=nav-header>Which rooms will have this task?</h4><div class=row ng-repeat="site in sites"><h5 class=nav-header>{{site.name}}</h5><ul class=horizontal-row><li ng-repeat="room in site.rooms" ng-click=toggleRoom(room) ng-class="{\'selected-child\' : selectedRoom(room)}"><h1>{{room.tunnelShortName}}</h1></li></ul></div></div><div class=row><div class="form-group col-xs-10 col-sm-4"><label for=taskTitle>Title</label><input class=form-control id=taskTitle placeholder=Title ng-model=modalTask.title></div><div class="form-group col-xs-10 col-sm-4"><label for=backgroundColor>Background Color</label><input colorpicker=hex id=backgroundColor class=form-control ng-model=modalTask.backgroundColor> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : modalTask.backgroundColor}">Color Preview</span></div><div class="form-group col-xs-10 col-sm-4"><label for=backgroundColor>Warning Color</label><input colorpicker=hex id=warningColor class=form-control ng-model=modalTask.warningColor> <span class="input-group-addon color-preview" ng-style="{\'background-color\' : modalTask.warningColor}">Color Preview</span></div></div><div class="row fluid-container"><h4 class=nav-header>Time Estimate (for one person)</h4><div class="col-xs-10 col-sm-3"><h5 class=nav-header>Amount</h5><div class=input-group><input type=number class=form-control placeholder="E.g., 2" id=amountInput ng-model=modalTask.timeEstimate.amount><label for=amountInput class="pull-right text-muted">Whole numbers only please.</label></div></div><div class="col-xs-10 col-sm-4"><h5 class=nav-header>Unit</h5><div class="col-xs-6 custom-modal-button" ng-click="modalTask.timeEstimate.unit = \'hour\'" ng-class="{\'selected-button\' : modalTask.timeEstimate.unit == \'hour\'}"><h1>{{modalTask.timeEstimate.amount == 1 ? \'Hour\' : \'Hours\'}}</h1></div><div class="col-xs-6 custom-modal-button" ng-click="modalTask.timeEstimate.unit = \'minute\'" ng-class="{\'selected-button\' : modalTask.timeEstimate.unit == \'minute\'}"><h1>{{modalTask.timeEstimate.amount == 1 ? \'Minute\' : \'Minutes\'}}</h1></div></div><div class="col-xs-6 col-sm-3"><h5 class=nav-header>Per</h5><select name=singleSelect ng-model=modalTask.timeEstimate.per class=modal-select ng-options="option.value as option.name for option in timeEstimateOpts"><!--<option value="">-&#45;&#45;Please select-&#45;&#45;</option>--><!--<option ng-repeat="option in timeEstimateOpts" ng-value="option.value" ng-selected="option.value == modalTask.timeEstimate.per">{{option.name}}</option>--></select></div></div><!--<div class="col-xs-6 custom-modal-button" ng-click="showValue()">--><!--<h1>--><!--Display--><!--</h1>--><!--</div>--><div class="form-group row"><h4 class=nav-header>Notes</h4><textarea class=form-control rows=3 id=taskNotes ng-model=modalTask.notes placeholder="E.g., Make sure this is done with gloves."></textarea></div><div class="form-group row" ng-if="(taskType != \'edit\' || modalTask.isMaster)"><h4 class=nav-header>Occurrence</h4><div class="col-xs-3 custom-modal-button" ng-click="(modalTask.occurrenceObj.type = \'veg\'); buildStageWeeks(\'veg\')" ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'veg\'}"><h1>In Veg</h1></div><div class="col-xs-3 custom-modal-button" ng-click="(modalTask.occurrenceObj.type = \'flower\'); buildStageWeeks(\'flower\')" ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'flower\'}"><h1>In Flower</h1></div><div class="col-xs-3 custom-modal-button" ng-if="taskType == \'room\'" ng-click="modalTask.occurrenceObj.type = \'date\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'date\'}"><h1>On Date</h1></div><!--<div class="col-xs-3 custom-modal-button" ng-click="modalTask.occurrenceObj.type = \'relationship\'"--><!--ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'relationship\'}">--><!--<h1>--><!--In Relation to Other--><!--</h1>--><!--</div>--><!--<div class="col-xs-3 custom-modal-button" ng-click="modalTask.occurrenceObj.type = \'event\'"--><!--ng-class="{\'selected-button\' : modalTask.occurrenceObj.type == \'event\'}">--><!--<h1>--><!--Event--><!--</h1>--><!--</div>--></div><!-- Edit Group --><div class="form-group row" ng-if="taskType == \'edit\' && !modalTask.isMaster"><h4 class="nav-header text-muted uppercase-title">This task occurs on <span>W{{modalTask.taskWeek}}-{{modalTask.inPeriod.charAt(0)}} (d{{modalTask.taskDay}})</span></h4><h5 class="nav-header text-muted uppercase-title">Location: <span>{{modalTask.tunnelShortName}}</span> at <span>{{modalTask.siteShortName}}</span></h5></div><div class="form-group row" ng-show="modalTask.occurrenceObj.type == \'event\'"><h4 class="nav-header text-muted">Use this to quickly set a task to occur on a specific event.</h4><div class="list-group col-xs-6 col-sm-4"><h5 class=nav-header>Event</h5><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.event = \'start-of-room\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.event == \'start-of-room\'}"><h4 class=list-group-item-heading>Start of Room</h4><p class=list-group-item-text>Day the room starts.</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.event = \'end-of-room\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.event == \'end-of-room\'}"><h4 class=list-group-item-heading>End of Room</h4><p class=list-group-item-text>Day the room ends.</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.event = \'lights-flipped-to-flower\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.event == \'lights-flipped-to-flower\'}"><h4 class=list-group-item-heading>Lights flipped to flower</h4><p class=list-group-item-text>Day the lights are flipped</p></a></div><div class="col-xs-6 col-sm-4"><div class=row><h5 class=nav-header>Value of Unit</h5><div class=input-group><input type=number class=form-control placeholder="E.g., 7" id=valueInput ng-model=modalTask.occurrenceObj.occurrenceDay.value><label for=valueInput class="pull-right text-muted">Whole numbers only please.</label></div></div><div class=row><h5 class=nav-header>Unit</h5><div class="col-xs-6 custom-modal-button" ng-click="occurrenceUnit = \'day\'" ng-class="{\'selected-button\' : occurrenceUnit == \'day\'}"><h1>{{modalTask.occurrenceObj.occurrenceDay.value == 1 ? \'Day\' : \'Days\'}}</h1></div><div class="col-xs-6 custom-modal-button" ng-click="occurrenceUnit = \'week\'" ng-class="{\'selected-button\' : occurrenceUnit == \'week\'}"><h1>{{modalTask.occurrenceObj.occurrenceDay.value == 1 ? \'Week\' : \'Weeks\'}}</h1></div></div><div class=row><h5 class=nav-header>Occurs</h5><div class="col-xs-6 custom-modal-button" ng-click="modalTask.occurrenceObj.relationshipType = \'before\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.relationshipType == \'before\'}"><h1>Before Event</h1></div><div class="col-xs-6 custom-modal-button" ng-click="modalTask.occurrenceObj.relationshipType = \'after\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.relationshipType == \'after\'}"><h1>After Event</h1></div></div></div><div class="clearfix visible-xs"></div><div class="list-group col-xs-10 col-sm-4"><h5 class=nav-header>Type of Unit</h5><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'day\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'day\'}"><h4 class=list-group-item-heading>Hard Type</h4><p class=list-group-item-text>E.g., This will ALWAYS happen {{modalTask.occurrenceObj.occurrenceDay.value ? modalTask.occurrenceObj.occurrenceDay.value : \' x \'}} {{occurrenceUnit ? (modalTask.occurrenceObj.occurrenceDay.value == 1 ? occurrenceUnit : occurrenceUnit + \'s\') : \' units \'}} from event.</p></a><a href=# class=list-group-item ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'percent\'" ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'percent\'}"><h4 class=list-group-item-heading>Soft Type</h4><p class=list-group-item-text>Calculates units based on % through cycle length.</p></a></div><div class=col-xs-6 ng-show=!disablePreview><div class="panel panel-default"><div class=panel-heading><h4>Occurrence Preview</h4></div><div class=panel-body><h5 class="nav-header text-muted">This task will occur...</h5><ul class=list-group><li class=list-group-item>{{eventPreviewStandard}}</li><li class=list-group-item>{{eventPreviewShort}}</li><li class=list-group-item>{{eventPreviewLong}}</li></ul><h5 class="nav-header text-muted">Or try it with a custom cycle length!</h5><div class=input-group><input type=number class=form-control placeholder="Custom cycle length in days" ng-model=customCycleLength> <span class=input-group-btn><button class="btn btn-default" type=button ng-click=calculateCustom(modalTask.occurrenceObj)>Calculate</button></span></div><h5 class="nav-header text-muted" ng-show=eventPreviewCustom.length>This task will occur...</h5><ul class=list-group ng-show=eventPreviewCustom.length><li class=list-group-item>{{eventPreviewCustom}}</li></ul></div></div></div></div><div class="form-group container-fluid" ng-show="modalTask.occurrenceObj.type == \'relationship\'"><div class="col-xs-6 col-sm-4 col-sm-offset-1"><h4>Veg Tasks</h4><div class=list-group><a href=# class=list-group-item ng-repeat="task in vegTasks"><h5 class=list-group-item-heading>{{task.title}}</h5><p class=list-group-item-text>{{task.notes}}</p></a></div></div><div class="col-xs-6 col-sm-4 col-sm-offset-2"><h4>Flower Tasks</h4><div class=list-group><a href=# class=list-group-item ng-repeat="task in flowerTasks"><h5 class=list-group-item-heading>{{task.title}}</h5><p class=list-group-item-text>{{task.notes}}</p></a></div></div></div><div class="form-group container-fluid" ng-show="modalTask.occurrenceObj.type == \'veg\' || modalTask.occurrenceObj.type == \'flower\'"><h4 class="nav-header text-muted">Note: This is based off of a standard 77 day cycle.</h4><h5 class=nav-header>Week</h5><ul class=horizontal-row><li ng-repeat="week in stageWeeks" ng-click="selectTime(week, \'week\')" ng-class="{\'selected-child\' : selectedTime.week == week}"><h1>W{{week}}-{{modalTask.occurrenceObj.type}}</h1></li></ul><h5 class=nav-header ng-show=selectedTime.week>Day in Week</h5><ul class=horizontal-row ng-show=selectedTime.week><li ng-repeat="day in stageDays" ng-click="selectTime(day, \'day\')" ng-class="{\'selected-child\' : selectedTime.day == day}"><h1>d-{{day}}</h1></li></ul><!--<div class="list-group col-xs-10 col-sm-4" ng-show="selectedTime.week && selectedTime.day">--><!--<h5 class="nav-header">--><!--Type of Unit--><!--</h5>--><!--<a href="#" class="list-group-item" ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'day\'"--><!--ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'day\'}">--><!--<h4 class="list-group-item-heading">Hard Type</h4>--><!--<p class="list-group-item-text">--><!--E.g., This will ALWAYS happen in W{{selectedTime.week}}-{{modalTask.occurrenceObj.type}} (d-{{selectedTime.day}}).--><!--</p>--><!--</a>--><!--<a href="#" class="list-group-item" ng-click="modalTask.occurrenceObj.occurrenceDay.type = \'percent\'"--><!--ng-class="{\'selected-button\' : modalTask.occurrenceObj.occurrenceDay.type == \'percent\'}">--><!--<h4 class="list-group-item-heading">Soft Type</h4>--><!--<p class="list-group-item-text">--><!--Calculates units based on % through cycle length.--><!--</p>--><!--</a>--><!--</div>--><div class=col-xs-6 ng-show=!disablePreview><div class="panel panel-default"><div class=panel-heading><h4>Occurrence Preview</h4></div><div class=panel-body><h5 class="nav-header text-muted">This task will occur...</h5><ul class=list-group><li class=list-group-item>{{periodPreviewStandard}}</li><li class=list-group-item>{{periodPreviewShort}}</li><li class=list-group-item>{{periodPreviewLong}}</li></ul><h5 class="nav-header text-muted">Or try it with a custom cycle length!</h5><div class=input-group><input type=number class=form-control placeholder="Custom cycle length in days" ng-model=customCycleLength> <span class=input-group-btn><button class="btn btn-default" type=button ng-click=calculateOccurrenceInCustomCycle()>Calculate</button></span></div><h5 class="nav-header text-muted" ng-show=periodPreviewCustom.length>This task will occur...</h5><ul class=list-group ng-show=periodPreviewCustom.length><li class=list-group-item>{{periodPreviewCustom}}</li></ul></div></div></div></div><div class="form-group container-fluid" ng-show="modalTask.occurrenceObj.type == \'date\'"><div class=col-xs-4><h5 class=nav-header>Task Date</h5><p class=input-group><input class=form-control uib-datepicker-popup="EEEE, MMMM d" ng-model=modalTask.occurrenceDate is-open=showDatePicker datepicker-options=dateOptions ng-required=true close-text=Close ng-change=changeDate()> <span class=input-group-btn><button type=button class="btn btn-default" ng-click=selectDate()><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></div><!--<label ng-if="modalTask.stage.length">--><!--{{modalTask.stage}} week--><!--</label>--><!--<ul ng-if="modalTask.stage.length" class="stage-week">--><!--<li ng-repeat="week in getWeeks() track by $index">--><!--<h1>--><!--Week {{$index+1}}--><!--</h1>--><!--<h2>--><!--Days:--><!--</h2>--><!--<ul>--><!--<li ng-repeat="day in [1,2,3,4,5,6,7]" ng-click="setTime($parent.$index+1,$index+1)"--><!--ng-class="{\'selected-day\' : isActiveDay($parent.$index+1, $index+1)}">--><!--{{day}}--><!--</li>--><!--</ul>--><!--</li>--><!--</ul>--></form></div><div class=modal-footer><div class=error-box ng-show=showError><h1>{{errorMessage}}</h1></div><div class=loading-container ng-show=loading><h1>Saving...</h1><md-progress-circular md-mode=indeterminate class=md-accent md-diameter=20px></md-progress-circular></div><button class="btn btn-light-green" ng-click=reset()>Reset</button> <button class="btn btn-success" ng-click=save()>Save</button> <button class="btn btn-default" ng-click=cancel()>Cancel</button></div>'),a.put("components/view-toggler/view-toggler.html",'<div class=select-toggler><header><h1>Select Operation / Select Tunnels to view:</h1><!--<h2>--><!--Contact Timeline Categories--><!--</h2>--></header><div class=list-container><ul><li ng-click=toggleAllSites() class=all-button ng-class="{\'all-toggled\' : allSitesToggled}"><h1>All</h1></li><li ng-repeat="site in sites" ng-click=toggleSite(site) ng-style="{\n            \'background-color\' : (isSiteToggled(site)) ? site.mainColor : site.subColor\n          }" ng-class="{\'selected-item\' : isSiteToggled(site)}"><h1>{{site.siteShortName}}</h1></li></ul></div><!--<span class="section-break"></span>--><!--<header>--><!--<h1>--><!--Select Tunnels:--><!--</h1>--><!--&lt;!&ndash;<h2>&ndash;&gt;--><!--&lt;!&ndash;Contains Task Driven Timelines.&ndash;&gt;--><!--&lt;!&ndash;</h2>&ndash;&gt;--><!--</header>--><div class=list-container><ul class=aside-menu-list><li ng-click=toggleAllRooms() class=all-button ng-class="{\'all-toggled\' : allRoomsToggled && availableRooms.length}"><h1>All</h1></li><li ng-repeat="room in availableRooms" ng-click=toggleRoom(room) ng-style="{\n            \'background-color\' : (isRoomToggled(room)) ? room.siteMainColor : room.siteSubColor\n          }" ng-class="{\'selected-item\' : isRoomToggled(room)}"><h1>{{room.tunnelShortName}}</h1><h2>{{room.siteShortName}}</h2></li></ul></div></div>');
}]);